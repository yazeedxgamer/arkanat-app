<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <script>
        if (window.location.hostname === 'arkanat-system.vercel.app') {
            window.location.href = 'https://www.arkanat.co';
        }
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام اركانات</title>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#000000">
    
    <link rel="icon" href="/icon-192.png" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />

    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <link rel="stylesheet" href="/style.css">
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
</head>
<body>
<div id="login-page">
    <div class="login-card">
        <img src="https://arkanat.com.sa/wp-content/uploads/2024/07/logo.svg" alt="شعار اركانات" class="logo">
        <h3>تسجيل الدخول للنظام</h3>
        <form id="login-form">
            <div class="form-group">
                <label for="id-number">رقم الهوية</label>
                <input type="text" id="id-number" required>
            </div>
            <div class="form-group">
                <label for="password">كلمة المرور</label>
                <div class="password-wrapper">
                    <input type="password" id="password" required>
                    <i class="ph-bold ph-eye-slash toggle-password"></i>
                </div>
            </div>
            <div style="text-align: left; margin: -10px 0 15px 0;">
                <a href="#" id="forgot-password-link">نسيت كلمة المرور؟</a>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">تسجيل الدخول</button>
        </form>
    </div>
    <div id="forgot-password-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 450px;">
        <div class="modal-header">
            <h4 id="forgot-password-title">إعادة تعيين كلمة المرور</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="forgot-password-form">
            <div class="modal-body">
                <div id="otp-step" class="step-view">
                    <p style="color: var(--text-secondary); margin-top: 0;">الرجاء إدخال رقم هويتك المسجل بالنظام لإرسال كود التحقق إلى جوالك.</p>
                    <div class="form-group">
                        <label for="reset-id-number">رقم الهوية</label>
                        <input type="text" id="reset-id-number" required>
                    </div>
                </div>

                <div id="reset-step" class="step-view hidden">
                    <p style="color: var(--text-secondary); margin-top: 0;">تم إرسال كود التحقق إلى جوالك. الرجاء إدخاله مع كلمة المرور الجديدة.</p>
                    <div class="form-group">
                        <label for="reset-otp">كود التحقق (OTP)</label>
                        <input type="text" id="reset-otp" required>
                    </div>
                    <div class="form-group">
                        <label for="reset-new-password">كلمة المرور الجديدة</label>
                        <div class="password-wrapper">
                            <input type="password" id="reset-new-password" required>
                            <i class="ph-bold ph-eye-slash toggle-password"></i>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="reset-confirm-password">تأكيد كلمة المرور الجديدة</label>
                        <div class="password-wrapper">
                            <input type="password" id="reset-confirm-password" required>
                            <i class="ph-bold ph-eye-slash toggle-password"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" id="send-otp-btn" class="btn btn-primary">إرسال كود التحقق</button>
                <button type="submit" id="reset-password-btn" class="btn btn-primary hidden">إعادة تعيين كلمة المرور</button>

                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>
</div>
    <div class="dashboard-container hidden">
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="https://arkanat.com.sa/wp-content/uploads/2024/07/logo.svg" alt="شعار اركانات" class="logo">
                <h1>اركانات</h1>
            </div>
            <nav class="sidebar-nav">
                <ul>
                      <li id="super-admin-link" style="display: none;">
                        <a href="/manage/system" data-page="page-manage-system">
                            <i class="ph-fill ph-crown"></i><span>إدارة قسم النظام</span>
                        </a>
                    </li>
                    <li id="high-command-link" style="display: none;">
                        <a href="/high-command" data-page="page-high-command" style="background: linear-gradient(45deg, #000, #333); color: #fcd34d; border: 1px solid #fcd34d;">
                            <i class="ph-fill ph-crown"></i><span>القيادة العليا</span>
                        </a>
                    </li>
                    <li id="dept-requests-link" style="display: none;">
                        <a href="/dept-requests" data-page="page-dept-requests">
                            <i class="ph-fill ph-tray"></i><span>طلبات القسم الواردة</span>
                        </a>
                    </li>
                    <li data-role="all" id="admin-att-link" style="display: none;">
                        <a href="/admin-attendance" data-page="page-admin-attendance">
                            <i class="ph-fill ph-fingerprint"></i><span>بصمة الإدارة</span>
                        </a>
                    </li>
                    <li id="dept-permissions-link" style="display: none;">
    <a href="/dept-permissions" data-page="page-dept-permissions">
        <i class="ph-fill ph-clock-user"></i><span>طلبات استئذان القسم</span>
    </a>
</li>
                    <li data-role="ادارة العمليات"><a href="/permission-requests" data-page="page-permission-requests"><i class="ph-fill ph-user-switch"></i><span>طلبات الاستئذان</span><span class="menu-badge hidden"></span></a></li>
                    <li data-role="ادارة العمليات"><a href="/ops-review-requests" data-page="page-ops-review-requests"><i class="ph-fill ph-clipboard-text"></i><span>طلبات الموظفين</span><span class="menu-badge hidden"></span></a></li>
                    <li data-role="مدير النظام,ادارة العمليات,مشرف"><a href="/geo" data-page="page-geo"><i class="ph-fill ph-map-pin"></i><span>التتبع الجغرافي</span></a></li>
                    <li data-role="ادارة العمليات,مشرف"><a href="/coverage" data-page="page-coverage"><i class="ph-fill ph-shield-check"></i><span>التغطيات</span><span class="menu-badge hidden"></span></a></li>
                    <li data-role="مدير النظام"><a href="/admin-dashboard" data-page="page-admin-dashboard"><i class="ph-fill ph-gear-six"></i><span>لوحة تحكم النظام</span></a></li>
                    <li data-role="مدير النظام"><a href="/announcements" data-page="page-announcements"><i class="ph-fill ph-megaphone"></i><span>إدارة الإعلانات</span></a></li>
                    <li data-role="مدير النظام"><a href="/user-management" data-page="page-user-management"><i class="ph-fill ph-users-four"></i><span>إدارة المستخدمين</span></a></li>
                    <li id="admin-history-link" style="display: none;">
    <a href="/admin-history" data-page="page-admin-history">
        <i class="ph-fill ph-clock-counter-clockwise"></i><span>سجل الإداريين</span>
    </a>
</li>
                    <li data-role="مدير النظام,ادارة الموارد البشرية" data-permission="can_manage_admin_staff"><a href="/admin-staff" data-page="page-admin-staff"><i class="ph-fill ph-users-three"></i><span>إدارة موظفي الإدارة</span></a></li>
                    <li data-permission="is_ops_manager"><a href="/manage/ops" data-page="page-manage-ops"><i class="ph-fill ph-users-gear"></i><span>إدارة قسم العمليات</span></a></li>
                    <li data-permission="is_hr_manager"><a href="/manage/hr" data-page="page-manage-hr"><i class="ph-fill ph-users-gear"></i><span>إدارة قسم الموارد البشرية</span></a></li>
                    <li data-permission="is_contracts_manager"><a href="/manage/contracts" data-page="page-manage-contracts"><i class="ph-fill ph-users-gear"></i><span>إدارة قسم العقود</span></a></li>
                    <li data-permission="is_finance_manager"><a href="/manage/finance" data-page="page-manage-finance"><i class="ph-fill ph-users-gear"></i><span>إدارة القسم المالي</span></a></li>
                    <li data-permission="is_marketing_manager"><a href="/manage/marketing" data-page="page-manage-marketing"><i class="ph-fill ph-users-gear"></i><span>إدارة قسم التسويق</span></a></li>
                    <li data-permission="is_legal_manager"><a href="/manage/legal" data-page="page-manage-legal"><i class="ph-fill ph-users-gear"></i><span>إدارة الشؤون القانونية</span></a></li>
                    <li data-role="ادارة العمليات"><a href="/ops-nominees" data-page="page-ops-nominees"><i class="ph-fill ph-user-focus"></i><span>المرشحون للتوظيف</span><span class="menu-badge hidden"></span></a></li>
                    <li data-role="ادارة الموارد البشرية,مدير النظام"><a href="/hr-admin-requests" data-page="page-hr-admin-reviews"><i class="ph-fill ph-user-list"></i><span>طلبات الإداريين </span></a></li>
                    <li data-role="ادارة العمليات"><a href="/directives-ops" data-page="page-directives-ops"><i class="ph-fill ph-paper-plane-tilt"></i><span>التوجيهات</span></a></li>
                    <li data-role="ادارة العمليات,مشرف"><a href="/visits" data-page="page-visits"><i class="ph-fill ph-car"></i><span>الزيارات</span></a></li>
                    <li id="admin-payroll-link" style="display: none;">
    <a href="/admin-payroll" data-page="page-admin-payroll">
        <i class="ph-fill ph-money"></i><span>مسير الإداريين</span>
    </a>
</li>
                    <li data-role="ادارة العمليات,مشرف,مدير النظام"><a href="/guard-attendance" data-page="page-guard-attendance"><i class="ph-fill ph-users-four"></i><span>حضور الحراس</span></a></li>
                    <li data-role="مشرف"><a href="/patrol" data-page="page-patrol"><i class="ph-fill ph-car-profile"></i><span>تسجيل جولة</span></a></li>
                    <li data-role="مشرف,ادارة العمليات"><a href="/supervisor-schedules" data-page="page-supervisor-schedules"><i class="ph-fill ph-calendar-check"></i><span>جداول الحراس</span></a></li>
                    <li data-role="مشرف"><a href="/supervisor-permission-requests" data-page="page-supervisor-permission-requests"><i class="ph-fill ph-user-switch"></i><span>طلبات استئذان الحراس</span><span class="menu-badge hidden"></span></a></li>
                    <li data-role="مشرف"><a href="/supervisor-applications" data-page="page-supervisor-applications"><i class="ph-fill ph-users-three"></i><span>طلبات التوظيف</span><span class="menu-badge hidden"></span></a></li>
                    <li data-role="مشرف,مدير النظام">
    <a href="/supervisor/resignations" data-page="page-supervisor-resignations">
        <i class="ph-fill ph-user-minus"></i><span>طلبات الاستقالة</span>
        <span class="menu-badge hidden"></span>
    </a>
</li>
<li data-role="الشؤون القانونية,مدير النظام">
    <a href="/legal/resignations" data-page="page-legal-resignations">
        <i class="ph-fill ph-gavel"></i><span>اعتماد الاستقالات</span>
        <span class="menu-badge hidden"></span>
    </a>
</li>
<li data-role="المالية,مدير النظام">
    <a href="/finance/loans" data-page="page-finance-loans">
        <i class="ph-fill ph-hand-coins"></i><span>متابعة طلبات السلف</span>
        <span class="menu-badge hidden"></span>
    </a>
</li>
<li id="admin-monitor-link" style="display: none;">
    <a href="/admin-monitor" data-page="page-admin-monitor">
        <i class="ph-fill ph-eye"></i><span>حضور الادارة</span>
    </a>
</li>
<li id="admin-requests-link" style="display: none;">
    <a href="/admin-requests" data-page="page-admin-requests">
        <i class="ph-fill ph-files"></i><span>طلباتي</span>
    </a>
</li>
                    <li data-role="ادارة العقود,مدير النظام"><a href="/contracts" data-page="page-contracts"><i class="ph-fill ph-handshake"></i><span>إدارة العقود</span></a></li>
                    <li data-role="المالية"><a href="/finance-custody" data-page="page-finance-custody"><i class="ph-fill ph-hand-coins"></i><span>إدارة العُهد</span></a></li>
                    <li data-role="التسويق,مدير النظام"><a href="/marketing-clients" data-page="page-marketing-clients"><i class="ph-fill ph-identification-badge"></i><span>بيانات العملاء</span></a></li>
                    <li data-role="التسويق,مدير النظام"><a href="/marketing-calendar" data-page="page-marketing-calendar"><i class="ph-fill ph-calendar-blank"></i><span>تقويم التسويق</span></a></li>
                    <li data-role="الشؤون القانونية,مدير النظام"><a href="/legal-calendar" data-page="page-legal-calendar"><i class="ph-fill ph-scales"></i><span>تقويم الشؤون القانونية</span></a></li>
                    <li data-role="الشؤون القانونية,مدير النظام"><a href="/legal-employee-lookup" data-page="page-legal-employee-lookup"><i class="ph-fill ph-user-list"></i><span>ملف الموظف القانوني</span></a></li>
                    <li data-role="الشؤون القانونية,مدير النظام"><a href="/legal-penalties" data-page="page-legal-penalties"><i class="ph-fill ph-gavel"></i><span>العقوبات والجزاءات</span></a></li>
                    <li data-role="الشؤون القانونية,مدير النظام"><a href="/blacklist" data-page="page-blacklist"><i class="ph-fill ph-user-minus"></i><span>القائمة السوداء</span></a></li>
                    <li data-role="الشؤون القانونية,مدير النظام"><a href="/settlements" data-page="page-settlements"><i class="ph-fill ph-handshake"></i><span>إدارة التسوية الودية</span></a></li>
                    <li data-role="الشؤون القانونية,مدير النظام"><a href="/lawsuits" data-page="page-lawsuits"><i class="ph-fill ph-scales"></i><span>إدارة الدعاوى</span></a></li>
                    <li data-role="مشرف"><a href="/supervisor-custody" data-page="page-supervisor-custody"><i class="ph-fill ph-wallet"></i><span>عهدة التغطيات</span></a></li>
                    <li data-role="ادارة الموارد البشرية,مدير النظام"><a href="/vacancies" data-page="page-vacancies"><i class="ph-fill ph-briefcase"></i><span>إدارة الشواغر</span></a></li>
                    <li data-role="ادارة الموارد البشرية,مدير النظام"><a href="/employees" data-page="page-employees"><i class="ph-fill ph-user-list"></i><span>إدارة الحراس والمشرفين</span></a></li>
                    <li data-role="ادارة الموارد البشرية"><a href="/hr-data-entry" data-page="page-hr-data-entry"><i class="ph-fill ph-file-arrow-up"></i><span>إدخال البيانات</span></a></li>
                    <li data-role="ادارة الموارد البشرية,مدير النظام">
                        <a href="/payroll-dashboard" data-page="page-payroll-dashboard">
                            <i class="ph-bold ph-squares-four"></i><span>لوحة متابعة المسيرات</span>
                        </a>
                    </li>
                    <li data-role="ادارة الموارد البشرية"><a href="/payroll" data-page="page-payroll"><i class="ph-fill ph-file-text"></i><span>مسير الرواتب</span></a></li>
                    <li data-role="ادارة الموارد البشرية,مدير النظام">
                        <a href="/payroll-settings" data-page="page-payroll-settings">
                            <i class="ph-bold ph-sliders-horizontal"></i><span>إعدادات المسير</span>
                        </a>
                    </li>
                    <li data-role="مدير النظام"><a href="/hr-sms" data-page="page-hr-sms"><i class="ph-fill ph-paper-plane-tilt"></i><span>إرسال SMS</span></a></li>
                    <li data-role="ادارة الموارد البشرية"><a href="/official-holidays" data-page="page-official-holidays"><i class="ph-fill ph-calendar-star"></i><span>العطلات الرسمية</span></a></li>
                    <li data-role="مدير النظام,ادارة العهد"><a href="/inventory" data-page="page-inventory"><i class="ph-fill ph-storefront"></i><span>إدارة المخزون</span></a></li>
                    <li data-role="مدير النظام,ادارة العهد"><a href="/vehicles" data-page="page-vehicles"><i class="ph-fill ph-car"></i><span>عهد المركبات</span></a></li>
                    <li data-role="مدير النظام,ادارة العهد"><a href="/admin-assets" data-page="page-admin-assets"><i class="ph-fill ph-laptop"></i><span>عهد الموظفين</span></a></li>
                    <li data-role="مدير النظام,ادارة العهد"><a href="/guard-assets" data-page="page-guard-assets"><i class="ph-fill ph-broadcast"></i><span>عهد الحراس (البرافو)</span></a></li>
                    <li data-role="مدير النظام,ادارة العهد"><a href="/asset-reports" data-page="page-asset-reports"><i class="ph-fill ph-chart-line"></i><span>تقارير العهد</span></a></li>
                    <li data-role="ادارة الموارد البشرية"><a href="/penalties" data-page="page-penalties"><i class="ph-fill ph-scales"></i><span>العقوبات والخصومات</span></a></li>
                    <li data-role="ادارة الموارد البشرية"><a href="/leave-requests" data-page="page-leave-requests"><i class="ph-fill ph-calendar-blank"></i><span>طلبات الإجازات</span><span class="menu-badge hidden"></span></a></li>
                    <li data-role="ادارة الموارد البشرية"><a href="/resignation-requests" data-page="page-resignation-requests"><i class="ph-fill ph-file-x"></i><span>طلبات الاستقالات</span><span class="menu-badge hidden"></span></a></li>
                    <li data-role="ادارة الموارد البشرية,مدير النظام"><a href="/end-of-service" data-page="page-end-of-service"><i class="ph-fill ph-calculator"></i><span>إنهاء الخدمة والمخالصة</span></a></li>
                    <li data-role="ادارة الموارد البشرية"><a href="/loan-requests" data-page="page-loan-requests"><i class="ph-fill ph-hand-coins"></i><span>طلبات السلف</span><span class="menu-badge hidden"></span></a></li>
                    <li data-role="مدير النظام,ادارة الموارد البشرية,ادارة العمليات"><a href="/hr-attendance-log" data-page="page-hr-attendance-log"><i class="ph-fill ph-user-list-checks"></i><span>سجل الحضور</span></a></li>
                    <li data-role="مدير النظام,ادارة الموارد البشرية" data-permission="can_edit_attendance"><a href="/attendance-management" data-page="page-attendance-management"><i class="ph-fill ph-user-gear"></i><span>إدارة الحضور</span></a></li>
                    <li data-role="ادارة الموارد البشرية"><a href="/requests-archive" data-page="page-requests-archive"><i class="ph-fill ph-archive"></i><span>أرشيف الطلبات</span></a></li>
                    <li data-role="حارس أمن"><a href="/attendance" data-page="page-attendance"><i class="ph-fill ph-timer"></i><span>الحضور و الانصراف</span></a></li>
                    <li data-role="حارس أمن"><a href="/my-requests" data-page="page-my-requests"><i class="ph-fill ph-files"></i><span>طلباتي</span></a></li>
                    <li data-role="مشرف,حارس أمن"><a href="/my-directives" data-page="page-my-directives"><i class="ph-fill ph-bell-ringing"></i><span>التوجيهات الواردة</span><span class="menu-badge hidden"></span></a></li>
                    <li data-role="حارس أمن"><a href="/my-schedule" data-page="page-my-schedule"><i class="ph-fill ph-calendar"></i><span>جدولي</span></a></li>
                    <li data-role="مشرف"><a href="/my-visits" data-page="page-my-visits"><i class="ph-fill ph-car"></i><span>الزيارات الميدانية</span></a></li>
                    <li data-role="ادارة العمليات,ادارة الموارد البشرية,ادارة العقود,المالية,التسويق,الشؤون القانونية,ادارة العهد,مدير النظام">
                        <a href="/finance/new-request" data-page="page-finance-new-request">
                            <i class="ph-fill ph-currency-dollar-simple"></i><span>طلب صرف</span>
                        </a>
                    </li>
                    <li data-permission="is_cfo" class="manager-only-tab">
                    <a href="/finance/cfo-approvals" data-page="page-cfo-approvals">
                        <i class="ph-fill ph-signature"></i><span>موافقات المدير المالي</span>
                        <span class="menu-badge hidden"></span>
                    </a>
                </li>
                <li data-permission="is_ceo" class="manager-only-tab">
                    <a href="/finance/ceo-approvals" data-page="page-ceo-approvals">
                        <i class="ph-fill ph-seal-check"></i><span>موافقات المدير التنفيذي</span>
                        <span class="menu-badge hidden"></span>
                    </a>
                </li>
                <li data-permission="is_auditor" class="manager-only-tab">
                    <a href="/finance/auditor-approvals" data-page="page-auditor-approvals">
                        <i class="ph-fill ph-file-magnifying-glass"></i><span>موافقات المدقق المالي</span>
                        <span class="menu-badge hidden"></span>
                    </a>
                </li>
                <li data-role="المالية">
                    <a href="/finance/ready-to-pay" data-page="page-finance-ready-to-pay">
                        <i class="ph-fill ph-printer"></i><span>أوامر الصرف الجاهزة</span>
                        <span class="menu-badge hidden"></span>
                    </a>
                </li>
                <li data-role="المالية">
                    <a href="/finance/archive" data-page="page-finance-archive">
                        <i class="ph-fill ph-archive-box"></i><span>أرشيف الطلبات المالية</span>
                    </a>
                </li>
                    <li data-role="all"><a href="/my-profile" data-page="page-my-profile"><i class="ph-fill ph-user-gear"></i><span>ملفي الشخصي</span></a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <a href="#" id="logout-btn" class="btn btn-logout"><i class="ph-fill ph-sign-out"></i><span>تسجيل الخروج</span></a>
            </div>
        </aside>

        <main class="main-content">
            <div id="announcement-banner" class="hidden"></div>
            <header class="main-header">
    <button id="menu-toggle-btn" class="btn-action"></button>
    <h2 id="main-title">نظام اركانات الالكتروني</h2>
                <div class="user-profile">
    <span>مرحباً، يزيد الصايل</span>
    
    <div id="notification-bell-container" class="notification-bell">
        <button id="notification-bell-btn" class="btn-action" title="الإشعارات">
            <i class="ph-bold ph-bell-simple"></i>
            <span id="notification-count-badge" class="notification-badge hidden">0</span>
        </button>
        <div id="notification-dropdown" class="notification-list hidden">
            <div class="notification-list-header">الإشعارات</div>
            <div id="notification-list-content">
                <p style="padding: 15px; text-align: center;">لا توجد إشعارات جديدة.</p>
            </div>
        </div>
    </div>
    <a href="#" id="enable-notifications-btn" class="btn-action" title="تفعيل الإشعارات" style="display: none;">
        <i class="ph-bold ph-bell-simple-ringing"></i>
    </a>
    <button id="open-feedback-modal-btn" class="btn-action" title="إرسال شكوى أو اقتراح">
        <i class="ph-bold ph-chat-teardrop-dots"></i>
    </button>
    <a href="#" id="logout-btn-mobile" class="btn-action">
        <i class="ph-bold ph-sign-out"></i>
    </a>
    <i class="ph-fill ph-user-circle"></i>
</div>
            </header>
            
            <div class="content-area">
                
                    <div id="page-my-profile" class="page-content hidden">
    <div class="page-header">
        <h3>ملفي الشخصي وإعدادات الحساب</h3>
    </div> 
    <div id="guard-info-container" class="review-request-card hidden" style="max-width: 800px; margin-bottom: 30px;">
    <div class="review-request-header status-approved" style="color: var(--text-primary);">
        <h4>بياناتي الوظيفية</h4>
    </div>
    <div class="review-request-body">
        <div class="request-meta-grid" style="grid-template-columns: 1fr 1fr; gap: 20px;">
            <div class="request-meta-item"><i class="ph-bold ph-user"></i><span><strong>الاسم:</strong> <span id="profile-name">-</span></span></div>
            <div class="request-meta-item"><i class="ph-bold ph-identification-card"></i><span><strong>رقم الهوية:</strong> <span id="profile-id-number">-</span></span></div>
            <div class="request-meta-item"><i class="ph-bold ph-money"></i><span><strong>الراتب الإجمالي:</strong> <span id="profile-total-salary">-</span></span></div>
            <div class="request-meta-item"><i class="ph-bold ph-bank"></i><span><strong>اسم البنك:</strong> <span id="profile-bank-name">-</span></span></div>
            <div class="request-meta-item" style="grid-column: 1 / -1;"><i class="ph-bold ph-credit-card"></i><span><strong>رقم الآيبان:</strong> <span id="profile-iban">-</span></span></div>
            <hr style="grid-column: 1 / -1; margin: 5px 0; border-color: var(--border-color);">
            <div class="request-meta-item"><i class="ph-bold ph-briefcase"></i><span><strong>المشروع:</strong> <span id="profile-project">-</span></span></div>
            <div class="request-meta-item"><i class="ph-bold ph-map-pin"></i><span><strong>الموقع:</strong> <span id="profile-location">-</span></span></div>
        </div>
    </div>
</div>
    <div class="attendance-card" style="max-width: 600px; margin: 0;">
        <h4>تغيير كلمة المرور</h4>
        <div class="form-group">
            <label for="new-password">كلمة المرور الجديدة</label>
            <div class="password-wrapper">
                <input type="password" id="new-password" placeholder="يجب أن تكون 6 أحرف على الأقل">
                <i class="ph-bold ph-eye-slash toggle-password"></i>
            </div>
        </div>
        <div class="form-group">
            <label for="confirm-new-password">تأكيد كلمة المرور الجديدة</label>
            <div class="password-wrapper">
                <input type="password" id="confirm-new-password">
                <i class="ph-bold ph-eye-slash toggle-password"></i>
            </div>
        </div>
        <div style="text-align: left; margin-top: 20px;">
            <button id="change-password-btn" class="btn btn-primary">تحديث كلمة المرور</button>
        </div>
    </div>
</div>
<div id="page-requests-archive" class="page-content hidden">
    <div class="page-header">
        <h3>أرشيف الطلبات</h3>
    </div>
    <div class="tabs">
        <a href="#" class="tab-link active" data-tab="archive-leave-tab"><i class="ph-bold ph-calendar-blank"></i> الإجازات</a>
        <a href="#" class="tab-link" data-tab="archive-loan-tab"><i class="ph-bold ph-hand-coins"></i> السلف</a>
        <a href="#" class="tab-link" data-tab="archive-resignation-tab"><i class="ph-bold ph-file-x"></i> الاستقالات</a>
    </div>

    <div id="archive-leave-tab" class="tab-content active">
        <p style="text-align: center; padding-top: 20px;">جاري تحميل أرشيف الإجازات...</p>
    </div>
    <div id="archive-loan-tab" class="tab-content">
        <p style="text-align: center; padding-top: 20px;">جاري تحميل أرشيف السلف...</p>
    </div>
    <div id="archive-resignation-tab" class="tab-content">
        <p style="text-align: center; padding-top: 20px;">جاري تحميل أرشيف الاستقالات...</p>
    </div>
</div>
<div id="page-penalties" class="page-content hidden">
    <div class="page-header">
        <h3>العقوبات والخصومات</h3>
    </div>

    <div class="tabs">
        <a href="#" class="tab-link active" data-tab="penalties-hr-review-tab"><i class="ph-bold ph-hourglass-high"></i> اعتماد الغيابات</a>
        <a href="#" class="tab-link" data-tab="penalties-hr-permission-tab"><i class="ph-bold ph-clock-countdown"></i> مراجعة الاستئذانات</a>
        <a href="#" class="tab-link" data-tab="penalties-hr-archive-tab"><i class="ph-bold ph-archive"></i> ارشيف الغيابات</a>
        <a href="#" class="tab-link" data-tab="penalties-log-tab"><i class="ph-bold ph-scales"></i> سجل الخصومات اليدوية</a>
    </div>

    <div id="penalties-hr-review-tab" class="tab-content active">
       <div id="hr-review-list-container" class="absence-review-list" style="padding-top: 20px;">
            <p style="text-align: center;">جاري تحميل الغيابات المعلقة للمراجعة...</p>
        </div>
    </div>

    <div id="penalties-hr-permission-tab" class="tab-content">
       <div id="hr-permission-review-container" class="all-requests-container" style="padding-top: 20px;">
            <p style="text-align: center;">جاري تحميل الاستئذانات المعلقة للمراجعة...</p>
        </div>
    </div>
    <div id="penalties-hr-archive-tab" class="tab-content">
        <div class="report-filters-card" style="margin-bottom: 20px;">
            <div class="filter-group">
                <label for="hr-absence-archive-search">بحث بالحارس (الاسم أو الهوية)</label>
                <div class="custom-select-wrapper">
                    <input type="text" id="hr-absence-archive-search" class="custom-select-search" placeholder="ابحث لاختيار حارس...">
                    <div id="hr-absence-archive-options" class="custom-select-options"></div>
                </div>
                <input type="hidden" id="hr-absence-archive">
            </div>
        </div>
        <div id="hr-archive-list-container" class="table-container">
            <p style="text-align: center;">جاري تحميل آخر 50 سجل غياب معتمد...</p>
        </div>
    </div>

    <div id="penalties-log-tab" class="tab-content">
        <div class="penalties-layout" style="height: auto;">
            <aside class="penalties-sidebar">
                <div class="filter-group">
                    <label>بحث بالاسم أو الهوية</label>
                    <input type="text" id="hr-filter-search-penalties" class="hr-filter-control" placeholder="اكتب للبحث عن حارس...">
                </div>
                <div id="penalties-employee-list" class="hiring-list">
                    <p style="text-align: center;">جاري تحميل قائمة الحراس...</p>
                </div>
            </aside>
            <section id="penalties-content" class="penalties-content">
                <div id="penalties-placeholder">
                    <p><i class="ph-bold ph-arrow-bend-up-left"></i> اختر حارساً من القائمة على اليمين.</p>
                </div>
                <div id="penalties-details-container" class="hidden">
                    <div class="review-request-card">
                        <div class="review-request-header">
                            <h4 id="penalty-details-header">سجل العقوبات لـ: </h4>
                        </div>
                        <div id="penalty-history-container" class="review-request-body">
                            </div>
                    </div>
                    <div class="review-request-card" style="margin-top: 20px;">
                         <div class="review-request-header status-denied">
                            <h4><i class="ph-bold ph-plus-circle"></i> إضافة خصم يدوي جديد</h4>
                        </div>
                        <div id="penalty-form-container" class="review-request-body">
                            </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
    </div>

<div id="page-announcements" class="page-content hidden">
    <div class="page-header">
        <h3>إدارة الإعلانات</h3>
    </div>

    <div class="review-request-card" style="margin-bottom: 30px;">
        <form id="announcement-form">
            <input type="hidden" id="announcement-id">
            <div class="review-request-header status-pending" style="color: var(--text-primary);">
                <h4>إنشاء / تعديل إعلان</h4>
            </div>
            <div class="review-request-body">
                    <div class="form-group">
                        <label for="announcement-title">عنوان الإعلان (سيظهر كعنوان للإشعار)</label>
                        <input type="text" id="announcement-title" placeholder="مثال: تذكير هام بخصوص الحضور" required>
                    </div>
                    <div class="form-group">
                        <label for="announcement-content">محتوى الإعلان</label>
                        <textarea id="announcement-content" rows="3" placeholder="اكتب هنا رسالة الإعلان التي ستظهر للجميع..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label>القسم المستهدف</label>
                        <div class="checkbox-group-container">
                            <div class="checkbox-grid" style="grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));">
                                <label><input type="checkbox" name="ann_target" value="all" checked> الكل</label>
                                <label><input type="checkbox" name="ann_target" value="حارس أمن"> حراس الأمن</label>
                                <label><input type="checkbox" name="ann_target" value="مشرف"> المشرفين</label>
                                <label><input type="checkbox" name="ann_target" value="ادارة العمليات"> إدارة العمليات</label>
                                <label><input type="checkbox" name="ann_target" value="ادارة الموارد البشرية"> الموارد البشرية</label>
                                <label><input type="checkbox" name="ann_target" value="المالية"> المالية</label>
                                <label><input type="checkbox" name="ann_target" value="ادارة العقود"> العقود</label>
                                <label><input type="checkbox" name="ann_target" value="التسويق"> التسويق</label>
                                <label><input type="checkbox" name="ann_target" value="الشؤون القانونية"> القانونية</label>
                            </div>
                        </div>
                        <small style="color: var(--text-secondary);">ملاحظة: عند اختيار "الكل"، سيظهر الإعلان للجميع بغض النظر عن الخيارات الأخرى.</small>
                    </div>
                <div class="form-grid" style="grid-template-columns: repeat(3, 1fr);">
                    <div class="form-group">
                        <label for="announcement-type">نوع الإعلان</label>
                        <select id="announcement-type">
                            <option value="info">معلومات (أزرق)</option>
                            <option value="warning">تحذير (أصفر)</option>
                            <option value="critical">حرج (أحمر)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="announcement-start-date">تاريخ البدء</label>
                        <input type="datetime-local" id="announcement-start-date" required>
                    </div>
                    <div class="form-group">
                        <label for="announcement-end-date">تاريخ الانتهاء</label>
                        <input type="datetime-local" id="announcement-end-date" required>
                    </div>
                </div>
            </div>
            <div class="review-request-footer">
                <button type="button" id="clear-announcement-form" class="btn btn-secondary">إلغاء التعديل</button>
                <button type="submit" id="save-announcement-btn" class="btn btn-primary"><i class="ph-bold ph-floppy-disk"></i> حفظ الإعلان</button>
            </div>
        </form>
    </div>

    <div class="page-header" style="border: none; padding-bottom: 0;">
        <h3>الإعلانات الحالية والمجدولة</h3>
    </div>
    <div id="announcements-list-container">
        <p style="text-align: center;">جاري تحميل الإعلانات...</p>
    </div>
</div>



<div id="page-user-management" class="page-content hidden">
    <div class="page-header">
    <h3>إدارة المستخدمين</h3>
    <button id="admin-add-user-btn" class="btn btn-primary"><i class="ph-bold ph-plus"></i> إضافة موظف إداري</button>
</div>

<div class="report-filters-card" style="margin-bottom: 20px;">
    <div class="filter-grid" style="grid-template-columns: 2fr 1fr; align-items: end;">
        <div class="filter-group">
            <label for="user-mgmt-search">بحث (الاسم, الهوية, الجوال)</label>
            <input type="text" id="user-mgmt-search" class="user-mgmt-filter" placeholder="اكتب للبحث...">
        </div>
        <div class="form-group" style="margin-bottom: 0;">
            <label class="toggle-switch" style="justify-content: flex-start;">
                <input type="checkbox" id="user-mgmt-toggle-guards" class="user-mgmt-filter">
                <span class="slider"></span>
                <span class="label-text" style="color: var(--text-primary); font-weight: 600;">إظهار الحراس والمشرفين</span>
            </label>
        </div>
    </div>
</div>
    <div class="table-container">
        <div id="user-management-table-container">
            <p style="text-align: center;">جاري تحميل قائمة المستخدمين...</p>
        </div>
    </div>
</div>

<div id="page-manage-system" class="page-content hidden" data-department="مدير النظام">
    <div class="page-header"><h3>إدارة صلاحيات مدراء النظام</h3></div>
    <div class="table-container" id="manage-system-container"></div>
</div>

<div id="page-admin-staff" class="page-content hidden">
    <div class="table-container">
        <div class="page-header" style="padding:0; border:0; margin-bottom:20px;">
            <h3>قائمة موظفي الإدارة</h3>
            <button id="add-admin-staff-btn" class="btn btn-primary"><i class="ph-bold ph-plus"></i> إضافة موظف إداري</button>
        </div>
        <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-bottom: 25px;">
            <div class="stat-card-mini" style="--stat-color: #3b82f6;">
                <i class="ph-bold ph-users-three"></i>
                <div>
                    <h4 id="admin-stats-total">0</h4>
                    <p>إجمالي الموظفين</p>
                </div>
            </div>
            <div class="stat-card-mini" style="--stat-color: #f59e0b;">
                <i class="ph-bold ph-buildings"></i>
                <div>
                    <h4 id="admin-stats-departments">0</h4>
                    <p>الأقسام الفعالة</p>
                </div>
            </div>
            <div class="stat-card-mini" style="--stat-color: #10b981;">
                <i class="ph-bold ph-storefront"></i>
                <div>
                    <h4 id="admin-stats-branches">0</h4>
                    <p>عدد الفروع</p>
                </div>
            </div>
        </div>
        <div class="report-filters-card" style="margin-bottom: 20px;">
            <div class="filter-grid" style="grid-template-columns: 1fr 1fr;">
                <div class="filter-group">
                    <label>بحث بالاسم أو رقم الهوية</label>
                    <input type="text" id="admin-staff-search-input" class="admin-staff-filter" placeholder="اكتب هنا للبحث...">
                </div>
                <div class="filter-group">
                    <label>فلترة حسب الدور</label>
                    <select id="admin-staff-role-filter" class="admin-staff-filter">
                        <option value="">كل الأدوار الإدارية</option>
                        <option value="ادارة العمليات">ادارة العمليات</option>
                        <option value="ادارة الموارد البشرية">ادارة الموارد البشرية</option>
                        <option value="ادارة العقود">ادارة العقود</option>
                        <option value="المالية">المالية</option>
                        <option value="التسويق">التسويق</option>
                        <option value="الشؤون القانونية">الشؤون القانونية</option>
                        <option value="مدير النظام">مدير النظام</option>
                        <option value="ادارة العهد">ادارة العهد</option>
                    </select>
                </div>
            </div>
        </div>
        <div id="admin-staff-list-container">
            <p style="text-align: center;">جاري تحميل الموظفين...</p>
        </div>
    </div>
</div>
<div id="page-manage-ops" class="page-content hidden" data-department="ادارة العمليات">
    <div class="page-header"><h3>إدارة صلاحيات قسم العمليات</h3></div>
    <div class="table-container" id="manage-ops-container"></div>
</div>
<div id="page-manage-hr" class="page-content hidden" data-department="ادارة الموارد البشرية">
    <div class="page-header"><h3>إدارة صلاحيات قسم الموارد البشرية</h3></div>
    <div class="table-container" id="manage-hr-container"></div>
</div>
<div id="page-manage-contracts" class="page-content hidden" data-department="ادارة العقود">
    <div class="page-header"><h3>إدارة صلاحيات قسم العقود</h3></div>
    <div class="table-container" id="manage-contracts-container"></div>
</div>
<div id="page-manage-finance" class="page-content hidden" data-department="المالية">
    <div class="page-header"><h3>إدارة صلاحيات القسم المالي</h3></div>
    <div class="table-container" id="manage-finance-container"></div>
</div>
<div id="page-manage-marketing" class="page-content hidden" data-department="التسويق">
    <div class="page-header"><h3>إدارة صلاحيات قسم التسويق</h3></div>
    <div class="table-container" id="manage-marketing-container"></div>
</div>
<div id="page-manage-legal" class="page-content hidden" data-department="الشؤون القانونية">
    <div class="page-header"><h3>إدارة صلاحيات قسم الشؤون القانونية</h3></div>
    <div class="table-container" id="manage-legal-container"></div>
</div>


<div id="page-official-holidays" class="page-content hidden">
    <div class="page-header">
        <h3>إدارة العطلات الرسمية</h3>
    </div>
    <div class="holidays-layout-grid">
        <div class="hiring-column">
            <h4><i class="ph-bold ph-plus-circle"></i> إضافة عطلة جديدة</h4>
            <div class="review-request-card">
                <div class="review-request-body">
                    <div class="form-group">
                        <label for="holiday-date">تاريخ العطلة</label>
                        <input type="date" id="holiday-date">
                    </div>
                    <div class="form-group">
                        <label for="holiday-description">وصف العطلة (مثال: عيد الفطر)</label>
                        <input type="text" id="holiday-description" placeholder="اكتب اسم العطلة أو المناسبة">
                    </div>
                    <button id="add-holiday-btn" class="btn btn-primary" style="width: 100%; margin-top: 10px;">إضافة العطلة</button>
                </div>
            </div>
        </div>
        <div class="hiring-column">
            <h4><i class="ph-bold ph-calendar"></i> العطلات المسجلة</h4>
            <div id="holidays-list-container" class="hiring-list">
                <p style="text-align: center;">جاري تحميل العطلات...</p>
            </div>
        </div>
    </div>
</div>

<div id="page-hr-data-entry" class="page-content hidden">
    <div class="page-header">
        <h3>الإدخال الجماعي للموظفين الجدد</h3>
    </div>

    <div class="review-request-card" style="margin-bottom: 30px;">
        <div class="review-request-header status-pending" style="color: var(--text-primary);">
            <h4>الخطوة 1: تحميل قالب الإدخال</h4>
        </div>
        <div class="review-request-body" style="text-align: center;">
            <p style="font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 20px;">
                يرجى تحميل قالب Excel الرسمي، وتعبئته ببيانات الموظفين الجدد، ثم رفعه في الخطوة الثانية.
            </p>
            <button id="download-template-btn" class="btn btn-primary btn-lg">
                <i class="ph-bold ph-download-simple"></i> تحميل القالب
            </button>
        </div>
    </div>

    <div class="review-request-card">
        <div class="review-request-header status-approved" style="color: var(--text-primary);">
            <h4>الخطوة 2: رفع الملف ومعالجة البيانات</h4>
        </div>
        <div class="review-request-body" style="text-align: center;">
            <button id="upload-employees-file-btn" class="btn btn-success btn-lg">
                <i class="ph-bold ph-upload-simple"></i> اختيار ورفع ملف Excel
            </button>
            <input type="file" id="employees-file-input" accept=".xlsx" style="display: none;">

            <div id="import-results-container" style="margin-top: 25px; text-align: right;"></div>
        </div>
    </div>
</div>

<div id="page-admin-dashboard" class="page-content hidden">
    <div class="page-header">
        <h3>لوحة تحكم مدير النظام</h3>
    </div>
    <div class="tabs">
        <a href="#" class="tab-link active" data-tab="admin-audit-log"><i class="ph-bold ph-list-dashes"></i> سجل الأحداث</a>
        <a href="#" class="tab-link" data-tab="admin-feedback"><i class="ph-bold ph-chat-teardrop-dots"></i> الشكاوى والاقتراحات</a>
        <a href="#" class="tab-link" data-tab="admin-error-log"><i class="ph-bold ph-bug"></i> سجل الأخطاء</a>
        <a href="#" class="tab-link" data-tab="admin-archive"><i class="ph-bold ph-archive"></i> أرشيف الموظفين</a> 
    </div>

    <div id="admin-audit-log" class="tab-content active">
        <div class="report-filters-card" style="margin-bottom: 20px;">
            <div class="filter-grid" style="grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));">
                <div class="filter-group"><label>بحث بالاسم أو الهوية</label><input type="text" id="audit-search-input" placeholder="اكتب هنا للبحث..."></div>
                <div class="filter-group"><label>فلترة حسب الإجراء</label><select id="audit-action-filter"><option value="">كل الإجراءات</option><option value="تسجيل دخول ناجح">تسجيل دخول</option><option value="تسجيل حضور">تسجيل حضور</option><option value="تسجيل اكمل المناوبة">تسجيل انصراف</option><option value="تسجيل انسحاب">تسجيل انسحاب</option><option value="إضافة مستخدم جديد">إضافة مستخدم</option><option value="تحديث بيانات مستخدم">تحديث مستخدم</option><option value="حذف مستخدم">حذف مستخدم</option><option value="إنشاء عقد جديد">إنشاء عقد</option><option value="تحديث طلب توظيف">تحديث طلب توظيف</option><option value="إضافة خصم/عقوبة">إضافة خصم</option><option value="تقديم طلب جديد">تقديم طلب</option><option value="توليد مسير الرواتب">توليد مسير</option></select></div>
                <div class="filter-group"><label>فلترة حسب الدور (Role)</label><select id="audit-role-filter"><option value="">كل الأدوار</option><option value="مدير النظام">مدير النظام</option><option value="ادارة العمليات">ادارة العمليات</option><option value="مشرف">مشرف</option><option value="حارس أمن">حارس أمن</option></select></div>
                <div class="filter-group" style="align-items: flex-end;"><button id="audit-search-btn" class="btn btn-primary" style="width: 100%;">بحث وتصفية</button></div>
            </div>
        </div>
        <div id="admin-audit-log-container" class="log-container">
            <p style="text-align: center;">جاري تحميل سجل الأحداث...</p>
        </div>
    </div>

    <div id="admin-feedback" class="tab-content">
        <div id="admin-feedback-container" class="log-container">
            <p style="text-align: center;">سيتم عرض الشكاوى والاقتراحات هنا...</p>
        </div>
    </div>

    <div id="admin-error-log" class="tab-content">
        <div id="admin-error-log-container" class="log-container">
            <p style="text-align: center;">سيتم عرض سجل الأخطاء التقنية هنا...</p>
        </div>
    </div>
    <div id="admin-archive" class="tab-content">
    <div class="report-filters-card" style="margin-bottom: 20px; margin-top: 20px;">
        <div class="filter-grid" style="grid-template-columns: 1fr;">
            <div class="filter-group">
                <label>بحث بالاسم أو رقم الهوية</label>
                <input type="text" id="archive-search-input" placeholder="اكتب هنا للبحث في الأرشيف...">
            </div>
        </div>
    </div>
    <div id="admin-archive-container" style="margin-top: 20px;">
        <p style="text-align: center;">جاري تحميل الأرشيف...</p>
    </div>
</div>
</div>
                <div id="page-geo" class="page-content hidden" style="position: relative; padding: 0; display: flex; flex-direction: column;">
    <div class="map-stats-bar">
        <div class="map-stat-card">
            <div class="stat-icon" style="background-color: #22c55e20; color: #22c55e;"><i class="ph-bold ph-user-circle-check"></i></div>
            <div>
                <h4>الحضور الحالي</h4>
                <p><span id="map-stats-present">0</span> / <span id="map-stats-scheduled">0</span></p>
            </div>
        </div>
        <div class="map-stat-card">
            <div class="stat-icon" style="background-color: #3b82f620; color: #3b82f6;"><i class="ph-bold ph-shield-check"></i></div>
            <div>
                <h4>حراس التغطيات</h4>
                <p id="map-stats-coverage">0</p>
            </div>
        </div>
        <div class="map-stat-card">
            <div class="stat-icon" style="background-color: #ef444420; color: #ef4444;"><i class="ph-bold ph-user-circle-minus"></i></div>
            <div>
                <h4>الغياب</h4>
                <p id="map-stats-absent">0</p>
            </div>
        </div>
        <div class="map-stat-card">
            <div class="stat-icon" style="background-color: #6366f120; color: #6366f1;"><i class="ph-bold ph-arrow-fat-line-left"></i></div>
            <div>
                <h4>انسحاب</h4>
                <p id="map-stats-withdrawal">0</p>
            </div>
        </div>
        <div class="map-stat-card">
            <div class="stat-icon" style="background-color: #a855f720; color: #a855f7;"><i class="ph-bold ph-user-switch"></i></div>
            <div>
                <h4>استئذان</h4>
                <p id="map-stats-permission">0</p>
            </div>
        </div>
        <div class="map-stat-card">
            <div class="stat-icon" style="background-color: #ef444420; color: #ef4444;"><i class="ph-bold ph-user-circle-plus"></i></div>
            <div>
                <h4>الشواغر المفتوحة</h4>
                <p id="map-stats-vacancies">0</p>
            </div>
        </div>

        <div id="map-search-container">
            <input type="text" id="map-search-input" placeholder="ابحث باسم الحارس...">
            <button id="map-search-btn" class="btn btn-primary" style="padding: 8px 12px;"><i class="ph-bold ph-magnifying-glass"></i></button>
        </div>
    </div>
    <div class="report-filters-card" style="border-radius: 0; box-shadow: none; border-bottom: 1px solid var(--border-color); padding: 15px 25px;">
        <div class="filter-grid" style="grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));">
            <div class="filter-group">
                <label>المنطقة</label>
                <select id="geo-filter-region" class="geo-filter-control cascading-filter-geo" data-target="geo-filter-city">
                    <option value="">كل المناطق</option>
                </select>
            </div>
            <div class="filter-group">
                <label>المدينة</label>
                <select id="geo-filter-city" class="geo-filter-control cascading-filter-geo" data-target="geo-filter-project" disabled>
                    <option value="">اختر منطقة أولاً</option>
                </select>
            </div>
            <div class="filter-group">
                <label>المشروع</label>
                <select id="geo-filter-project" class="geo-filter-control cascading-filter-geo" data-target="geo-filter-location" disabled>
                    <option value="">اختر مدينة أولاً</option>
                </select>
            </div>
            <div class="filter-group">
                <label>الموقع</label>
                <select id="geo-filter-location" class="geo-filter-control" disabled>
                    <option value="">اختر مشروعاً أولاً</option>
                </select>
            </div>
        </div>
    </div>
    <div id="map" style="flex-grow: 1; width: 100%;"></div>
</div>
                <div id="page-schedules" class="page-content hidden"><p>محتوى صفحة الجداول والمناوبات هنا.</p></div>
                <div id="page-coverage" class="page-content hidden">
    <div class="page-header">
        <h3>إدارة ومتابعة التغطيات</h3>
        <button id="add-manual-coverage-btn" class="btn btn-primary">
            <i class="ph-bold ph-plus-circle"></i> إنشاء تغطية يدوية
        </button>
    </div>

    <div class="kanban-board">
        <div class="kanban-column">
            <div class="kanban-column-header">
                <h4><i class="ph-bold ph-warning-circle"></i> الاحتياجات الجديدة</h4>
            </div>
            <div class="kanban-column-content" id="coverage-needs-column">
                <p style="text-align: center; padding: 20px;">جاري تحميل الاحتياجات...</p>
            </div>
        </div>

        <div class="kanban-column">
            <div class="kanban-column-header">
                <h4><i class="ph-bold ph-shield-check"></i> فرص متاحة</h4>
            </div>
            <div class="kanban-column-content" id="coverage-open-column">
                <p style="text-align: center; padding: 20px;">جاري تحميل الفرص...</p>
            </div>
        </div>

        <div class="kanban-column">
            <div class="kanban-column-header">
                <h4><i class="ph-bold ph-users"></i> تحت المراجعة</h4>
            </div>
            <div class="kanban-column-content" id="coverage-review-column">
                <p style="text-align: center; padding: 20px;">جاري تحميل الطلبات...</p>
            </div>
        </div>

        <div class="kanban-column">
            <div class="kanban-column-header">
                <h4><i class="ph-bold ph-user-circle-check"></i> تم التسكين</h4>
            </div>
            <div class="kanban-column-content" id="coverage-filled-column">
                <p style="text-align: center; padding: 20px;">جاري تحميل...</p>
            </div>
        </div>
    </div>
</div>

                <div id="page-visits" class="page-content hidden"><p>محتوى صفحة الزيارات هنا.</p></div>
                <div id="page-reports" class="page-content hidden"><p>محتوى صفحة التقارير هنا.</p></div>
<div id="page-contracts" class="page-content hidden">
    <div class="page-header">
        <h3>إدارة العقود</h3>
        <div style="display: flex; gap: 10px;">
            <button id="import-contracts-btn" class="btn btn-success"><i class="ph-bold ph-file-xls"></i> استيراد من ملف</button>
            <input type="file" id="contract-import-input" accept=".xlsx" style="display: none;">
            <button id="add-contract-btn" class="btn btn-primary"><i class="ph-bold ph-plus"></i> <span>إضافة عقد جديد</span></button>
        </div>
    </div>

    <div id="contract-import-results-container" style="margin-bottom: 30px;"></div>
<div class="report-filters-card" style="margin-bottom: 20px;">
    <div class="filter-grid" style="grid-template-columns: 1fr;">
        <div class="filter-group">
            <label>بحث باسم العميل (المشروع)</label>
            <input type="text" id="contract-filter-search" class="contract-filter-control" placeholder="اكتب اسم العميل للبحث...">
        </div>
    </div>
</div>
    <div id="contracts-list-container">
        <p style="text-align: center;">جاري تحميل العقود...</p>
    </div>
</div>

                <div id="page-vacancies" class="page-content hidden">
    <div class="page-header">
        <h3>إدارة الشواغر</h3>
    </div>
    <div class="stats-grid" style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));">
    <div class="stat-card-mini" style="--stat-color: #3b82f6;">
        <i class="ph-bold ph-file-text"></i>
        <div><h4 id="hr-stats-required">0</h4><p>إجمالي المطلوب بالعقود</p></div>
    </div>
    <div class="stat-card-mini" style="--stat-color: #16a34a;">
        <i class="ph-bold ph-users"></i>
        <div><h4 id="hr-stats-assigned">0</h4><p>الموظفون المعينون</p></div>
    </div>
    <div class="stat-card-mini" style="--stat-color: #ef4444;">
        <i class="ph-bold ph-warning-circle"></i>
        <div><h4 id="hr-stats-gap">0</h4><p>العجز بالموظفين</p></div>
    </div>
</div>

    <div class="report-filters-card" style="margin-bottom: 20px;">
        <div class="filter-grid" style="grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));">
            <div class="filter-group">
                <label>المنطقة</label>
                <select id="vc-filter-region" class="vc-filter-control cascading-filter-vc" data-target="vc-filter-city">
                    <option value="">كل المناطق</option>
                </select>
            </div>
            <div class="filter-group">
                <label>المدينة</label>
                <select id="vc-filter-city" class="vc-filter-control cascading-filter-vc" data-target="vc-filter-project" disabled>
                    <option value="">اختر منطقة</option>
                </select>
            </div>
            <div class="filter-group">
                <label>المشروع</label>
                <select id="vc-filter-project" class="vc-filter-control cascading-filter-vc" data-target="vc-filter-location" disabled>
                    <option value="">اختر مدينة</option>
                </select>
            </div>
            <div class="filter-group">
                <label>الموقع</label>
                <select id="vc-filter-location" class="vc-filter-control" disabled>
                    <option value="">اختر مشروعاً</option>
                </select>
            </div>
            <div class="filter-group">
                <label>حالة الشاغر</label>
                <select id="vc-filter-status" class="vc-filter-control">
                    <option value="">الكل</option>
                    <option value="open">مفتوح</option>
                    <option value="closed_assigned">مغلق (معين عليه موظف)</option>
                    <option value="closed_empty">مغلق (فارغ)</option>
                </select>
            </div>
        </div>
    </div>

    <div class="table-container" style="margin-top: 30px;">
        <div class="table-header">
    <h3>قائمة الشواغر</h3>
    <div style="display: flex; gap: 10px;">
        <button id="export-vacancies-btn" class="btn btn-success">
            <i class="ph-bold ph-file-xls"></i> تصدير Excel
        </button>
        <button id="show-unlinked-vacancies-report-btn" class="btn btn-danger" data-role="مدير النظام">
        <i class="ph-bold ph-trash-simple"></i> تقرير الشواغر غير المرتبطة
    </button>
        <button id="view-available-slots-btn" class="btn btn-secondary">
            <i class="ph-bold ph-user-plus"></i> عرض الشواغر المتاحة بالعقود
        </button>
        <button id="add-vacancy-btn" class="btn btn-primary"><i class="ph-bold ph-plus"></i> إضافة شاغر جديد</button>
    </div>
</div>
        <div id="vacancies-list-container">
            <p style="text-align: center;">جاري تحميل الشواغر...</p>
        </div>
    </div>
</div>

<div id="page-employees" class="page-content hidden">
    <div class="table-container">
        <div class="page-header" style="padding:0; border:0; margin-bottom:20px;">
    <h3>قائمة الحراس والمشرفين</h3>
    <div style="display: flex; gap: 10px;">
        <button id="run-employee-data-check-btn" class="btn btn-secondary" data-role="مدير النظام">
     <i class="ph-bold ph-shield-warning"></i> تقرير مشاكل بيانات الموظفين
        </button>
        <button id="add-employee-btn" class="btn btn-primary"><i class="ph-bold ph-plus"></i> إضافة حارس/مشرف جديد</button>
    </div>
</div>
        <div class="report-filters-card" style="margin-bottom: 20px;">
    <div class="filter-grid" style="grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));">

        <div class="filter-group">
            <label>بحث بالاسم أو الهوية</label>
            <input type="text" id="employee-search-input" placeholder="ابحث..." class="hr-filter-control">
        </div>
        <div class="filter-group">
            <label>فلترة حسب الدور</label>
            <select id="employee-role-filter" class="hr-filter-control">
                <option value="">الكل</option>
                <option value="حارس أمن">حارس أمن</option>
                <option value="مشرف">مشرف</option>
            </select>
        </div>

        <div class="filter-group">
            <label>حالة الموظف</label>
            <select id="employee-status-filter" class="hr-filter-control">
                <option value="">الكل</option>
                <option value="اساسي">أساسي</option>
                <option value="بديل راحة">بديل راحة</option>
                <option value="تغطية">تغطية</option>
                <option value="اجازة">إجازة</option>
            </select>
        </div>
        <div class="filter-group">
            <label>حالة التسكين</label>
            <select id="employee-assignment-filter" class="hr-filter-control">
                <option value="">الكل</option>
                <option value="assigned">مسكن (مرتبط بشاغر)</option>
                <option value="unassigned">غير مسكن (حر)</option>
            </select>
        </div>

        <div class="filter-group">
            <label>المنطقة</label>
            <select id="hr-filter-region-employees" class="hr-filter-control cascading-filter" data-target="hr-filter-city-employees">
                <option value="">الكل</option>
            </select>
        </div>
        <div class="filter-group">
            <label>المدينة</label>
            <select id="hr-filter-city-employees" class="hr-filter-control cascading-filter" data-target="hr-filter-project-employees" disabled>
                <option value="">اختر منطقة أولاً</option>
            </select>
        </div>
        <div class="filter-group">
            <label>المشروع</label>
            <select id="hr-filter-project-employees" class="hr-filter-control cascading-filter" data-target="hr-filter-location-employees" disabled>
                <option value="">اختر مدينة أولاً</option>
            </select>
        </div>
        <div class="filter-group">
            <label>الموقع</label>
            <select id="hr-filter-location-employees" class="hr-filter-control" disabled>
                <option value="">اختر مشروعاً أولاً</option>
            </select>
        </div>
    </div>
</div>
        <div id="employees-list-container">
             <p style="text-align: center;">جاري تحميل الموظفين...</p>
        </div>
    </div>
</div>

<div id="page-employee-requests" class="page-content hidden">
    <div class="page-header">
        <h3>مراجعة طلبات الموظفين</h3>
    </div>
    <div id="all-requests-container">
        <p style="text-align: center;">جاري تحميل الطلبات...</p>
    </div>
</div>
<div id="page-operations-requests" class="page-content hidden">
    <div class="page-header">
        <h3>طلبات التوظيف من العمليات</h3>
    </div>
    <div id="all-operations-requests-container">
        <p style="text-align: center;">جاري تحميل طلبات التوظيف...</p>
    </div>
</div>
<div id="page-leave-requests" class="page-content hidden">
    <div class="page-header"><h3>طلبات الإجازات</h3></div>

    <div class="tabs">
        <a href="#" class="tab-link active" data-tab="hr-employee-leave-tab"><i class="ph-bold ph-users"></i> طلبات الموظفين</a>
        <a href="#" class="tab-link manager-only-tab" data-tab="hr-manager-leave-tab" data-permission="is_hr_manager"><i class="ph-bold ph-user-check"></i> بانتظار اعتماد المدير</a>
    </div>

    <div id="hr-employee-leave-tab" class="tab-content active">
        <div id="all-leave-requests-container" class="all-requests-container" style="padding-top: 20px;">
            <p style="text-align: center;">جاري تحميل طلبات الإجازات...</p>
        </div>
    </div>

    <div id="hr-manager-leave-tab" class="tab-content">
        <div id="hr-manager-leave-container" class="all-requests-container" style="padding-top: 20px;">
            <p style="text-align: center;">جاري تحميل الطلبات...</p>
        </div>
    </div>
    </div>
    <div id="page-end-of-service" class="page-content hidden">
    <div class="page-header">
        <h3>إنهاء الخدمة والمخالصة النهائية</h3>
    </div>

    <div class="tabs">
        <a href="#" class="tab-link active" data-tab="eos-new-tab">
            <i class="ph-bold ph-tray"></i> مخالصات جديدة
        </a>
        <a href="#" class="tab-link" data-tab="eos-archived-tab">
            <i class="ph-bold ph-archive-box"></i> الأرشيف
        </a>
    </div>

    <div class="report-filters-card" style="margin-bottom: 20px;">
        <div class="filter-group">
            <label>بحث شامل (الاسم، الهوية)</label>
            <input type="text" id="eos-search-input" class="form-control" placeholder="ابحث هنا...">
        </div>
    </div>

    <div id="eos-new-tab" class="tab-content active">
        <div id="eos-new-list" class="all-requests-container">
            <p style="text-align: center;">جاري تحميل المخالصات المعلقة...</p>
        </div>
    </div>

    <div id="eos-archived-tab" class="tab-content">
        <div id="eos-archived-list" class="all-requests-container">
            <p style="text-align: center;">جاري تحميل الأرشيف...</p>
        </div>
    </div>
</div>

<div id="eos-report-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 900px; width: 95%;">
        <div class="modal-header">
            <h4>تفاصيل المخالصة</h4>
            <div style="display: flex; gap: 10px;">
                <button onclick="window.print()" class="btn btn-secondary"><i class="ph-bold ph-printer"></i> طباعة</button>
                <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
            </div>
        </div>
        <div class="modal-body" id="eos-report-body">
            </div>
    </div>
</div>

<div id="page-resignation-requests" class="page-content hidden">
    <div class="page-header"><h3>طلبات الاستقالات</h3></div>

    <div class="tabs">
        <a href="#" class="tab-link active" data-tab="hr-employee-resignation-tab"><i class="ph-bold ph-users"></i> طلبات الموظفين</a>
        <a href="#" class="tab-link manager-only-tab" data-tab="hr-manager-resignation-tab" data-permission="is_hr_manager"><i class="ph-bold ph-user-check"></i> بانتظار اعتماد المدير</a>
    </div>

    <div id="hr-employee-resignation-tab" class="tab-content active">
        <div id="all-resignation-requests-container" class="all-requests-container" style="padding-top: 20px;">
            <p style="text-align: center;">جاري تحميل طلبات الاستقالات...</p>
        </div>
    </div>

    <div id="hr-manager-resignation-tab" class="tab-content">
        <div id="hr-manager-resignation-container" class="all-requests-container" style="padding-top: 20px;">
            <p style="text-align: center;">جاري تحميل الطلبات...</p>
        </div>
    </div>
    </div>

<div id="page-loan-requests" class="page-content hidden">
    <div class="page-header"><h3>طلبات السلف</h3></div>

    <div class="tabs">
        <a href="#" class="tab-link active" data-tab="hr-employee-loan-tab"><i class="ph-bold ph-users"></i> طلبات الموظفين</a>
        <a href="#" class="tab-link manager-only-tab" data-tab="hr-manager-loan-tab" data-permission="is_hr_manager"><i class="ph-bold ph-user-check"></i> بانتظار اعتماد المدير</a>
    </div>

    <div id="hr-employee-loan-tab" class="tab-content active">
        <div id="all-loan-requests-container" class="all-requests-container" style="padding-top: 20px;">
            <p style="text-align: center;">جاري تحميل طلبات السلف...</p>
        </div>
    </div>

    <div id="hr-manager-loan-tab" class="tab-content">
        <div id="hr-manager-loan-container" class="all-requests-container" style="padding-top: 20px;">
            <p style="text-align: center;">جاري تحميل الطلبات...</p>
        </div>
    </div>
    </div>
<div id="page-hr-attendance-log" class="page-content hidden">
    <div class="page-header">
    <h3>سجل حضور وانصراف الحراس</h3>
    <button id="export-hr-log-btn" class="btn btn-success">
        <i class="ph-bold ph-file-xls"></i> سحب شيت الحضور
    </button>
    </div>
    <div class="report-filters-card" style="margin-bottom: 20px;">
    <div class="filter-grid" style="grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));">
        <div class="filter-group">
            <label>بحث بالاسم أو الهوية</label>
            <input type="text" id="hr-filter-search-attlog" class="hr-filter-control" placeholder="ابحث...">
        </div>
        <div class="filter-group">
            <label>من تاريخ</label>
            <input type="date" id="att-log-date-from" class="hr-filter-control">
        </div>
        <div class="filter-group">
            <label>إلى تاريخ</label>
            <input type="date" id="att-log-date-to" class="hr-filter-control">
        </div>
        <div class="filter-group">
            <label>الحالة</label>
            <select id="hr-filter-status-attlog" class="hr-filter-control">
                <option value="">الكل</option>
                <option value="اكمل المناوبة">أكمل المناوبة</option>
                <option value="غياب">غياب</option>
                <option value="استئذان">استئذان</option>
                <option value="انسحاب">انسحاب</option>
            </select>
        </div>
        <div class="filter-group">
            <label>المنطقة</label>
            <select id="hr-filter-region-attlog" class="hr-filter-control cascading-filter">
                <option value="">كل المناطق</option>
            </select>
        </div>
        <div class="filter-group">
            <label>المدينة</label>
            <select id="hr-filter-city-attlog" class="hr-filter-control cascading-filter" disabled>
                <option value="">اختر منطقة أولاً</option>
            </select>
        </div>
        <div class="filter-group">
            <label>المشروع</label>
            <select id="hr-filter-project-attlog" class="hr-filter-control cascading-filter" disabled>
                <option value="">اختر مدينة أولاً</option>
            </select>
        </div>
        <div class="filter-group">
            <label>الموقع</label>
            <select id="hr-filter-location-attlog" class="hr-filter-control" disabled>
                <option value="">اختر مشروعاً أولاً</option>
            </select>
        </div>
    </div>
</div>

<div class="stats-grid">
    <div class="stat-card-mini" style="--stat-color: #ef4444;">
        <i class="ph-bold ph-user-circle-minus"></i>
        <div><h4 id="hr-log-stats-absent">0</h4><p>إجمالي الغياب</p></div>
    </div>
    <div class="stat-card-mini" style="--stat-color: #22c55e;">
        <i class="ph-bold ph-check-circle"></i>
        <div><h4 id="hr-log-stats-completed">0</h4><p>دوام مكتمل</p></div>
    </div>
    <div class="stat-card-mini" style="--stat-color: #a855f7;">
        <i class="ph-bold ph-user-switch"></i>
        <div><h4 id="hr-log-stats-permission">0</h4><p>إجمالي الاستئذان</p></div>
    </div>
    <div class="stat-card-mini" style="--stat-color: #6366f1;">
        <i class="ph-bold ph-arrow-fat-line-left"></i>
        <div><h4 id="hr-log-stats-withdrawal">0</h4><p>إجمالي الانسحاب</p></div>
    </div>
</div>
    <div id="hr-attendance-log-container" class="table-container">
        <p style="text-align: center;">الرجاء استخدام الفلاتر أعلاه لعرض السجلات.</p>
    </div>
</div>
<div id="page-attendance-management" class="page-content hidden">
    <div class="page-header">
        <h3>إدارة سجلات الحضور</h3>
        <button id="add-manual-record-from-mgmt-btn" class="btn btn-primary">
            <i class="ph-bold ph-plus-circle"></i> إضافة سجل يدوي
        </button>
    </div>
    <div class="report-filters-card" style="margin-bottom: 20px;">
        <div class="filter-grid" style="grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));">
            <div class="filter-group">
                <label>بحث بالاسم أو الهوية</label>
                <input type="text" id="hr-filter-search-attmgmt" class="hr-filter-control" placeholder="ابحث...">
            </div>
            <div class="filter-group">
                <label>من تاريخ</label>
                <input type="date" id="hr-filter-date-from-attmgmt" class="hr-filter-control">
            </div>
            <div class="filter-group">
                <label>إلى تاريخ</label>
                <input type="date" id="hr-filter-date-to-attmgmt" class="hr-filter-control">
            </div>
            <div class="filter-group">
                <label>الحالة</label>
                <select id="hr-filter-status-attmgmt" class="hr-filter-control">
                    <option value="">الكل</option>
                    <option value="اكمل المناوبة">أكمل المناوبة</option>
                    <option value="غياب">غياب</option>
                    <option value="استئذان">استئذان</option>
                    <option value="انسحاب">انسحاب</option>
                </select>
            </div>
            <div class="filter-group">
                <label>المنطقة</label>
                <select id="hr-filter-region-attmgmt" class="hr-filter-control cascading-filter">
                    <option value="">كل المناطق</option>
                </select>
            </div>
            <div class="filter-group">
                <label>المدينة</label>
                <select id="hr-filter-city-attmgmt" class="hr-filter-control cascading-filter" disabled>
                    <option value="">اختر منطقة أولاً</option>
                </select>
            </div>
            <div class="filter-group">
                <label>المشروع</label>
                <select id="hr-filter-project-attmgmt" class="hr-filter-control cascading-filter" disabled>
                    <option value="">اختر مدينة أولاً</option>
                </select>
            </div>
            <div class="filter-group">
                <label>الموقع</label>
                <select id="hr-filter-location-attmgmt" class="hr-filter-control" disabled>
                    <option value="">اختر مشروعاً أولاً</option>
                </select>
            </div>
        </div>
    </div>
    <div class="table-container">
        <div id="attendance-management-table-container">
            <p style="text-align: center;">استخدم الفلاتر أعلاه لعرض سجلات الحضور.</p>
        </div>
    </div>
</div>
<div id="page-payroll" class="page-content hidden">
    <div class="page-header">
        <h3>مسير الرواتب</h3>
    </div>
    <div class="report-filters-card" style="margin-bottom: 20px;">
    <div class="filter-grid" style="grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));">
        <div class="filter-group">
            <label for="payroll-start-date">من تاريخ</label>
            <input type="date" id="payroll-start-date" class="hr-filter-control">
        </div>
        <div class="filter-group">
            <label for="payroll-end-date">إلى تاريخ</label>
            <input type="date" id="payroll-end-date" class="hr-filter-control">
        </div>
        <div class="filter-group">
            <label>المنطقة</label>
            <select id="hr-filter-region-payroll" class="hr-filter-control cascading-filter" data-target="hr-filter-city-payroll">
                <option value="">كل المناطق</option>
            </select>
        </div>
        <div class="filter-group">
            <label>المدينة</label>
            <select id="hr-filter-city-payroll" class="hr-filter-control cascading-filter" data-target="hr-filter-project-payroll" disabled>
                <option value="">اختر منطقة أولاً</option>
            </select>
        </div>
        <div class="filter-group">
            <label>المشروع</label>
            <select id="hr-filter-project-payroll" class="hr-filter-control cascading-filter" data-target="hr-filter-location-payroll" disabled>
                <option value="">اختر مدينة أولاً</option>
            </select>
        </div>
        <div class="filter-group">
            <label>الموقع</label>
            <select id="hr-filter-location-payroll" class="hr-filter-control" disabled>
                <option value="">اختر مشروعاً أولاً</option>
            </select>
        </div>
        <div class="filter-group" style="align-items: flex-end;">
            <button id="generate-payroll-btn" class="btn btn-primary" style="width: 100%;">
                <i class="ph-bold ph-calculator"></i> توليد المسير
            </button>
        </div>
    </div>
</div>
    <div id="payroll-results-container" class="table-container">
        <p style="text-align: center;">الرجاء اختيار الشهر والضغط على "توليد المسير" لعرض البيانات.</p>
    </div>
</div>
<div id="page-hiring" class="page-content hidden">
    <div class="page-header">
        <h3>التوظيف وتسكين الشواغر</h3>
    </div>

    <h4><i class="ph-bold ph-briefcase"></i> الشواغر المفتوحة</h4>
    <div id="hiring-vacancies-container" class="contracts-container" style="margin-bottom: 40px;">
        <p>جاري تحميل الشواغر...</p>
    </div>

    <hr>

    <h4><i class="ph-bold ph-file-arrow-up"></i> طلبات التوظيف المقدمة</h4>
    <div id="hiring-requests-history-container">
        <p>جاري تحميل طلباتك السابقة...</p>
    </div>
</div>

<div id="page-attendance" class="page-content hidden"></div>

<div id="page-my-requests" class="page-content hidden">
    <div class="page-header">
        <h3>رفع طلب جديد</h3>
    </div>
    <div class="requests-actions-container">
        <button class="request-action-card" data-request-type="permission" style="--card-color: #0d6efd;">
            <i class="ph-fill ph-clock-countdown"></i>
            <h4>طلب استئذان</h4>
        </button>
        <button class="request-action-card" data-request-type="leave" style="--card-color: #198754;">
            <i class="ph-fill ph-calendar-blank"></i>
            <h4>طلب إجازة</h4>
        </button>
        <button class="request-action-card" data-request-type="loan" id="loan-request-btn" style="--card-color: #ffc107;">
            <i class="ph-fill ph-hand-coins"></i>
            <h4>طلب سلفة</h4>
        </button>
        <button class="request-action-card" data-request-type="resignation" style="--card-color: #dc3545;">
            <i class="ph-fill ph-file-x"></i>
            <h4>طلب استقالة</h4>
        </button>
    </div>
    <div class="page-header" style="margin-top: 40px;">
        <h3>متابعة طلباتك السابقة</h3>
    </div>
    <div id="past-requests-list">
    </div>
</div>

<div id="page-permission-requests" class="page-content hidden">
    <div class="page-header">
        <h3>طلبات الاستئذان المعلقة</h3>
    </div>
    <div id="permission-requests-container">
    </div>
</div>

<div id="page-guard-attendance" class="page-content hidden">
    <div class="map-stats-bar">
        <div class="map-stat-card">
    <div class="stat-icon" style="background-color: #22c55e20; color: #22c55e;"><i class="ph-bold ph-user-circle-check"></i></div>
    <div>
        <h4>الحضور الحالي</h4>
        <p><span id="stats-guard-present">0</span> / <span id="stats-guard-scheduled">0</span></p>
    </div>
</div>

<div class="map-stat-card">
    <div class="stat-icon" style="background-color: #3b82f620; color: #3b82f6;"><i class="ph-bold ph-shield-check"></i></div>
    <div>
        <h4>حراس التغطيات</h4>
        <p id="stats-guard-coverage">0</p>
    </div>
</div>
    <div class="map-stat-card">
        <div class="stat-icon" style="background-color: #ef444420; color: #ef4444;"><i class="ph-bold ph-user-circle-minus"></i></div>
        <div>
            <h4>غياب</h4>
            <p id="stats-guard-absent">0</p>
        </div>
    </div>
        <div class="map-stat-card">
        <div class="stat-icon" style="background-color: #6366f120; color: #6366f1;"><i class="ph-bold ph-arrow-fat-line-left"></i></div>
        <div>
            <h4>انسحاب</h4>
            <p id="stats-guard-withdrawal">0</p>
        </div>
    </div>
<div class="map-stat-card">
    <div class="stat-icon" style="background-color: #a855f720; color: #a855f7;"><i class="ph-bold ph-user-switch"></i></div>
    <div>
        <h4>استئذان</h4>
        <p id="stats-guard-permission">0</p>
    </div>
</div>
<div class="map-stat-card">
    <div class="stat-icon" style="background-color: #ef444420; color: #ef4444;"><i class="ph-bold ph-user-circle-plus"></i></div>
    <div>
        <h4>الشواغر المفتوحة</h4>
        <p id="stats-guard-vacancies">0</p>
    </div>
</div>
    <div class="map-stat-card">
        <div class="stat-icon" style="background-color: #f59e0b20; color: #f59e0b;"><i class="ph-bold ph-coffee"></i></div>
        <div>
            <h4>ورديات قادمة قريباً</h4>
            <p id="stats-guard-off">0</p>
        </div>
    </div>
</div>
    <div class="report-filters-card" style="margin-bottom: 20px; margin-top: 20px;">
    <div class="filter-grid" style="grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));">
        <div class="filter-group">
            <label>بحث بالاسم أو الهوية</label>
            <input type="text" id="ga-filter-search" class="ga-filter-control" placeholder="ابحث...">
        </div>

        <div class="filter-group">
            <label>الحالة</label>
            <select id="ga-filter-status" class="ga-filter-control">
                <option value="">الكل</option>
                <option value="حاضر">حاضر</option>
                <option value="غياب">غياب</option>
                <option value="استئذان">استئذان</option>
                <option value="انسحاب">انسحاب</option>
                <option value="في راحة">في راحة</option>
                <option value="وردية قادمة">وردية قادمة</option>
            </select>
        </div>

        

        <div class="filter-group">
            <label>المنطقة</label>
            <select id="ga-filter-region" class="ga-filter-control cascading-filter-ga" data-target="ga-filter-city">
                <option value="">كل المناطق</option>
            </select>
        </div>

        <div class="filter-group">
            <label>المدينة</label>
            <select id="ga-filter-city" class="ga-filter-control cascading-filter-ga" data-target="ga-filter-project" disabled>
                <option value="">اختر منطقة أولاً</option>
            </select>
        </div>

        <div class="filter-group">
            <label>المشروع</label>
            <select id="ga-filter-project" class="ga-filter-control cascading-filter-ga" data-target="ga-filter-location" disabled>
                <option value="">اختر مدينة أولاً</option>
            </select>
        </div>

        <div class="filter-group">
            <label>الموقع</label>
            <select id="ga-filter-location" class="ga-filter-control" disabled>
                <option value="">اختر مشروعاً أولاً</option>
            </select>
        </div>

    </div>
</div>
    <div class="page-header">
    <h3>متابعة حضور الحراس</h3>
    <div> <button id="send-to-all-guards-btn" class="btn btn-primary"><i class="ph-bold ph-users-three"></i> <span>إرسال توجيه للكل</span></button>
    </div>
</div>
    <div id="guard-attendance-container">
        <p style="text-align: center;">جاري تحميل بيانات الحضور...</p>
    </div>
</div>

<div id="page-payroll-settings" class="page-content hidden">
    <div class="page-header">
        <h3>إعدادات وضوابط المسير</h3>
        <button id="save-payroll-settings-btn" class="btn btn-success">
            <i class="ph-bold ph-floppy-disk"></i> حفظ كافة الإعدادات
        </button>
    </div>

    <div class="tabs">
        <a href="#" class="tab-link active" data-tab="conf-tab-general"><i class="ph-bold ph-gear"></i> السياسات العامة</a>
        <a href="#" class="tab-link" data-tab="conf-tab-absence"><i class="ph-bold ph-user-minus"></i> قواعد الغياب</a>
        <a href="#" class="tab-link" data-tab="conf-tab-lateness"><i class="ph-bold ph-clock-user"></i> قواعد التأخير</a>
        <a href="#" class="tab-link" data-tab="conf-tab-overtime"><i class="ph-bold ph-timer"></i> العمل الإضافي</a>
    </div>

    <div id="conf-tab-general" class="tab-content active">
        <div class="review-request-card">
            <div class="review-request-header status-pending" style="color: var(--text-primary);">
                <h4>الثوابت المالية</h4>
            </div>
            <div class="review-request-body">
                <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                    <div class="form-group">
                        <label>نسبة خصم التأمينات (موظف) %</label>
                        <input type="number" id="conf-gosi-percent" step="0.01" placeholder="9.75">
                    </div>
                    <div class="form-group">
                        <label>قيمة خصم الزي الرسمي (مرة واحدة) ر.س</label>
                        <input type="number" id="conf-uniform-deduction" placeholder="150">
                    </div>
                    <div class="form-group">
                        <label>أساس حساب اليومية</label>
                        <select id="conf-calc-days-basis">
                            <option value="30">30 يوم ثابت (الراتب / 30)</option>
                            <option value="actual">أيام الشهر الفعلي (28/30/31)</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="conf-tab-absence" class="tab-content">
        <div class="review-request-card">
            <div class="review-request-header status-denied">
                <h4>تدرج عقوبات الغياب (بدون عذر)</h4>
                <button class="btn btn-secondary btn-sm" id="add-absence-rule-btn"><i class="ph-bold ph-plus"></i> إضافة قاعدة</button>
            </div>
            <div class="review-request-body">
                <div id="absence-rules-container">
                    </div>
                <p style="color: var(--text-secondary); margin-top: 15px; font-size: 0.9rem;">* يتم تطبيق القاعدة بناءً على عدد مرات الغياب خلال السنة الحالية.</p>
            </div>
        </div>
    </div>

    <div id="conf-tab-lateness" class="tab-content">
        <div class="review-request-card">
            <div class="review-request-header status-pending" style="color: #b45309;">
                <h4>شرائح خصم التأخير</h4>
                <button class="btn btn-secondary btn-sm" id="add-lateness-rule-btn"><i class="ph-bold ph-plus"></i> إضافة شريحة</button>
            </div>
            <div class="review-request-body">
                <div id="lateness-rules-container">
                    </div>
                <p style="color: var(--text-secondary); margin-top: 15px; font-size: 0.9rem;">* يتم احتساب الخصم كنسبة من أجرة اليوم الواحد (مثلاً 0.25 تعني ربع يوم).</p>
            </div>
        </div>
    </div>

    <div id="conf-tab-overtime" class="tab-content">
        <div class="review-request-card">
            <div class="review-request-header status-approved">
                <h4>نسب احتساب الإضافي</h4>
            </div>
            <div class="review-request-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label>الساعة الإضافية في الأيام العادية تعادل (ساعة):</label>
                        <input type="number" id="conf-overtime-normal" step="0.1" placeholder="1.5">
                    </div>
                    <div class="form-group">
                        <label>الساعة الإضافية في العطلات تعادل (ساعة):</label>
                        <input type="number" id="conf-overtime-holiday" step="0.1" placeholder="2.0">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="page-patrol" class="page-content hidden">
    <div class="page-header">
        <h3>تسجيل الجولة الميدانية</h3>
    </div>
    <div class="attendance-card">
        <div id="patrol-status" class="attendance-status-text">
            <p>جاري التحقق من حالتك...</p>
        </div>
        <div id="patrol-actions">
            <button id="start-patrol-btn" class="btn btn-primary btn-lg hidden">بدء الجولة</button>
            <button id="end-patrol-btn" class="btn btn-danger btn-lg hidden">إنهاء الجولة</button>
        </div>
        <div id="location-status" class="location-status">
        </div>
    </div>
</div>


<div id="page-directives-ops" class="page-content hidden">
    <div class="page-header">
        <h3>إرسال التوجيهات</h3>
    </div>
    <div class="tabs">
        <a href="#" class="tab-link active" data-tab="ops-send-directive">إرسال توجيه</a>
        <a href="#" class="tab-link" data-tab="ops-directives-history">سجل التوجيهات المرسلة</a>
    </div>
    <div id="ops-send-directive" class="tab-content active">
        <div class="report-filters-card" style="margin-bottom: 20px;">
            <div class="filter-grid" style="grid-template-columns: 2fr 1fr;">
                <div class="filter-group">
                    <label>بحث بالاسم أو رقم الهوية</label>
                    <input type="text" id="ops-directive-search-input" placeholder="اكتب هنا للبحث...">
                </div>
                <div class="filter-group">
                    <label>فلترة حسب الدور</label>
                    <select id="ops-directive-role-filter">
                        <option value="">الكل (حراس ومشرفون)</option>
                        <option value="حارس أمن">حراس أمن فقط</option>
                        <option value="مشرف">مشرفون فقط</option>
                    </select>
                </div>
            </div>
        </div>
        <div id="ops-users-list-container" class="contracts-container">
        </div>
    </div>
    <div id="ops-directives-history" class="tab-content">
        <div id="ops-history-list-container">
        </div>
    </div>
</div>
<div id="page-my-directives" class="page-content hidden">
    <div class="page-header">
        <h3>التوجيهات</h3>
    </div>
    <div class="tabs">
        <a href="#" class="tab-link active" data-tab="incoming-directives"><i class="ph-bold ph-arrow-down-left"></i> التوجيهات الواردة</a>
        <a href="#" class="tab-link" data-tab="send-directive-from-supervisor" style="display: none;"><i class="ph-bold ph-paper-plane-tilt"></i> إرسال توجيه</a>
        <a href="#" class="tab-link" data-tab="supervisor-directives-history" style="display: none;"><i class="ph-bold ph-clock-counter-clockwise"></i> سجل الإرسال</a>
    </div>

    <div id="incoming-directives" class="tab-content active">
        <div id="my-directives-container">
        </div>
    </div>
    <div id="send-directive-from-supervisor" class="tab-content">
        <div class="report-filters-card" style="padding: 15px; margin-bottom: 20px;">
            <div class="filter-group">
                <label>بحث بالاسم أو رقم الهوية</label>
                <input type="text" id="directive-search-input" placeholder="اكتب هنا للبحث عن حارس...">
            </div>
        </div>
        <div id="supervisor-guards-list-container" class="contracts-container">
        </div>
    </div>

    <div id="supervisor-directives-history" class="tab-content">
        <div id="supervisor-history-list-container">
        </div>
    </div>
</div>
<div id="page-my-visits" class="page-content hidden">
    <div class="page-header">
        <h3>سجل زياراتي الميدانية</h3>
        <button id="add-visit-log-btn" class="btn btn-primary">
            <i class="ph-bold ph-plus-circle"></i> تسجيل زيارة جديدة
        </button>
    </div>
    <div id="my-visits-list-container">
        </div>
</div>
<div id="page-my-schedule" class="page-content hidden">
    <div class="page-header">
        <h3>جدول وردياتي</h3>
    </div>
    <div id="my-schedule-container">
        </div>
</div>
<div id="page-ops-review-requests" class="page-content hidden">
    <div class="page-header">
        <h3>مراجعة طلبات الموظفين</h3>
    </div>

    <div class="tabs">
        <a href="#" class="tab-link active" data-tab="ops-employee-requests-tab"><i class="ph-bold ph-users"></i> طلبات الموظفين</a>
        <a href="#" class="tab-link manager-only-tab" data-tab="ops-manager-review-tab" data-permission="is_ops_manager"><i class="ph-bold ph-user-check"></i> بانتظار اعتماد المدير</a>
    </div>

    <div id="ops-employee-requests-tab" class="tab-content active">
        <div id="ops-review-requests-container" class="all-requests-container" style="padding-top: 20px;">
            <p style="text-align: center;">جاري تحميل الطلبات...</p>
        </div>
    </div>

    <div id="ops-manager-review-tab" class="tab-content">
        <div id="ops-manager-review-container" class="all-requests-container" style="padding-top: 20px;">
            <p style="text-align: center;">جاري تحميل الطلبات...</p>
        </div>
    </div>
    </div>
<div id="page-supervisor-schedules" class="page-content hidden">
    <div class="page-header">
    <h3>جداول الحراس في نطاق صلاحياتك</h3>
    <button id="show-extra-guards-report-btn" class="btn btn-danger admin-only-btn hidden">
        <i class="ph-bold ph-warning-circle"></i> تقرير الحراس الزائدين
    </button>
</div>
    <div class="stats-grid" style="margin-bottom: 20px;">
    <div class="stat-card-mini" style="--stat-color: #1f2937;">
        <i class="ph-bold ph-users-three"></i>
        <div>
            <h4 id="ss-stats-total">0</h4>
            <p>إجمالي الحراس</p>
        </div>
    </div>
</div>
    <div class="report-filters-card" style="margin-bottom: 20px;">
    <div class="filter-grid" style="grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));">
        <div class="filter-group">
            <label>بحث بالاسم أو الهوية</label>
            <input type="text" id="ss-filter-search" class="ss-filter-control" placeholder="ابحث...">
        </div>
        <div class="filter-group">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <label>بداية الوردية</label>
                <button type="button" id="ss-clear-time-btn" class="btn-action" title="مسح الوقت" style="font-size: 0.8rem; color: var(--denied-color); padding: 0; border: none; background: none; cursor: pointer;">
                    <i class="ph-bold ph-x"></i> مسح
                </button>
            </div>
            <input type="time" id="ss-filter-shift-start" class="ss-filter-control">
        </div>
        <div class="filter-group">
            <label>نهاية الوردية</label>
            <input type="time" id="ss-filter-shift-end" class="ss-filter-control">
            <div style="margin-top: 5px; display: flex; align-items: center; gap: 5px;">
                <input type="checkbox" id="ss-filter-range-mode" class="ss-filter-control" style="width: auto; cursor: pointer;">
                <label for="ss-filter-range-mode" style="font-size: 0.8rem; margin: 0; cursor: pointer; color: var(--text-secondary);">الورديات في هذا النطاق</label>
            </div>
        </div>
        <div class="filter-group">
            <label>المنطقة</label>
            <select id="ss-filter-region" class="ss-filter-control cascading-filter-ss">
                <option value="">كل المناطق</option>
            </select>
        </div>
        <div class="filter-group">
            <label>المدينة</label>
            <select id="ss-filter-city" class="ss-filter-control cascading-filter-ss" disabled>
                <option value="">اختر منطقة أولاً</option>
            </select>
        </div>
        <div class="filter-group">
            <label>المشروع</label>
            <select id="ss-filter-project" class="ss-filter-control cascading-filter-ss" disabled>
                <option value="">اختر مدينة أولاً</option>
            </select>
        </div>
        <div class="filter-group">
            <label>الموقع</label>
            <select id="ss-filter-location" class="ss-filter-control" disabled>
                <option value="">اختر مشروعاً أولاً</option>
            </select>
        </div>
    </div>
</div>
    <div id="supervisor-schedules-container" class="contracts-container">
        </div>
</div>
<div id="page-supervisor-permission-requests" class="page-content hidden">
    <div class="page-header">
        <h3>مراجعة طلبات استئذان الحراس</h3>
    </div>
    <div id="supervisor-permission-requests-container" class="all-requests-container">
        </div>
</div>
<div id="page-supervisor-applications" class="page-content hidden">
    <div class="page-header">
        <h3>مراجعة المتقدمين على شواغر مشروعك</h3>
    </div>
    <div id="supervisor-applications-container">
        </div>
</div>
<div id="page-ops-nominees" class="page-content hidden">
    <div class="page-header">
        <h3>مراجعة المرشحين للتعيين</h3>
    </div>
    <div id="ops-nominees-container">
        </div>
</div>
<div id="page-hr-ops-hiring" class="page-content hidden">
    <div class="page-header">
        <h3>مراجعة التوظيفات المعتمدة من العمليات</h3>
    </div>
    <div class="tabs">
        <a href="#" class="tab-link active" data-tab="hr-new-reviews">
            <i class="ph-bold ph-bell-simple-ringing"></i> مراجعات جديدة
        </a>
        <a href="#" class="tab-link" data-tab="hr-archive-reviews">
            <i class="ph-bold ph-archive"></i> الأرشيف
        </a>
    </div>



    <div id="hr-new-reviews" class="tab-content active">
        <div id="hr-ops-hiring-new-container" class="all-requests-container" style="padding-top:20px;">
            <p style="text-align: center;">جاري تحميل المراجعات الجديدة...</p>
        </div>
    </div>
    <div id="hr-archive-reviews" class="tab-content">
        <div id="hr-ops-hiring-archive-container" class="all-requests-container" style="padding-top:20px;">
            <p style="text-align: center;">جاري تحميل الأرشيف...</p>
        </div>
    </div>
</div> <div id="page-hr-sms" class="page-content hidden">
    <div class="page-header">
        <h3>إرسال رسالة نصية (تجريبي)</h3>
    </div>
    <div class="review-request-card" style="max-width: 700px; margin: 20px auto 0;">
        <div class="review-request-body">
            <form id="hr-send-sms-form">
                <div class="form-group">
                    <label for="sms-recipient">رقم الجوال</label>
                    <input type="tel" id="sms-recipient" placeholder="مثال: 05xxxxxxx أو +966xxxxxxxxx" required>
                </div>
                <div class="form-group">
                    <label for="sms-content">نص الرسالة</label>
                    <textarea id="sms-content" rows="5" placeholder="اكتب رسالتك هنا..." required></textarea>
                </div>
                <div style="text-align: left; margin-top: 20px;">
                    <button type="submit" id="hr-submit-sms-btn" class="btn btn-primary">
                        <i class="ph-bold ph-paper-plane-right"></i> إرسال الرسالة
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
    <div id="hr-ops-hiring-container">
        </div>
        <div id="page-supervisor-custody" class="page-content hidden">
    <div class="page-header">
        <h3>عهدة التغطيات</h3>
        <div id="supervisor-custody-balance" class="stat-card-mini" style="--stat-color: #16a34a; padding: 15px; border-bottom: 4px solid var(--stat-color);">
            <i class="ph-bold ph-wallet"></i>
            <div>
                <h4 id="custody-balance-amount">جاري التحميل...</h4>
                <p>رصيد العهدة الحالي</p>
            </div>
        </div>
    </div>
    <div class="tabs">
        <a href="#" class="tab-link active" data-tab="custody-pending-payment"><i class="ph-bold ph-hourglass-high"></i> تغطيات بانتظار الصرف</a>
        <a href="#" class="tab-link" data-tab="custody-archive"><i class="ph-bold ph-archive"></i> أرشيف التغطيات</a>
    </div>

    <div id="custody-pending-payment" class="tab-content active">
        <div id="supervisor-pending-payments-container" class="all-requests-container" style="padding-top: 20px;">
            <p style="text-align: center;">جاري تحميل التغطيات المكتملة...</p>
        </div>
    </div>
    <div id="custody-archive" class="tab-content">
        <div id="supervisor-custody-archive-container" class="table-container" style="margin-top: 20px;">
            <p style="text-align: center;">جاري تحميل الأرشيف...</p>
        </div>
    </div>
</div>

<div id="page-finance-custody" class="page-content hidden">
    <div class="page-header">
        <h3>إدارة العُهد</h3>
    </div>
    <div class="tabs">
    <a href="#" class="tab-link active" data-tab="finance-supervisors-list"><i class="ph-bold ph-users-three"></i> نظرة عامة على المشرفين</a>
    <a href="#" class="tab-link" data-tab="finance-pending-reports"><i class="ph-bold ph-hourglass-high"></i> تقارير بانتظار المراجعة</a>
    <a href="#" class="tab-link" data-tab="finance-archive-reports"><i class="ph-bold ph-archive"></i> أرشيف التقارير</a>
    <a href="#" class="tab-link" data-tab="finance-disbursement-log"><i class="ph-bold ph-list-numbers"></i> سجل صرف العُهد</a>
    </div>

    <div id="finance-supervisors-list" class="tab-content active">
        <div id="finance-supervisors-container" class="table-container" style="margin-top: 20px;">
            <p style="text-align: center;">جاري تحميل بيانات المشرفين...</p>
        </div>
    </div>
    <div id="finance-pending-reports" class="tab-content">
    <div id="finance-pending-reports-container" class="all-requests-container" style="padding-top: 20px;">
        <p style="text-align: center;">جاري تحميل التقارير المستلمة...</p>
    </div>
</div>
<div id="finance-archive-reports" class="tab-content">
    <div id="finance-archive-reports-container" class="table-container" style="margin-top: 20px;">
        <p style="text-align: center;">جاري تحميل الأرشيف...</p>
    </div>
</div>
    <div id="finance-disbursement-log" class="tab-content">
        <div id="finance-disbursement-log-container" class="table-container" style="margin-top: 20px;">
            <p style="text-align: center;">جاري تحميل سجل الصرف...</p>
        </div>
    </div>
</div>
<div id="page-marketing-clients" class="page-content hidden">
    <div class="page-header">
        <h3>بيانات عملاء التسويق</h3>
    </div>
    <div class="report-filters-card" style="margin-bottom: 20px;">
        <div class="filter-grid" style="grid-template-columns: 1fr;">
            <div class="filter-group">
                <label>بحث باسم العميل أو ممثله أو رقم التواصل</label>
                <input type="text" id="marketing-client-search-input" placeholder="اكتب هنا للبحث...">
            </div>
        </div>
    </div>
    <div id="marketing-clients-container" class="contracts-container">
        <p style="text-align: center;">جاري تحميل بيانات العملاء...</p>
    </div>
</div>
<div id="page-marketing-calendar" class="page-content hidden">
    <div class="page-header">
        <h3>تقويم مواعيد التسويق</h3>
        <button id="add-marketing-event-btn" class="btn btn-primary">
            <i class="ph-bold ph-plus-circle"></i> إضافة موعد جديد
        </button>
    </div>
    <div id="calendar" style="margin-top: 20px;"></div>
    <div id="event-tooltip" class="hidden" style="position: absolute; z-index: 100; background: white; border: 1px solid #e2e8f0; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 15px; max-width: 300px;">
    </div>
</div>
<div id="page-legal-calendar" class="page-content hidden">
    <div class="page-header">
        <h3>تقويم مواعيد الشؤون القانونية</h3>
        <button id="add-legal-event-btn" class="btn btn-primary">
            <i class="ph-bold ph-plus-circle"></i> إضافة موعد جديد
        </button>
    </div>
    <div id="legal-calendar" style="margin-top: 20px;"></div>
</div>
<div id="page-legal-employee-lookup" class="page-content hidden">
    <div class="lookup-layout">
        <aside class="lookup-sidebar">
            <div class="form-group">
                <label>البحث بالاسم أو رقم الهوية</label>
                <input type="text" id="legal-lookup-input" placeholder="اكتب هنا للبحث...">
            </div>
            <div id="legal-lookup-results">
                <p style="text-align: center; color: var(--text-secondary); margin-top: 20px;">ابدا البحث لعرض النتائج</p>
            </div>
        </aside>

        <section class="lookup-content">
            <div id="legal-lookup-details" class="hidden">

                <div class="profile-card">
                    <div class="profile-card-header">
                        <h4 id="legal-profile-name">-</h4>
                        <span id="legal-profile-status" class="status"></span>
                    </div>
                    <div class="profile-grid">
                        <div class="info-bit"><i class="ph-bold ph-identification-card"></i><div><p>رقم الهوية</p><strong id="legal-profile-id">-</strong></div></div>
                        <div class="info-bit"><i class="ph-bold ph-phone"></i><div><p>رقم الجوال</p><strong id="legal-profile-phone">-</strong></div></div>
                        <div class="info-bit"><i class="ph-bold ph-calendar"></i><div><p>تاريخ المباشرة</p><strong id="legal-profile-start-date">-</strong></div></div>
                    </div>
                </div>

                <div class="profile-card">
                    <div class="profile-card-header"><h4>المعلومات الوظيفية</h4></div>
                    <div class="profile-grid">
                        <div class="info-bit"><i class="ph-bold ph-briefcase"></i><div><p>المشروع</p><strong id="legal-profile-project">-</strong></div></div>
                        <div class="info-bit"><i class="ph-bold ph-map-pin"></i><div><p>الموقع</p><strong id="legal-profile-location">-</strong></div></div>
                        <div class="info-bit"><i class="ph-bold ph-handshake"></i><div><p>العقد</p><strong id="legal-profile-contract">-</strong></div></div>
                        <div class="info-bit"><i class="ph-bold ph-calendar-x"></i><div><p>نهاية العقد</p><strong id="legal-profile-contract-end">-</strong></div></div>
                    </div>
                </div>

                <div class="profile-card">
                    <div class="profile-card-header"><h4>المعلومات المالية</h4></div>
                    <div class="profile-grid">
                        <div class="info-bit"><i class="ph-bold ph-bank"></i><div><p>البنك</p><strong id="legal-profile-bank">-</strong></div></div>
                        <div class="info-bit"><i class="ph-bold ph-credit-card"></i><div><p>رقم الآيبان</p><strong id="legal-profile-iban">-</strong></div></div>
                        <div class="info-bit"><i class="ph-bold ph-money"></i><div><p>إجمالي الراتب</p><strong id="legal-profile-salary">-</strong></div></div>
                    </div>
                </div>

                <div class="profile-card">
                    <div class="profile-card-header"><h4>ملخص الالتزام (آخر 90 يوم)</h4></div>
                    <div class="profile-grid">
                        <div class="info-bit"><i class="ph-bold ph-calendar-x" style="color:#ef4444;"></i><div><p>أيام الغياب</p><strong id="legal-summary-absent">-</strong></div></div>
                        <div class="info-bit"><i class="ph-bold ph-arrow-fat-line-left" style="color:#f59e0b;"></i><div><p>مرات الانسحاب</p><strong id="legal-summary-withdrawal">-</strong></div></div>
                        <div class="info-bit"><i class="ph-bold ph-user-switch" style="color:#8b5cf6;"></i><div><p>مرات الاستئذان</p><strong id="legal-summary-permission">-</strong></div></div>
                    </div>
                </div>

                <div class="profile-card">
                    <div class="profile-card-header"><h4>سجل الطلبات</h4></div>
                    <div id="legal-history-requests" class="history-list"><p>لا يوجد</p></div>
                </div>
                <div class="profile-card">
                    <div class="profile-card-header"><h4>سجل العقوبات</h4></div>
                    <div id="legal-history-penalties" class="history-list"><p>لا يوجد</p></div>
                </div>

            </div>
            <div id="legal-lookup-placeholder">
                <p style="text-align: center; color: var(--text-secondary); margin-top: 50px; font-size: 1.2rem;">
                    <i class="ph-bold ph-magnifying-glass" style="font-size: 3rem; display: block; margin-bottom: 15px;"></i>
                    يرجى البحث عن موظف لعرض ملفه القانوني
                </p>
            </div>
        </section>
    </div>
</div>
<div id="page-legal-penalties" class="page-content hidden">
    <div class="page-header">
        <h3>العقوبات والجزاءات (الشؤون القانونية)</h3>
    </div>
    
    <div class="tabs">
        <a href="#" class="tab-link active" data-tab="legal-penalties-log-tab"><i class="ph-bold ph-gavel"></i> تسجيل الجزاءات</a>
        <a href="#" class="tab-link" data-tab="legal-penalties-absence-tab"><i class="ph-bold ph-user-circle-minus"></i> متابعة الغياب اليومي</a>
    </div>

    <div id="legal-penalties-log-tab" class="tab-content active">
        <div class="report-filters-card" style="margin-bottom: 20px;">
            <div class="filter-grid" style="grid-template-columns: 1fr;">
                <div class="filter-group">
                    <label>بحث بالاسم أو رقم الهوية</label>
                    <input type="text" id="legal-penalties-search-input" placeholder="اكتب هنا للبحث عن موظف...">
                </div>
            </div>
        </div>
        <div id="legal-penalties-employee-list" class="attendance-list">
            <p style="text-align: center;">ابحث عن موظف لعرض سجل جزاءاته أو لإضافة جزاء جديد.</p>
        </div>
    </div>

    <div id="legal-penalties-absence-tab" class="tab-content">
        <div id="legal-absence-container" class="contracts-container" style="padding-top: 20px;">
            <p style="text-align: center;">جاري تحميل قائمة الغياب لهذا اليوم...</p>
        </div>
    </div>
</div>

<div id="page-blacklist" class="page-content hidden">
    <div class="page-header">
        <h3>القائمة السوداء للموظفين</h3>
        <button id="add-to-blacklist-btn" class="btn btn-danger"><i class="ph-bold ph-plus-circle"></i> إضافة للقائمة السوداء</button>
    </div>
    <div class="report-filters-card" style="margin-bottom: 20px;">
        <div class="filter-grid" style="grid-template-columns: 1fr;">
            <div class="filter-group">
                <label>بحث بالاسم أو رقم الهوية</label>
                <input type="text" id="blacklist-search-input" placeholder="اكتب هنا للبحث...">
            </div>
        </div>
    </div>
    <div id="blacklist-cards-container" class="contracts-container">
        <p style="text-align: center;">جاري تحميل القائمة...</p>
    </div>
</div>

<div id="page-lawsuits" class="page-content hidden">
    <div class="page-header">
        <h3>إدارة الدعاوى القضائية</h3>
        <button id="add-new-lawsuit-btn" class="btn btn-primary"><i class="ph-bold ph-plus-circle"></i> إضافة دعوى جديدة</button>
    </div>
    <div class="report-filters-card" style="margin-bottom: 20px;">
        <div class="filter-grid" style="grid-template-columns: 1fr;">
            <div class="filter-group">
                <label>بحث باسم الدعوى أو رقمها أو اسم المدعي/المدعى عليه</label>
                <input type="text" id="lawsuit-search-input" placeholder="اكتب هنا للبحث...">
            </div>
        </div>
    </div>
    <div id="lawsuit-cards-container" class="contracts-container">
        <p style="text-align: center;">جاري تحميل الدعاوى...</p>
    </div>
</div>
<div id="page-settlements" class="page-content hidden">
    <div class="page-header">
        <h3>إدارة التسوية الودية</h3>
        <button id="add-new-settlement-btn" class="btn btn-primary"><i class="ph-bold ph-plus-circle"></i> إضافة ملف تسوية جديد</button>
    </div>
    <div class="report-filters-card" style="margin-bottom: 20px;">
        <div class="filter-grid" style="grid-template-columns: 1fr;">
            <div class="filter-group">
                <label>بحث باسم الملف أو اسم المدعي (الموظف)</label>
                <input type="text" id="settlement-search-input" placeholder="اكتب هنا للبحث...">
            </div>
        </div>
    </div>
    <div id="settlement-cards-container" class="contracts-container">
        <p style="text-align: center;">جاري تحميل ملفات التسوية...</p>
    </div>
</div>

<div id="page-inventory" class="page-content hidden">
    <div class="page-header">
        <h3>المخزون الرئيسي للعهد</h3>
        <button id="add-new-asset-category-btn" class="btn btn-secondary"><i class="ph-bold ph-plus"></i> إضافة فئة عهدة جديدة</button>
    </div>
    <div id="inventory-cards-container" class="requests-actions-container" style="grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));">
        </div>
</div>
<div id="page-vehicles" class="page-content hidden">
    <div class="page-header">
        <h3>إدارة وتسجيل المركبات</h3>
        <button id="add-general-vehicle-btn" class="btn btn-primary"><i class="ph-bold ph-plus"></i> إضافة مركبة جديدة للمخزون</button>
    </div>
    
    <div class="tabs">
        <a href="#" class="tab-link active" data-tab="vehicle-assignment-tab"><i class="ph-bold ph-link"></i> تسجيل وربط المركبات بالعقود</a>
        <a href="#" class="tab-link" data-tab="vehicle-management-tab"><i class="ph-bold ph-car"></i> الإدارة العامة والتقارير</a>
        <a href="#" class="tab-link" data-tab="vehicle-invoices-tab"><i class="ph-bold ph-receipt"></i> الفواتير</a>
        <a href="#" class="tab-link" data-tab="vehicle-violations-tab"><i class="ph-bold ph-warning-octagon"></i> المخالفات</a>
    </div>

    <div id="vehicle-assignment-tab" class="tab-content active">
    <div id="vehicle-deficit-cards-container" class="contracts-container">
        <p style="text-align: center;">جاري تحليل العقود وحساب النقص في المركبات...</p>
    </div>
</div>

    <div id="vehicle-management-tab" class="tab-content">
        <div class="report-filters-card" style="margin-bottom: 20px;">
            <div class="filter-grid" style="grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));">
                <div class="filter-group">
                    <label>بحث باللوحة أو نوع المركبة</label>
                    <input type="text" id="all-vehicles-search" class="vehicle-filter-control" placeholder="اكتب هنا للبحث...">
                </div>
                <div class="filter-group">
                    <label>فلترة حسب المشرف</label>
                    <select id="all-vehicles-supervisor-filter" class="vehicle-filter-control">
                        <option value="">كل المشرفين</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>فلترة حسب الحالة</label>
                    <select id="all-vehicles-status-filter" class="vehicle-filter-control">
                        <option value="">كل الحالات</option>
                        <option value="فعالة">فعالة</option>
                        <option value="صيانة">صيانة</option>
                        <option value="خارج الخدمة">خارج الخدمة</option>
                    </select>
                </div>
            </div>
        </div>
        <div id="all-vehicles-container" class="contracts-container">
                    <p style="text-align: center;">جاري تحميل كل المركبات...</p>
                </div>
            </div>

            <div id="vehicle-invoices-tab" class="tab-content">
                <div class="page-header" style="padding:0; border:0; margin-bottom:20px;">
                    <h3>سجل فواتير المركبات</h3>
                    <button id="add-new-invoice-btn" class="btn btn-primary"><i class="ph-bold ph-plus"></i> رفع فاتورة جديدة</button>
                </div>
                <div id="vehicle-invoices-list-container" class="table-container">
                    <p style="text-align: center;">جاري تحميل الفواتير...</p>
                </div>
            </div>

            <div id="vehicle-violations-tab" class="tab-content">
                <div class="page-header" style="padding:0; border:0; margin-bottom:20px;">
                    <h3>سجل مخالفات المركبات</h3>
                    <button id="add-new-violation-btn" class="btn btn-primary"><i class="ph-bold ph-plus"></i> رفع مخالفة جديدة</button>
                </div>
                <div id="vehicle-violations-list-container" class="table-container">
                    <p style="text-align: center;">جاري تحميل المخالفات...</p>
                </div>
            </div>

        </div>
        <div id="page-admin-assets" class="page-content hidden">
    <div class="page-header">
        <h3>إدارة عهد الموظفين الإداريين</h3>
        <button id="add-new-inventory-item-btn" class="btn btn-primary"><i class="ph-bold ph-plus"></i> إضافة قطعة جديدة للمخزون</button>
    </div>

    <div class="report-filters-card" style="margin-bottom: 20px;">
        <div class="filter-grid" style="grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));">
            <div class="filter-group">
                <label>بحث بالرقم التسلسلي أو اسم الموظف</label>
                <input type="text" id="admin-assets-search-input" class="admin-assets-filter" placeholder="اكتب هنا للبحث...">
            </div>
            <div class="filter-group">
                <label>فلترة حسب الفئة</label>
                <select id="admin-assets-category-filter" class="admin-assets-filter">
                    <option value="">كل الفئات</option>
                    </select>
            </div>
            <div class="filter-group">
                <label>فلترة حسب الحالة</label>
                <select id="admin-assets-status-filter" class="admin-assets-filter">
                    <option value="">كل الحالات</option>
                    <option value="متوفر في المخزن">متوفر في المخزن</option>
                    <option value="مسلمة لموظف">مسلمة لموظف</option>
                    <option value="صيانة">صيانة</option>
                    <option value="تالف">تالف</option>
                </select>
            </div>
        </div>
    </div>
    <div id="admin-assets-list-container" class="table-container">
        <p style="text-align: center;">جاري تحميل بيانات العهد...</p>
    </div>
</div>
<div id="page-guard-assets" class="page-content hidden">
    <div class="page-header">
        <h3>إدارة عهد الحراس (أجهزة البرافو)</h3>
        <button id="add-new-bravo-item-btn" class="btn btn-primary"><i class="ph-bold ph-plus"></i> إضافة جهاز برافو جديد للمخزون</button>
    </div>
    <div class="stats-grid" style="margin-bottom: 30px;">
        <div class="stat-card-mini" style="--stat-color: #1f2937;"><i class="ph-bold ph-list-numbers"></i><div><h4 id="guard-asset-stats-required">0</h4><p>إجمالي الأجهزة المطلوبة بالعقود</p></div></div>
        <div class="stat-card-mini" style="--stat-color: #3b82f6;"><i class="ph-bold ph-upload-simple"></i><div><h4 id="guard-asset-stats-deployed">0</h4><p>الأجهزة المسلمة للمواقع</p></div></div>
        <div class="stat-card-mini" style="--stat-color: #ef4444;"><i class="ph-bold ph-warning-circle"></i><div><h4 id="guard-asset-stats-deficit">0</h4><p>العجز الحالي في المواقع</p></div></div>
        <div class="stat-card-mini" style="--stat-color: #22c55e;"><i class="ph-bold ph-storefront"></i><div><h4 id="guard-asset-stats-instock">0</h4><p>الأجهزة المتوفرة بالمخزون</p></div></div>
    </div>
    <div id="guard-assets-sites-container" class="table-container">
        <p style="text-align: center;">جاري تحميل بيانات المواقع...</p>
    </div>
</div>
<div id="page-asset-reports" class="page-content hidden">
    <div class="page-header">
        <h3>تقارير العهد</h3>
    </div>
    
    <div class="tabs">
        <a href="#" class="tab-link active" data-tab="vehicle-reports-tab"><i class="ph-bold ph-car"></i> تقارير المركبات</a>
        <a href="#" class="tab-link" data-tab="deployed-assets-report-tab"><i class="ph-bold ph-list-checks"></i> جرد العهد المسلمة</a>
    </div>

    <div id="vehicle-reports-tab" class="tab-content active">
        <div id="vehicle-reports-container" class="table-container">
            <p style="text-align: center;">جاري تحميل تقارير المركبات...</p>
        </div>
    </div>

    <div id="deployed-assets-report-tab" class="tab-content">
        <div id="deployed-assets-report-container" class="table-container">
             <p style="text-align: center;">جاري تحميل تقرير جرد العهد...</p>
        </div>
    </div>
</div>

<div id="page-cfo-approvals" class="page-content hidden" data-department="cfo">
    <div class="page-header">
        <h3>موافقات المدير المالي (CFO)</h3>
    </div>
    <div id="cfo-approvals-container" class="all-requests-container" style="padding-top: 20px;">
        <p style="text-align: center;">جاري تحميل الطلبات بانتظار موافقتك...</p>
    </div>
</div>

<div id="page-ceo-approvals" class="page-content hidden" data-department="ceo">
    <div class="page-header">
        <h3>موافقات المدير التنفيذي (CEO)</h3>
    </div>
    <div id="ceo-approvals-container" class="all-requests-container" style="padding-top: 20px;">
        <p style="text-align: center;">جاري تحميل الطلبات بانتظار موافقتك...</p>
    </div>
</div>

<div id="page-auditor-approvals" class="page-content hidden" data-department="auditor">
    <div class="page-header">
        <h3>موافقات المدقق المالي</h3>
    </div>
    <div id="auditor-approvals-container" class="all-requests-container" style="padding-top: 20px;">
        <p style="text-align: center;">جاري تحميل الطلبات بانتظار المراجعة والاعتماد...</p>
    </div>
</div>

<div id="page-finance-ready-to-pay" class="page-content hidden" data-department="finance-payment">
    <div class="page-header">
        <h3>أوامر الصرف الجاهزة للدفع</h3>
    </div>
    <div class="report-filters-card" style="margin-bottom: 20px;">
        <div class="filter-grid" style="grid-template-columns: 1fr 1fr;">
            <div class="filter-group">
                <label>بحث برقم الفاتورة أو اسم العميل</label>
                <input type="text" id="ready-to-pay-search" class="finance-filter-control" placeholder="اكتب للبحث...">
            </div>
            <div class="filter-group">
                <label>فلترة حسب القسم الطالب</label>
                <select id="ready-to-pay-dept-filter" class="finance-filter-control">
                    <option value="">كل الأقسام</option>
                    <option value="الموارد البشرية">الموارد البشرية</option>
                    <option value="الشؤون القانونية">الشؤون القانونية</option>
                    <option value="تقنية المعلومات">تقنية المعلومات</option>
                    <option value="التسويق">التسويق</option>
                    <option value="المالية">المالية</option>
                    <option value="العهد">العهد</option>
                </select>
            </div>
        </div>
    </div>
    <div id="ready-to-pay-container" class="table-container">
        <p style="text-align: center;">جاري تحميل أوامر الصرف الجاهزة...</p>
    </div>
</div>

<div id="page-finance-archive" class="page-content hidden" data-department="finance-archive">
    <div class="page-header">
        <h3>أرشيف الطلبات المالية</h3>
    </div>
    <div class="report-filters-card" style="margin-bottom: 20px;">
    <div class="filter-grid" style="grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));">
        <div class="filter-group">
            <label>بحث (عنوان، رقم فاتورة، مقدم الطلب)</label>
            <input type="text" id="archive-filter-search" class="finance-archive-filter" placeholder="اكتب للبحث...">
        </div>
        <div class="filter-group">
            <label>فلترة حسب القسم الطالب</label>
            <select id="archive-filter-department" class="finance-archive-filter">
                <option value="">كل الأقسام</option>
                <option value="ادارة الموارد البشرية">ادارة الموارد البشرية</option>
                <option value="الشؤون القانونية">الشؤون القانونية</option>
                <option value="تقنية المعلومات">تقنية المعلومات</option>
                <option value="التسويق">التسويق</option>
                <option value="المالية">المالية</option>
                <option value="ادارة العهد">ادارة العهد</option>
                <option value="ادارة العمليات">ادارة العمليات</option>
                <option value="ادارة العقود">ادارة العقود</option>
            </select>
        </div>
        <div class="filter-group">
            <label>فلترة حسب نوع الطلب</label>
            <input type="text" id="archive-filter-type" class="finance-archive-filter" placeholder="اكتب نوع الطلب (مثل: تامين طبي)...">
        </div>
    </div>
</div>
    <div class="tabs">
        <a href="#" class="tab-link active" data-tab="archive-approved-tab"><i class="ph-bold ph-check-circle"></i> الطلبات المقبولة (المدفوعة)</a>
        <a href="#" class="tab-link" data-tab="archive-rejected-tab"><i class="ph-bold ph-x-circle"></i> الطلبات المرفوضة</a>
    </div>

    <div id="archive-approved-tab" class="tab-content active">
        <div id="archive-approved-container" style="padding-top: 20px;">
            <p style="text-align: center;">جاري تحميل الأرشيف...</p>
        </div>
    </div>
    <div id="archive-rejected-tab" class="tab-content">
        <div id="archive-rejected-container" style="padding-top: 20px;">
            <p style="text-align: center;">جاري تحميل الأرشيف...</p>
        </div>
    </div>
</div>
<div id="page-finance-new-request" class="page-content hidden">
    <div class="page-header">
        <h3>طلبات الصرف الخاصة بالقسم</h3>
        <button id="add-new-financial-request-btn" class="btn btn-primary">
            <i class="ph-bold ph-plus-circle"></i> إضافة طلب صرف جديد
        </button>
    </div>
    <div class="report-filters-card" style="margin-bottom: 20px;">
        <div class="filter-grid" style="grid-template-columns: 1fr 1fr;">
            <div class="filter-group">
                <label>بحث بعنوان الطلب أو اسم الموظف</label>
                <input type="text" id="finance-request-search" class="finance-filter-control" placeholder="اكتب للبحث...">
            </div>
            <div class="filter-group">
                <label>فلترة حسب الحالة</label>
                <select id="finance-request-status-filter" class="finance-filter-control">
                    <option value="">كل الحالات</option>
                    <option value="بانتظار المدير المالي">بانتظار المدير المالي</option>
                    <option value="بانتظار المدير التنفيذي">بانتظار المدير التنفيذي</option>
                    <option value="بانتظار المدقق المالي">بانتظار المدقق المالي</option>
                    <option value="أمر صرف جاهز">أمر صرف جاهز</option>
                    <option value="مرفوض">مرفوض</option>
                </select>
            </div>
        </div>
    </div>
    <div id="department-financial-requests-container" class="table-container">
        <p style="text-align: center;">جاري تحميل طلبات الصرف الخاصة بقسمك...</p>
    </div>
</div>

<div id="page-supervisor-resignations" class="page-content hidden">
    <div class="page-header">
        <h3>مراجعة طلبات الاستقالة</h3>
    </div>
    <div id="supervisor-resignations-container" class="all-requests-container" style="padding-top: 20px;">
        <p style="text-align: center;">جاري تحميل طلبات الاستقالة المعلقة...</p>
    </div>
</div>

<div id="page-legal-resignations" class="page-content hidden">
    <div class="page-header">
        <h3>اعتماد طلبات الاستقالة (الشؤون القانونية)</h3>
    </div>
    <div id="legal-resignations-container" class="all-requests-container" style="padding-top: 20px;">
        <p style="text-align: center;">جاري تحميل الطلبات بانتظار الاعتماد النهائي...</p>
    </div>
</div>

<div id="page-finance-loans" class="page-content hidden">
    <div class="page-header">
        <h3>متابعة طلبات السلف (المالية)</h3>
    </div>
    <div id="finance-loans-container" class="all-requests-container" style="padding-top: 20px;">
        <p style="text-align: center;">جاري تحميل طلبات السلف بانتظار الصرف...</p>
    </div>
</div>

<div id="page-high-command" class="page-content hidden">
    <div class="page-header" style="background: linear-gradient(to left, #111827, #1f2937); padding: 20px; border-radius: 12px; color: #fcd34d;">
        <h3 style="color: #fcd34d;"><i class="ph-fill ph-crown"></i> لوحة تحكم القيادة العليا</h3>
        <p style="color: #e5e7eb; margin-top: 5px; font-size: 0.9rem;">خاص </p>
    </div>

    <div class="tabs" style="margin-top: 25px;">
        <a href="#" class="tab-link active" data-tab="cmd-branches-tab"><i class="ph-bold ph-buildings"></i> إدارة الفروع والمقرات</a>
        <a href="#" class="tab-link" data-tab="cmd-staff-tab"><i class="ph-bold ph-users-three"></i> إدارة الموظفين والصلاحيات</a>
    </div>

    <div id="cmd-branches-tab" class="tab-content active">
        <div class="page-header" style="background: none; padding: 0; border: none; margin-bottom: 15px;">
            <h4>قائمة الفروع والمقرات</h4>
            <button id="cmd-add-branch-btn" class="btn btn-primary"><i class="ph-bold ph-plus"></i> إضافة فرع جديد</button>
        </div>
        <div id="cmd-branches-list" class="table-container">
            <p style="text-align: center;">جاري تحميل الفروع...</p>
        </div>
    </div>

    <div id="cmd-staff-tab" class="tab-content">
        <div class="report-filters-card">
            <div class="filter-group">
                <label>بحث عن موظف إداري</label>
                <input type="text" id="cmd-staff-search" class="form-control" placeholder="الاسم أو الهوية...">
            </div>
        </div>
        <div id="cmd-staff-list" class="table-container">
            <p style="text-align: center;">جاري تحميل الموظفين الإداريين...</p>
        </div>
    </div>
</div>
<div id="page-dept-requests" class="page-content hidden">
    <div class="page-header">
        <h3><i class="ph-fill ph-tray"></i> طلبات القسم الواردة</h3>
        <p>مراجعة واعتماد الطلبات الخاصة بموظفي قسمك.</p>
    </div>
    <div id="cmd-requests-container" class="all-requests-container">
        <p style="text-align:center;">جاري تحميل الطلبات...</p>
    </div>
</div>
<div id="page-admin-attendance" class="page-content hidden">
    <div class="page-header">
        <h3>الحضور والانصراف</h3>
    </div>

    <div class="attendance-card">
        <div id="admin-att-status-container" class="attendance-status-text">
            <p>جاري التحقق من بيانات الفرع...</p>
        </div>

        <div id="admin-att-actions" style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; margin-top: 20px;">
            <div id="admin-location-btn-container" style="width: 100%; margin-bottom: 10px;"></div>
            
            <button id="admin-check-in-btn" class="btn btn-success btn-lg hidden">
                <i class="ph-bold ph-sign-in"></i> تسجيل حضور
            </button>
            
            <button id="admin-check-out-btn" class="btn btn-danger btn-lg hidden">
                <i class="ph-bold ph-sign-out"></i> تسجيل انصراف
            </button>
        </div>

        <div id="admin-location-msg" class="location-status" style="margin-top: 15px;"></div>
    </div>
</div>
<div id="page-admin-monitor" class="page-content hidden">
    <div class="page-header">
        <h3>حضور الادارة</h3>
        <button id="refresh-monitor-btn" class="btn btn-secondary"><i class="ph-bold ph-arrows-clockwise"></i> تحديث القائمة</button>
    </div>

    <div class="tabs">
        <a href="#" class="tab-link active" data-tab="monitor-present-tab">
            <i class="ph-bold ph-user-check"></i> المتواجدون حالياً
        </a>
        <a href="#" class="tab-link" data-tab="monitor-absent-tab">
            <i class="ph-bold ph-user-minus"></i> لم يسجلوا حضور
        </a>
    </div>

    <div id="monitor-present-tab" class="tab-content active">
        <div class="stats-grid" style="margin-bottom: 20px;">
            <div class="stat-card-mini" style="--stat-color: #22c55e;">
                <i class="ph-bold ph-users-three"></i>
                <div><h4 id="monitor-count-present">0</h4><p>على رأس العمل</p></div>
            </div>
        </div>
        <div id="admin-monitor-list" class="table-container">
            <p style="text-align: center;">جاري التحميل...</p>
        </div>
    </div>

    <div id="monitor-absent-tab" class="tab-content">
        <div class="stats-grid" style="margin-bottom: 20px;">
            <div class="stat-card-mini" style="--stat-color: #ef4444;">
                <i class="ph-bold ph-user-minus"></i>
                <div><h4 id="monitor-count-absent">0</h4><p>لم يسجلوا حضور</p></div>
            </div>
        </div>
        <div id="admin-absent-list" class="table-container">
            <p style="text-align: center;">جاري البحث عن المتغيبين...</p>
        </div>
    </div>
</div>
<div id="page-admin-payroll" class="page-content hidden">
    <div class="page-header">
        <h3>مسير رواتب الموظفين الإداريين</h3>
        <button id="export-admin-payroll-btn" class="btn btn-success"><i class="ph-bold ph-file-xls"></i> تصدير Excel</button>
    </div>

    <div class="report-filters-card">
        <div class="filter-grid" style="grid-template-columns: 1fr 1fr 1fr;">
            <div class="form-group">
                <label>الشهر</label>
                <select id="admin-payroll-month">
                    <option value="1">يناير</option>
                    <option value="2">فبراير</option>
                    <option value="3">مارس</option>
                    <option value="4">أبريل</option>
                    <option value="5">مايو</option>
                    <option value="6">يونيو</option>
                    <option value="7">يوليو</option>
                    <option value="8">أغسطس</option>
                    <option value="9">سبتمبر</option>
                    <option value="10">أكتوبر</option>
                    <option value="11">نوفمبر</option>
                    <option value="12">ديسمبر</option>
                </select>
            </div>
            <div class="form-group">
                <label>السنة</label>
                <select id="admin-payroll-year">
                    <option value="2025">2025</option>
                    <option value="2026">2026</option>
                </select>
            </div>
            <div class="form-group" style="display:flex; align-items:flex-end;">
                <button id="btn-generate-admin-payroll" class="btn btn-primary" style="width:100%;">
                    <i class="ph-bold ph-calculator"></i> إصدار المسير
                </button>
            </div>
        </div>
    </div>

    <div id="admin-payroll-result" class="table-container">
        <p style="text-align: center;">الرجاء اختيار الشهر والضغط على إصدار المسير.</p>
    </div>
</div>
<div id="page-admin-requests" class="page-content hidden">
    <div class="page-header">
        <h3>طلباتي</h3>
    </div>

    <div class="requests-actions-container">
        <button class="request-action-card" data-request-type="permission" style="--card-color: #0d6efd;">
            <i class="ph-fill ph-clock-countdown"></i>
            <h4>طلب استئذان</h4>
        </button>
        <button class="request-action-card" data-request-type="leave" style="--card-color: #198754;">
            <i class="ph-fill ph-calendar-blank"></i>
            <h4>طلب إجازة</h4>
        </button>
        <button class="request-action-card" data-request-type="loan" id="admin-loan-btn" style="--card-color: #ffc107;">
            <i class="ph-fill ph-hand-coins"></i>
            <h4>طلب سلفة</h4>
        </button>
        <button class="request-action-card" data-request-type="resignation" style="--card-color: #dc3545;">
            <i class="ph-fill ph-file-x"></i>
            <h4>طلب استقالة</h4>
        </button>
    </div>

    <div class="page-header" style="margin-top: 40px; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px;">
        <h3>سجل متابعة طلباتي</h3>
    </div>

    <div id="admin-requests-list" class="all-requests-container">
        <p style="text-align: center;">جاري تحميل سجل طلباتك...</p>
    </div>
</div>
<div id="page-hr-admin-reviews" class="page-content hidden">
    <div class="page-header">
        <h3>طلبات الموظفين الإداريين </h3>
    </div>

    <div class="tabs">
        <a href="#" class="filter-tab active" data-filter="all">الكل</a>
        <a href="#" class="filter-tab" data-filter="leave">إجازات</a>
        <a href="#" class="filter-tab" data-filter="loan">سلف</a>
        <a href="#" class="filter-tab" data-filter="resignation">استقالات</a>
        <a href="#" class="filter-tab" data-filter="permission">استئذان</a>
    </div>

    <div id="hr-admin-reviews-container" class="all-requests-container">
        <p style="text-align: center;">جاري تحميل طلبات الإداريين...</p>
    </div>
</div>
<div id="page-admin-history" class="page-content hidden">
    <div class="page-header">
        <h3>سجل حضور موظفي الإدارة</h3>
        <button id="btn-add-admin-record" class="btn btn-primary"><i class="ph-bold ph-plus-circle"></i> إضافة سجل يدوي</button>
    </div>

    <div class="report-filters-card">
        <div class="filter-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
            <div class="filter-group">
                <label>من تاريخ</label>
                <input type="date" id="admin-hist-from">
            </div>
            <div class="filter-group">
                <label>إلى تاريخ</label>
                <input type="date" id="admin-hist-to">
            </div>
            <div class="filter-group">
                <label>الموظف</label>
                <input type="text" id="admin-hist-search" placeholder="ابحث بالاسم...">
            </div>
            <div class="filter-group" style="align-self: flex-end;">
                <button id="btn-admin-hist-search" class="btn btn-secondary" style="width: 100%;"><i class="ph-bold ph-magnifying-glass"></i> عرض السجلات</button>
            </div>
        </div>
    </div>

    <div id="admin-history-container" class="table-container">
        <p style="text-align: center;">حدد الفترة واضغط عرض السجلات.</p>
    </div>
</div>

<div id="admin-record-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 500px;">
        <div class="modal-header">
            <h4 id="admin-record-title">تعديل سجل</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="admin-record-form">
            <div class="modal-body">
                <input type="hidden" id="admin-rec-id">
                
                <div class="form-group">
                    <label>الموظف</label>
                    <select id="admin-rec-user" required></select> 
                </div>

                <div class="form-group">
                    <label>الحالة</label>
                    <select id="admin-rec-status">
                        <option value="حاضر">حاضر</option>
                        <option value="اكمل المناوبة">اكمل المناوبة (دوام كامل)</option>
                        <option value="غياب">غياب</option>
                        <option value="استئذان">استئذان</option>
                        <option value="انسحاب">انسحاب</option>
                    </select>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>وقت الحضور</label>
                        <input type="datetime-local" id="admin-rec-in" required>
                    </div>
                    <div class="form-group">
                        <label>وقت الانصراف</label>
                        <input type="datetime-local" id="admin-rec-out">
                    </div>
                </div>

                <div class="form-group">
                    <label>ملاحظات</label>
                    <textarea id="admin-rec-notes" rows="2" placeholder="سبب التعديل..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary">حفظ السجل</button>
            </div>
        </form>
    </div>
</div>
<div id="page-dept-permissions" class="page-content hidden">
    <div class="page-header">
        <h3>طلبات استئذان موظفي القسم</h3>
    </div>

    <div id="dept-permissions-container" class="all-requests-container">
        <p style="text-align: center;">جاري تحميل طلبات الاستئذان...</p>
    </div>
</div>
<div id="page-payroll-dashboard" class="page-content hidden">
    <div class="page-header">
        <h3>لوحة متابعة ورفع المسيرات</h3>
        <div style="display: flex; gap: 10px; align-items: center;">
            <select id="payroll-dash-month" style="padding: 8px; border-radius: 6px; border: 1px solid #d1d5db;">
                </select>
            <select id="payroll-dash-year" style="padding: 8px; border-radius: 6px; border: 1px solid #d1d5db;">
                </select>
            <button id="refresh-payroll-dash-btn" class="btn btn-secondary"><i class="ph-bold ph-arrows-clockwise"></i> تحديث</button>
        </div>
    </div>

    <div id="payroll-dashboard-grid" style="display: flex; flex-direction: column; gap: 30px;">
        <p style="text-align: center; padding: 40px;">جاري تحليل العقود والمسيرات...</p>
    </div>
</div>


</div> </main>
    <script src="/config.js"></script>
    <script src="/app.js"></script>

<div id="permission-request-modal" class="modal-overlay hidden">
    <div class="modal-panel">
        <div class="modal-header"><h4>طلب استئذان</h4><button class="modal-close-btn"><i class="ph-bold ph-x"></i></button></div>
        <div class="modal-body">
            <div class="form-group">
                <label for="permission-reason">سبب الاستئذان</label>
                <textarea id="permission-reason" rows="4" placeholder="يرجى توضيح سبب طلب الاستئذان بالتفصيل..."></textarea>
            </div>
        </div>
        <div class="modal-footer"><button class="btn btn-primary btn-submit-request" data-request-type="permission">إرسال الطلب</button><button class="btn btn-secondary modal-close-btn">إلغاء</button></div>
    </div>
</div>

<div id="leave-request-modal" class="modal-overlay hidden">
    <div class="modal-panel">
        <div class="modal-header"><h4>طلب إجازة</h4><button class="modal-close-btn"><i class="ph-bold ph-x"></i></button></div>
        <div class="modal-body">

           <div class="form-group">
    <label for="leave-type">نوع الإجازة</label>
    <input type="text" id="leave-type" placeholder="مثال: مرضية،..." required>
</div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="leave-start-date">تاريخ بداية الإجازة</label>
                    <input type="date" id="leave-start-date" required>
                </div>

                <div class="form-group">
                    <label for="leave-end-date">تاريخ نهاية الإجازة</label>
                    <input type="date" id="leave-end-date" required>
                </div>
            </div>

            <div class="form-group">
                <label for="leave-reason">السبب / ملاحظات</label>
                <textarea id="leave-reason" rows="3" placeholder="يرجى توضيح السبب..."></textarea>
            </div>

            <div class="form-group">
                <label for="leave-attachment">إرفاق (اختياري، إجباري للمرضية)</label>
                <input type="file" id="leave-attachment" accept="image/*,application/pdf">
            </div>

        </div>
        <div class="modal-footer"><button class="btn btn-primary btn-submit-request" data-request-type="leave">إرسال الطلب</button><button class="btn btn-secondary modal-close-btn">إلغاء</button></div>
    </div>
</div>

<div id="loan-request-modal" class="modal-overlay hidden">
    <div class="modal-panel">
        <div class="modal-header"><h4>طلب سلفة</h4><button class="modal-close-btn"><i class="ph-bold ph-x"></i></button></div>
        <div class="modal-body">
            <p id="loan-policy-info" style="font-size: 0.9rem; color: var(--text-secondary); background-color: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center;">
                جاري حساب الحد الأقصى...
            </p>
            <div class="form-group">
                <label for="loan-amount">مبلغ السلفة (ر.س)</label>
                <input type="number" id="loan-amount" placeholder="مثال: 500">
            </div>
            <div class="form-group">
                <label for="loan-reason">سبب السلفة</label>
                <textarea id="loan-reason" rows="4" placeholder="يرجى توضيح سبب طلب السلفة..."></textarea>
            </div>
        </div>
        <div class="modal-footer"><button class="btn btn-primary btn-submit-request" data-request-type="loan">إرسال الطلب</button><button class="btn btn-secondary modal-close-btn">إلغاء</button></div>
    </div>
</div>

<div id="resignation-request-modal" class="modal-overlay hidden">
    <div class="modal-panel">
        <div class="modal-header"><h4>طلب استقالة</h4><button class="modal-close-btn"><i class="ph-bold ph-x"></i></button></div>
        <div class="modal-body">
            <div class="form-group">
                <label for="resignation-reason">سبب الاستقالة</label>
                <textarea id="resignation-reason" rows="5" placeholder="يرجى توضيح أسباب رغبتك في تقديم الاستقالة..."></textarea>
            </div>
        </div>
        <div class="modal-footer"><button class="btn btn-primary btn-submit-request" data-request-type="resignation">تأكيد وإرسال الطلب</button><button class="btn btn-secondary modal-close-btn">إلغاء</button></div>
    </div>
</div>

<div id="guard-transfer-modal" class="modal-overlay hidden">
    <div class="modal-panel">
        <div class="modal-header">
            <h4>طلب نقل حارس</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="transfer-guard-select">اختر الحارس</label>
                <select id="transfer-guard-select">
                    <option>جاري تحميل الحراس...</option>
                </select>
            </div>
            <div class="form-group">
                <label for="transfer-client-select">اختر الموقع الجديد</label>
                <select id="transfer-client-select">
                    <option>جاري تحميل المواقع...</option>
                </select>
            </div>
            <div class="form-group">
                <label for="transfer-reason">سبب النقل</label>
                <textarea id="transfer-reason" rows="4" placeholder="يرجى توضيح سبب طلب النقل..."></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button id="submit-transfer-request-btn" class="btn btn-primary">إرسال طلب النقل</button>
            <button class="btn btn-secondary modal-close-btn">إلغاء</button>
        </div>
    </div>
</div>
<div id="add-visit-modal" class="modal-overlay hidden">
    <div class="modal-panel">
        <div class="modal-header">
            <h4>تسجيل زيارة ميدانية جديدة</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="visit-client-select">اختر الموقع الذي تمت زيارته</label>
                <select id="visit-client-select">
                    <option>جاري تحميل المواقع...</option>
                </select>
            </div>
            <div class="form-group">
                <label for="visit-time-input">وقت وتاريخ الزيارة</label>
                <input type="datetime-local" id="visit-time-input">
            </div>
            <div class="form-group">
                <label for="visit-notes-textarea">الملاحظات</label>
                <textarea id="visit-notes-textarea" rows="5" placeholder="اكتب ملاحظاتك عن الزيارة، حالة الموقع، أداء الحراس، إلخ..."></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button id="submit-visit-btn" class="btn btn-primary">حفظ الزيارة</button>
            <button class="btn btn-secondary modal-close-btn">إلغاء</button>
        </div>
    </div>
</div>

<div id="contract-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 1000px;">
        <div class="modal-header">
            <h4 id="contract-modal-title">إضافة عقد جديد</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="contract-id-hidden">
            
            <h4>1. المعلومات الأساسية</h4>
        <div class="form-grid" style="grid-template-columns: 1fr 1fr 1fr;">
            <div class="form-group">
                <label for="contract-company-name">اسم الشركة (العميل)</label>
                <input type="text" id="contract-company-name" placeholder="مثال: شركة جرير للتسويق" required>
            </div>
            <div class="form-group">
                <label for="contract-end-date">تاريخ نهاية العقد (اختياري)</label>
                <input type="date" id="contract-end-date">
            </div>
            <div class="form-group">
                <label for="contract-workdays-select">أيام العمل</label>
                <select id="contract-workdays-select">
                    <option value="6">6 أيام عمل</option>
                    <option value="7">7 أيام عمل</option>
                </select>
            </div>
        </div>

        <h4 style="margin-top: 25px;">ممثلين العقد</h4>
        <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
            <div class="form-group">
                <label>الطرف الأول (اركانات)</label>
                <input type="text" id="party1-name" placeholder="اسم ممثل الطرف الأول">
            </div>
            <div class="form-group">
                <label>رقم التواصل (الطرف الأول)</label>
                <input type="text" id="party1-phone" placeholder="رقم التواصل">
            </div>
            <div class="form-group">
                <label>المنصب الوظيفي (الطرف الأول)</label>
                <input type="text" id="party1-position" placeholder="منصب الممثل">
            </div>
            <div class="form-group">
                <label>البريد الإلكتروني (الطرف الأول)</label>
                <input type="email" id="party1-email" placeholder="بريد الممثل الإلكتروني">
            </div>
            <div class="form-group">
                <label>الطرف الثاني (العميل)</label>
                <input type="text" id="party2-name" placeholder="اسم ممثل الطرف الثاني">
            </div>
            <div class="form-group">
                <label>رقم التواصل (الطرف الثاني)</label>
                <input type="text" id="party2-phone" placeholder="رقم التواصل">
            </div>
            <div class="form-group">
                <label>المنصب الوظيفي (الطرف الثاني)</label>
                <input type="text" id="party2-position" placeholder="منصب الممثل">
            </div>
            <div class="form-group">
                <label>البريد الإلكتروني (الطرف الثاني)</label>
                <input type="email" id="party2-email" placeholder="بريد الممثل الإلكتروني">
            </div>
        </div>

        <h4 style="margin-top: 25px;">التفاصيل المالية</h4>
        <button type="button" id="add-commission-btn" class="btn btn-secondary"><i class="ph-bold ph-plus-circle"></i> إضافة نسبة عمولة</button>
        <div id="commission-group" class="form-group hidden" style="max-width: 300px; margin-top: 15px;">
            <label for="commission-percentage">نسبة العمولة (%)</label>
            <input type="number" id="commission-percentage" placeholder="مثال: 5">
        </div>

        <h4 style="margin-top: 25px;">2. المواقع والورديات</h4>
            <div id="locations-container" style="display: flex; flex-direction: column; gap: 20px; margin-top: 15px; max-height: 400px; overflow-y: auto; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
                </div>
                <div class="form-group" style="margin-bottom: 10px;">
    <div class="custom-select-wrapper">
        <input type="text" id="contract-modal-search" class="custom-select-search" placeholder="🔍 ابحث عن اسم الموقع أو الوردية..." style="border-color: var(--accent-color); background-color: #f0f9ff;">
    </div>
</div>
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <input type="text" id="new-location-name-input" placeholder="اكتب اسم الموقع الجديد هنا..." style="flex-grow: 1; padding: 12px; border-radius: 8px; border: 1px solid var(--border-color);">
                <button id="add-location-from-input-btn" class="btn btn-primary"><i class="ph-bold ph-plus"></i> إضافة موقع</button>
            </div>
        </div>
        <div class="modal-footer">
            <button id="save-contract-btn" class="btn btn-primary">حفظ العقد</button>
            <button class="btn btn-secondary modal-close-btn">إلغاء</button>
        </div>
    </div>
</div>
<div id="vacancy-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 800px;">
        <div class="modal-header">
            <h4 id="vacancy-modal-title">إضافة شاغر جديد</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="vacancy-id">
            <h4>1. معلومات الشاغر الأساسية</h4>
            <div class="form-grid">
                <div class="form-group">
                    <label for="vacancy-title">المسمى الوظيفي</label>
                    <input type="text" id="vacancy-title" value="حارس أمن" readonly style="background-color: #e9ecef;">
                </div>
                <div class="form-group">
                <label for="vacancy-contract">اختر العقد أولاً</label>
                <select id="vacancy-contract" required>
                    <option value="">-- اختر عقداً --</option>
                </select>
            </div>
            <div class="form-group hidden" id="vacancy-location-group">
                <label for="vacancy-location-select">اختر الموقع من العقد</label>
                <select id="vacancy-location-select" required>
                </select>
            </div>
            <div class="form-group hidden" id="vacancy-shift-group">
                <label for="vacancy-shift-select">اختر الوردية المتاحة</label>
                <select id="vacancy-shift-select" required>
                </select>
            </div>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label>المشروع</label>
                    <input type="text" id="vacancy-project" placeholder="يُملأ تلقائياً" readonly>
                </div>
                 <div class="form-group">
                    <label>المدينة</label>
                    <input type="text" id="vacancy-city" placeholder="تُملأ تلقائياً" readonly>
                </div>
                <div class="form-group">
                    <label>حالة الشاغر</label>
                    <select id="vacancy-status">
                        <option value="open">مفتوح</option>
                        <option value="closed">مغلق</option>
                    </select>
                </div>
            </div>
            <hr style="margin: 25px 0;">
            <h4>2. تفاصيل الراتب</h4>
            <div class="form-grid" style="grid-template-columns: 1fr 1fr 1fr 1fr;">
                <div class="form-group">
                    <label for="vacancy-base-salary">الراتب الأساسي</label>
                    <input type="number" id="vacancy-base-salary" value="0">
                </div>
                <div class="form-group">
                    <label for="vacancy-housing">بدل السكن</label>
                    <input type="number" id="vacancy-housing" value="0">
                </div>
                <div class="form-group">
                    <label for="vacancy-transport">بدل النقل</label>
                    <input type="number" id="vacancy-transport" value="0">
                </div>
                <div class="form-group">
                    <label for="vacancy-other">بدلات أخرى</label>
                    <input type="number" id="vacancy-other" value="0">
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="save-vacancy-btn" class="btn btn-primary">حفظ الشاغر</button>
            <button class="btn btn-secondary modal-close-btn">إلغاء</button>
        </div>
    </div>
</div>
<div id="employee-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 900px;">
        <div class="modal-header">
            <h4 id="employee-modal-title">إضافة موظف جديد</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="employee-id">
            <input type="hidden" id="employee-auth-id">
            <input type="hidden" id="employee-creation-mode">
            <input type="hidden" id="employee-vacancy-id">
            <input type="hidden" id="employee-project-hidden">

            <h4>1. المعلومات الشخصية والوظيفية</h4>
            <div class="form-grid" style="grid-template-columns: 1fr 1fr 1fr;">
                <div class="form-group">
                    <label for="employee-name">الاسم الكامل</label>
                    <input type="text" id="employee-name" placeholder="اسم الموظف">
                </div>
                <div class="form-group">
                    <label for="employee-id-number">رقم الهوية (للدخول)</label>
                    <input type="text" id="employee-id-number" placeholder="سيستخدم لتسجيل الدخول">
                </div>
                <div class="form-group">
                    <label for="employee-phone">رقم الجوال</label>
                    <input type="tel" id="employee-phone" placeholder="05xxxxxxxx">
                </div>
                 <div class="form-group">
                <label for="employee-role">الدور الوظيفي</label>
                <select id="employee-role">
                    <option value="حارس أمن">حارس أمن</option>
                    <option value="مشرف">مشرف</option>
                    <option value="ادارة العمليات">ادارة العمليات</option>
                    <option value="ادارة الموارد البشرية">ادارة الموارد البشرية</option>
                    <option value="ادارة العقود">ادارة العقود</option>
                    <option value="المالية">المالية</option>
                    <option value="التسويق">التسويق</option>
                    <option value="الشؤون القانونية">الشؤون القانونية</option>
                </select>
            </div>
                <div class="form-group">
                    <label for="employee-start-date">تاريخ المباشرة</label>
                    <input type="date" id="employee-start-date">
                </div>
                <div class="form-group">
                    <label>الفرع (للحراس والمشرفين)</label>
                    <select id="field-employee-branch">
                        <option value="">-- اختر الفرع --</option>
                    </select>
                </div>
                <div class="form-group" id="employee-password-group">
                    <label for="employee-password">كلمة المرور</label>
                    <input type="password" id="employee-password" placeholder="اتركه فارغاً لعدم التغيير">
                </div>
            </div>

            <hr style="margin: 25px 0;">

            <h4>2. المعلومات المالية والإدارية</h4>
            <div class="form-grid" style="grid-template-columns: 1fr 1fr 1fr;">
                 <div class="form-group">
                    <label for="employee-iban">رقم الآيبان (IBAN)</label>
                    <input type="text" id="employee-iban" placeholder="SAxxxxxxxxxxxxxxxxxxxx">
                </div>
                <div class="form-group">
                    <label for="employee-bank-name">اسم البنك</label>
                    <input type="text" id="employee-bank-name" placeholder="مثال: الراجحي">
                </div>
                <div class="form-group">
                <label for="employee-insurance">حالة التأمينات</label>
                <select id="employee-insurance">
                    <option value="غير مسجل">غير مسجل</option>
                    <option value="مسجل">مسجل</option>
                </select>
            </div>

            <div id="employee-uniform-group">
                <div class="form-group" style="display: flex; align-items: center; justify-content: center; background-color: #f8f9fa; padding: 10px; border-radius: 8px; margin-top: 10px;">
                    <input type="checkbox" id="employee-uniform-received" style="width: 20px; height: 20px; margin-left: 10px;">
                    <label for="employee-uniform-received" style="margin: 0; font-weight: 600; cursor: pointer;">هل استلم الموظف الزي الرسمي؟</label>
                </div>
            </div>
                <div class="form-group hidden" id="insurance-amount-group">
                    <label for="employee-insurance-amount">مبلغ استقطاع التأمينات (شهريًا)</label>
                    <input type="number" id="employee-insurance-amount" value="0">
                </div>
                <div class="form-group" id="employee-status-group">
                    <label for="employee-status">الحالة الوظيفية</label>
                    <select id="employee-status">
                        <option value="اساسي">أساسي</option>
                        <option value="بديل راحة">بديل راحة</option>
                        <option value="تغطية">تغطية</option>
                        <option value="اجازة">إجازة</option>
                        <option value="مستقيل">مستقيل</option>
                        <option value="معلق">معلق</option>
                    </select>
                </div>
            </div>

            <hr style="margin: 25px 0;">
            <div id="admin-employee-fields" class="hidden">
    <h4>3. بيانات التعيين والراتب (للإداريين)</h4>
    
    <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
        <div class="form-group">
            <label>الفرع التابع له</label>
            <select id="employee-branch">
                <option value="">-- اختر الفرع --</option>
            </select>
        </div>
        <div class="form-group">
            <label>وقت الدوام (الشفت)</label>
            <select id="employee-branch-shift" disabled>
                <option value="">-- اختر الفرع أولاً --</option>
            </select>
        </div>
    </div>

    <div class="form-group" style="margin-top: 15px; margin-bottom: 10px;">
        <label style="font-weight: bold; color: var(--accent-color);">تفاصيل الراتب الشهري</label>
    </div>
    <div class="form-grid" style="grid-template-columns: repeat(4, 1fr);">
        <div class="form-group">
            <label>الأساسي</label>
            <input type="number" id="employee-basic-salary" placeholder="0">
        </div>
        <div class="form-group">
            <label>بدل سكن</label>
            <input type="number" id="employee-housing-salary" placeholder="0">
        </div>
        <div class="form-group">
            <label>بدل نقل</label>
            <input type="number" id="employee-transport-salary" placeholder="0">
        </div>
        <div class="form-group">
            <label>بدلات أخرى</label>
            <input type="number" id="employee-other-salary" placeholder="0">
        </div>
    </div>
    <hr style="margin: 25px 0;">
</div>
           <div id="job-placement-section">
                <h4>3. التسكين الوظيفي</h4>
                <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                    <div class="form-group">
                        <label for="employee-contract">تابع للعقد</label>
                        <select id="employee-contract">
                            <option value="">غير محدد</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="employee-vacancy">الشاغر المحدد</label>
                        <select id="employee-vacancy">
                            <option value="">غير محدد</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>الوردية الحالية</label>
                    <input type="text" id="employee-shift-display" placeholder="سيتم عرض معلومات الشاغر هنا" readonly style="background-color: #e9ecef; text-align: center;">
                </div>
                <div class="form-grid" style="grid-template-columns: 1fr 1fr 1fr 1fr; margin-top: 15px;">
                    <div class="form-group">
                        <label for="employee-project-display">المشروع</label>
                        <input type="text" id="employee-project-display" placeholder="يُملأ تلقائياً" disabled>
                    </div>
                    <div class="form-group">
                        <label for="employee-location-display">الموقع المحدد</label>
                        <input type="text" id="employee-location-display" placeholder="يُملأ تلقائياً" disabled>
                    </div>
                    <div class="form-group">
                        <label for="employee-region">المنطقة</label>
                        <input type="text" id="employee-region" placeholder="ادخل المنطقة">
                    </div>
                    <div class="form-group">
                        <label for="employee-city">المدينة</label>
                        <input type="text" id="employee-city" placeholder="ادخل المدينة">
                    </div>
                </div>
            </div>

            <div id="manager-assignment-group" class="hidden">
                <hr style="margin: 25px 0;">
                <h4>4. تحديد نطاق الصلاحيات</h4>
                <div id="managerial-fields-grid">
                    <div class="form-group" id="assign-sites-btn-group" style="margin-bottom: 20px;">
                        <button type="button" id="open-site-assignment-modal-btn" class="btn btn-secondary" style="width: 100%;">
                            <i class="ph-bold ph-map-pin"></i> تحديد المواقع المعينة
                        </button>
                    </div>
                    <div class="form-group" id="assign-region-group">
                         <label>المنطقة الإدارية</label>
                         <select id="assign-region-select">
                             <option value="">-- اختر منطقة --</option>
                             <option value="الوسطى">الوسطى</option>
                             <option value="الغربية">الغربية</option>
                             <option value="الشرقية">الشرقية</option>
                             <option value="الشمالية">الشمالية</option>
                             <option value="الجنوبية">الجنوبية</option>
                         </select>
                    </div>
                </div>
                 <p class="text-secondary" style="font-size: 0.9rem; margin-top: 15px;">
                    <strong>المواقع المعينة حالياً:</strong> <span id="assigned-locations-summary">لم يتم تحديد مواقع.</span>
                </p>
            </div>
            
            </div>
        <div class="modal-footer">
            <button id="save-employee-btn" class="btn btn-primary">حفظ الموظف</button>
            <button class="btn btn-secondary modal-close-btn">إلغاء</button>
        </div>
    </div>
</div>
<div id="view-contract-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 700px;">
        <div class="modal-header">
            <h4 id="view-contract-title">تفاصيل العقد</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div id="contract-view-body" class="modal-body">
            </div>
        <div class="modal-footer">
            <button class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="view-vacancy-details-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 600px;">
        <div class="modal-header">
            <h4>تفاصيل الشاغر</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div id="vacancy-details-body" class="modal-body">
            </div>
        <div class="modal-footer">
            <button class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="available-slots-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 800px;">
        <div class="modal-header">
            <h4><i class="ph-fill ph-chart-line-up" style="color: var(--success-color);"></i> تقرير الشواغر المتاحة في العقود النشطة</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div id="available-slots-body" class="modal-body">
            <p style="text-align: center;">جاري حساب الشواغر المتاحة...</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="add-to-coverage-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 600px;">
        <div class="modal-header">
            <h4>إضافة وردية للتغطية</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="coverage-original-shift-details">
            <p>أنت على وشك إضافة وردية الحارس الغائب كفرصة تغطية متاحة. يرجى تحديد التفاصيل:</p>
            <div class="form-grid">
                <div class="form-group">
                    <label for="coverage-pay">قيمة التغطية (ر.س)</label>
                    <input type="number" id="coverage-pay" placeholder="مثال: 150">
                </div>
                <div class="form-group">
                    <label for="coverage-reason">سبب التغطية</label>
                    <select id="coverage-reason">
                        <option value="غياب">غياب</option>
                        <option value="اجازة">اجازة</option>
                        <option value="استئذان">استئذان</option>
                        <option value="احتياج إضافي">احتياج إضافي</option>
                    </select>
                </div>
            </div>
             <div class="form-grid">
                <div class="form-group">
                    <label for="coverage-start-time">من ساعة</label>
                    <input type="time" id="coverage-start-time">
                </div>
                <div class="form-group">
                    <label for="coverage-end-time">إلى ساعة</label>
                    <input type="time" id="coverage-end-time">
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="save-coverage-shift-btn" class="btn btn-primary">حفظ وطرح للتغطية</button>
            <button class="btn btn-secondary modal-close-btn">إلغاء</button>
        </div>
    </div>
</div>
<div id="view-applicants-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 800px;">
        <div class="modal-header">
            <h4>المتقدمون للوردية</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body" id="applicants-list-body">
            <p style="text-align:center;">جاري تحميل المتقدمين...</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="create-coverage-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 700px;">
        <div class="modal-header">
            <h4>إنشاء تغطية جديدة</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="coverage-edit-id">
            <div class="form-group">
                <label for="coverage-link-vacancy">ربط بشاغر مفتوح (اختياري)</label>
                <select id="coverage-link-vacancy">
                    <option value="">-- تغطية يدوية بدون ربط بشاغر --</option>
                </select>
            </div>
            <hr style="margin: 25px 0;">
            <div class="form-grid">
                <div class="form-group">
                    <label for="coverage-new-project">المشروع</label>
                    <input type="text" id="coverage-new-project" placeholder="اسم المشروع">
                </div>
                <div class="form-group">
                    <label for="coverage-new-location">الموقع (الفرع)</label>
                    <input type="text" id="coverage-new-location" placeholder="اسم الموقع المحدد">
                </div>
                <div class="form-group">
                    <label for="coverage-new-region">المنطقة</label>
                    <input type="text" id="coverage-new-region" placeholder="المنطقة">
                </div>
                <div class="form-group">
                    <label for="coverage-new-city">المدينة</label>
                    <input type="text" id="coverage-new-city" placeholder="المدينة">
                </div>
            </div>
            <div class="form-grid" style="grid-template-columns: 1fr 1fr 1fr;">
                <div class="form-group">
                    <label for="coverage-new-start-time">من ساعة</label>
                    <input type="time" id="coverage-new-start-time">
                </div>
                <div class="form-group">
                    <label for="coverage-new-end-time">إلى ساعة</label>
                    <input type="time" id="coverage-new-end-time">
                </div>
                <div class="form-group">
                    <label for="coverage-new-pay">قيمة التغطية (ر.س)</label>
                    <input type="number" id="coverage-new-pay" placeholder="مثال: 150">
                </div>
            </div>
            <div class="form-group">
                <label for="coverage-new-reason">سبب التغطية</label>
                <select id="coverage-new-reason">
                    <option value="غياب">غياب</option>
                    <option value="اجازة">اجازة</option>
                    <option value="استئذان">استئذان</option>
                    <option value="احتياج إضافي">احتياج إضافي</option>
                    <option value="شاغر مؤقت">شاغر مؤقت</option>
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button id="save-new-coverage-btn" class="btn btn-primary">حفظ وطرح للتغطية</button>
            <button class="btn btn-secondary modal-close-btn">إلغاء</button>
        </div>
    </div>
</div>
<div id="send-directive-modal" class="modal-overlay hidden">
    <div class="modal-panel">
        <div class="modal-header">
            <h4 id="send-directive-modal-title">إرسال توجيه إلى: </h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="directive-recipient-id">
            <div class="form-group">
                <label for="directive-content">نص التوجيه</label>
                <textarea id="directive-content" rows="6" placeholder="اكتب نص التوجيه هنا..."></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button id="send-directive-btn" class="btn btn-primary">إرسال</button>
            <button class="btn btn-secondary modal-close-btn">إلغاء</button>
        </div>
    </div>
</div>
<div id="end-patrol-modal" class="modal-overlay hidden">
    <div class="modal-panel">
        <div class="modal-header">
            <h4>إنهاء الجولة الميدانية</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="active-patrol-id">
            <div class="form-group">
                <label for="patrol-notes">ملاحظات نهاية الجولة</label>
                <textarea id="patrol-notes" rows="6" placeholder="اكتب ملخصاً أو ملاحظات هامة عن الجولة..."></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button id="confirm-end-patrol-btn" class="btn btn-primary">تأكيد وإنهاء الجولة</button>
            <button class="btn btn-secondary modal-close-btn">إلغاء</button>
        </div>
    </div>
</div>
<div id="applicant-details-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 600px;">
        <div class="modal-header">
            <h4>تفاصيل المتقدم</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div id="applicant-details-body" class="modal-body">
            <p style="text-align: center;">جاري تحميل البيانات...</p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="ops-review-applicant-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 900px;">
        <div class="modal-header">
            <h4>مراجعة واعتماد مرشح</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="ops-review-form">
            <div class="modal-body">
                <input type="hidden" id="review-app-id">
                <input type="hidden" id="review-vacancy-id">
                
                <p style="margin-bottom: 20px;">يمكنك مراجعة وتعديل بيانات المرشح قبل اعتماده النهائي وتوظيفه.</p>

                <div id="ops-review-form-body"></div>
            </div>
            <div class="modal-footer">
                <button type="submit" id="final-approve-btn" class="btn btn-primary">
                    <i class="ph-bold ph-user-plus"></i> اعتماد نهائي وتوظيف
                </button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>
<div id="swap-employee-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 600px;">
        <div class="modal-header">
            <h4>تبديل موظف الشاغر</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="swap-vacancy-id">
            <input type="hidden" id="swap-current-user-id">
            
            <div class="form-group">
                <label>الموظف الحالي في الشاغر</label>
                <input type="text" id="swap-current-user-name" readonly style="background-color: #e9ecef;">
            </div>
            
            <div class="form-group">
                <label for="swap-new-employee-select">اختر الموظف الجديد (البديل)</label>
                <select id="swap-new-employee-select">
                    <option value="">جاري تحميل الموظفين...</option>
                </select>
            </div>
            <p class="text-secondary" style="font-size: 0.9rem;">ملاحظة: إذا كان الموظف البديل يشغل شاغراً آخر، فسيتم تبديل أماكنهما.</p>
        </div>
        <div class="modal-footer">
            <button id="save-swap-btn" class="btn btn-primary">حفظ التبديل</button>
            <button class="btn btn-secondary modal-close-btn">إلغاء</button>
        </div>
    </div>
</div>
<script>
  if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/firebase-messaging-sw.js')
          .then(reg => {
              console.log("Firebase SW Registered", reg);
          });
  }
</script>


<div id="add-penalty-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 550px;">
        <div class="modal-header">
            <h4 id="penalty-modal-title">إضافة عقوبة جديدة</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="penalty-user-id">
            <div class="form-group">
                <label for="penalty-reason">سبب العقوبة / الخصم</label>
                <textarea id="penalty-reason" rows="4" placeholder="مثال: إتلاف ممتلكات، مخالفة تعليمات..."></textarea>
            </div>
            <div class="form-group">
                <label for="penalty-amount">مبلغ الخصم (ر.س)</label>
                <input type="number" id="penalty-amount" placeholder="مثال: 150">
            </div>
             <div class="form-group">
                <label for="penalty-date">تاريخ تطبيق الخصم (سيتم الخصم في مسير هذا الشهر)</label>
                <input type="date" id="penalty-date">
            </div>
        </div>
        <div class="modal-footer">
            <button id="save-penalty-btn" class="btn btn-danger">حفظ وتطبيق الخصم</button>
            <button class="btn btn-secondary modal-close-btn">إلغاء</button>
        </div>
    </div>
</div>
<div id="image-viewer-modal" class="modal-overlay hidden" style="z-index: 1001;">
    <div class="modal-panel" style="background: none; box-shadow: none; padding: 0; max-width: 90vw; max-height: 90vh;">
         <button class="modal-close-btn" style="color: white; font-size: 2rem; position: absolute; top: 15px; right: 25px; background: rgba(0,0,0,0.5); border-radius: 50%; width: 40px; height: 40px; line-height: 40px;">
            <i class="ph-bold ph-x"></i>
        </button>
        <img id="zoomed-image" src="" alt="صورة مكبرة" style="max-width: 100%; max-height: 100%; object-fit: contain;">
    </div>
</div>

<div id="assignment-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 800px;">
        <div class="modal-header">
            <h4 id="assignment-modal-title">تعيين موظف للتغطية</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <div class="tabs">
                <a href="#" class="tab-link active" data-tab="assign-employees"><i class="ph-bold ph-user-gear"></i> الموظفون المتقدمون</a>
                <a href="#" class="tab-link" data-tab="assign-nominees"><i class="ph-bold ph-user"></i> المرشحون الخارجيون</a>
                <a href="#" class="tab-link" data-tab="assign-direct"><i class="ph-bold ph-hand-pointing"></i> تكليف مباشر</a>
            </div>

            <div id="assign-employees" class="tab-content active" style="padding-top: 20px;">
                </div>
            <div id="assign-nominees" class="tab-content" style="padding-top: 20px;">
                </div>
            <div id="assign-direct" class="tab-content" style="padding-top: 20px;">
                </div>
        </div>
    </div>
</div>
<div id="absentee-report-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 900px;">
        <div class="modal-header">
            <h4>مسير الخصم للحراس الغائبين</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div id="absentee-report-body" class="modal-body">
            <p style="text-align: center;">جاري توليد التقرير...</p>
        </div>
        <div class="modal-footer">
            <div class="modal-footer">
            <button id="export-absentee-report-btn" class="btn btn-success">
                <i class="ph-bold ph-file-xls"></i> تصدير إلى Excel
            </button>
            <button class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
            <button class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="custom-alert-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 450px;">
        <div id="custom-alert-header" class="modal-header">
            <h4 id="custom-alert-title">عنوان الرسالة</h4>
        </div>
        <div class="modal-body" style="text-align: center; padding: 30px 25px;">
            <p id="custom-alert-message" style="font-size: 1.1rem; line-height: 1.7; margin: 0;"></p>
        </div>
        <div class="modal-footer" style="justify-content: center;">
            <button id="custom-alert-close-btn" class="btn btn-primary" style="min-width: 120px;">حسنًا</button>
        </div>
    </div>
</div>
<div id="feedback-modal" class="modal-overlay hidden">
    <div class="modal-panel">
        <div class="modal-header"><h4>إرسال شكوى أو اقتراح</h4><button class="modal-close-btn"><i class="ph-bold ph-x"></i></button></div>
        <form id="feedback-form">
            <div class="modal-body">
                <div class="form-group">
                    <label for="feedback-type">نوع الرسالة</label>
                    <select id="feedback-type">
                        <option value="شكوى">شكوى</option>
                        <option value="اقتراح">اقتراح</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="feedback-content">محتوى الرسالة</label>
                    <textarea id="feedback-content" rows="6" placeholder="يرجى توضيح الشكوى أو الاقتراح بالتفصيل..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary">إرسال</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>
<div id="toast-container"></div>
<div id="admin-edit-attendance-modal" class="modal-overlay hidden">
    <div class="modal-panel">
        <div class="modal-header">
            <h4 id="edit-attendance-title">تعديل سجل الحضور</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="edit-attendance-id">
            <div class="form-group">
                <label for="edit-attendance-status">تغيير الحالة إلى</label>
                <select id="edit-attendance-status">
                    <option value="حاضر">حاضر</option>
                    <option value="اكمل المناوبة">أكمل المناوبة</option>
                    <option value="انسحاب">انسحاب</option>
                    <option value="غياب">غياب</option>
                    <option value="استئذان">استئذان</option>
                    <option value="غياب (تم تغطيته)">غياب (تم تغطيته)</option>
                    <option value="انسحاب (تم تغطيته)">انسحاب (تم تغطيته)</option>
                    <option value="استئذان (تم تغطيته)">استئذان (تم تغطيته)</option>
                </select>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label for="edit-checkin-time">وقت الحضور</label>
                    <input type="datetime-local" id="edit-checkin-time">
                </div>
                <div class="form-group">
                    <label for="edit-checkout-time">وقت الانصراف</label>
                    <input type="datetime-local" id="edit-checkout-time">
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="save-attendance-changes-btn" class="btn btn-primary">حفظ التعديلات</button>
            <button class="btn btn-secondary modal-close-btn">إلغاء</button>
        </div>
    </div>
</div>
<div id="unlinked-vacancies-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 900px;">
        <div class="modal-header">
            <h4>تقرير الشواغر غير المرتبطة بعقود نشطة</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div id="unlinked-vacancies-body" class="modal-body">
            <p style="text-align: center;">جاري البحث عن الشواغر الزائدة...</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="employee-data-check-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 900px;">
        <div class="modal-header">
            <h4>تقرير مشاكل بيانات التسكين الوظيفي</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div id="employee-data-check-body" class="modal-body">
            <p style="text-align: center;">جاري فحص بيانات الموظفين...</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="manual-attendance-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 600px;">
        <div class="modal-header">
            <h4 id="manual-attendance-modal-title">إضافة سجل يدوي</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="manual-attendance-user-select">اختر الموظف</label>
                <select id="manual-attendance-user-select">
                    <option value="">-- الرجاء الاختيار --</option>
                </select>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label for="manual-checkin-time">وقت وتاريخ الحضور</label>
                    <input type="datetime-local" id="manual-checkin-time">
                </div>
                <div class="form-group">
                    <label for="manual-checkout-time">وقت وتاريخ الانصراف (اختياري)</label>
                    <input type="datetime-local" id="manual-checkout-time">
                </div>
            </div>
            <div class="form-group">
                <label for="manual-attendance-status">حالة السجل</label>
                <select id="manual-attendance-status">
                    <option value="اكمل المناوبة">أكمل المناوبة</option>
                    <option value="حاضر">حاضر (بدون تسجيل انصراف)</option>
                    <option value="غياب">غياب</option>
                    <option value="انسحاب">انسحاب</option>
                    <option value="استئذان">استئذان</option>
                </select>
            </div>
            <div class="form-group">
                <label for="manual-attendance-notes">ملاحظات (اختياري)</label>
                <textarea id="manual-attendance-notes" rows="3" placeholder="اكتب أي ملاحظات ضرورية..."></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button id="save-manual-attendance-btn" class="btn btn-primary">حفظ السجل</button>
            <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
        </div>
    </div>
</div>
<div id="edit-guard-schedule-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 600px;">
        <div class="modal-header">
            <h4>تعديل جدول الحارس</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="edit-schedule-vacancy-id">
            <input type="hidden" id="edit-schedule-current-json">
            
            <div class="form-group">
                <label>فترات العمل (الأوقات)</label>
                <div id="edit-schedule-periods-container" style="display: flex; flex-direction: column; gap: 10px;">
                    </div>
                <button type="button" id="add-period-to-schedule-btn" class="btn btn-secondary btn-sm" style="margin-top: 10px; width: 100%; border-style: dashed;">
                    <i class="ph-bold ph-plus"></i> إضافة فترة عمل أخرى
                </button>
            </div>

            <hr style="margin: 20px 0;">

            <div class="form-group">
                <label>أيام العمل الأسبوعية</label>
                <div class="checkbox-group-container">
                    <div class="checkbox-grid" style="grid-template-columns: repeat(4, 1fr);">
                        <label><input type="checkbox" name="edit-schedule-days" value="Sat"> السبت</label>
                        <label><input type="checkbox" name="edit-schedule-days" value="Sun"> الأحد</label>
                        <label><input type="checkbox" name="edit-schedule-days" value="Mon"> الاثنين</label>
                        <label><input type="checkbox" name="edit-schedule-days" value="Tue"> الثلاثاء</label>
                        <label><input type="checkbox" name="edit-schedule-days" value="Wed"> الأربعاء</label>
                        <label><input type="checkbox" name="edit-schedule-days" value="Thu"> الخميس</label>
                        <label><input type="checkbox" name="edit-schedule-days" value="Fri"> الجمعة</label>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="save-guard-schedule-btn" class="btn btn-primary">حفظ التغييرات</button>
            <button class="btn btn-secondary modal-close-btn">إلغاء</button>
        </div>
    </div>
</div>
<div id="edit-snapshot-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 700px;">
        <div class="modal-header">
            <h4 id="snapshot-modal-title">تعديل لقطة الوردية (Snapshot)</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="snapshot-attendance-id">
            <input type="hidden" id="snapshot-guard-id">

            <div class="form-group">
                <label>اختر طريقة التعديل</label>
                <div class="tabs" style="margin-bottom: 0; justify-content: space-around;">
                    <a href="#" class="tab-link active" data-tab="snapshot-previous-group"><i class="ph-bold ph-clock-counter-clockwise"></i> سجل سابق</a>
                    <a href="#" class="tab-link" data-tab="snapshot-current-group"><i class="ph-bold ph-user-focus"></i> الشاغر الحالي</a>
                    <a href="#" class="tab-link" data-tab="snapshot-manual-group"><i class="ph-bold ph-pencil-simple"></i> إدخال يدوي</a>
                </div>
            </div>

            <div id="snapshot-previous-group" class="tab-content active" style="padding-top: 20px;">
                <p>اختر من قائمة اللقطات المسجلة مسبقاً لهذا الحارس.</p>
                <div class="form-group">
                    <label for="snapshot-previous-select">السجلات المتاحة</label>
                    <select id="snapshot-previous-select">
                        <option value="">-- اختر سجل --</option>
                    </select>
                </div>
            </div>

            <div id="snapshot-current-group" class="tab-content" style="padding-top: 20px; text-align: center;">
                <p>سيتم جلب بيانات الشاغر الوظيفي الحالي للحارس وتعبئتها في حقول الإدخال اليدوي لتتمكن من مراجعتها وتعديلها قبل الحفظ.</p>
                <button id="fetch-current-snapshot-btn" class="btn btn-secondary" style="width: 50%;">
                    <i class="ph-bold ph-download-simple"></i> جلب البيانات الحالية
                </button>
            </div>

            <div id="snapshot-manual-group" class="tab-content" style="padding-top: 20px;">
                 <div class="form-grid">
                    <div class="form-group"><label>المشروع</label><input type="text" id="snapshot-manual-project"></div>
                    <div class="form-group"><label>الموقع</label><input type="text" id="snapshot-manual-location"></div>
                    <div class="form-group"><label>المنطقة</label><input type="text" id="snapshot-manual-region"></div>
                    <div class="form-group"><label>المدينة</label><input type="text" id="snapshot-manual-city"></div>
                </div>
                <div class="form-group">
                    <label>تفاصيل الوردية (JSON)</label>
                    <textarea id="snapshot-manual-schedule" rows="6" style="text-align: left; direction: ltr;"></textarea>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="save-snapshot-btn" class="btn btn-primary">حفظ التعديلات</button>
            <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
        </div>
    </div>
</div>
<div id="return-to-admin-banner" class="hidden">
    <button id="return-to-admin-btn" class="btn"><i class="ph-bold ph-arrow-u-up-left"></i> العودة لحساب المدير</button>
    <p>أنت الآن تسجل الدخول بحساب مستخدم آخر.</p>
</div>
<div id="publish-coverage-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 500px;">
        <div class="modal-header">
            <h4>طرح وردية للتغطية</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="publish-coverage-form">
            <div class="modal-body">
                <input type="hidden" id="publish-need-data">
                <p>أنت على وشك طرح وردية جديدة للتغطية. الرجاء تحديد المقابل المادي لهذه الوردية.</p>
                <div class="form-group" style="margin-top: 20px;">
                    <label for="publish-coverage-pay">قيمة التغطية (بالريال السعودي)</label>
                    <input type="number" id="publish-coverage-pay" required step="0.01" min="1">
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" id="save-published-coverage-btn" class="btn btn-primary">
                    <i class="ph-bold ph-shield-check"></i> حفظ وطرح للتغطية
                </button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>

<div id="review-applicants-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 650px;">
        <div class="modal-header">
            <h4>مراجعة المتقدمين</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <div id="review-applicants-list-container">
                <p style="text-align: center;">جاري تحميل قائمة المتقدمين...</p>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="confirm-payment-modal" class="modal-overlay hidden">
    <div class="modal-panel">
        <div class="modal-header">
            <h4>تأكيد الصرف وتوثيق العملية</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="confirm-payment-form">
            <div class="modal-body">
                <input type="hidden" id="payment-id-for-confirmation">
                <div class="form-group">
                    <label for="payment-notes">ملاحظات وتقييم أداء حارس التغطية (إجباري)</label>
                    <textarea id="payment-notes" rows="4" placeholder="مثال: كان الحارس ملتزماً ومتعاوناً..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="payment-proof-upload">إرفاق إثبات الصرف (اختياري)</label>
                    <input type="file" id="payment-proof-upload" accept="image/*,application/pdf">
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary">تأكيد الصرف النهائي</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>

<div id="exclude-payment-modal" class="modal-overlay hidden">
    <div class="modal-panel">
        <div class="modal-header">
            <h4>استبعاد عملية الصرف</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="exclude-payment-form">
            <div class="modal-body">
                <input type="hidden" id="payment-id-for-exclusion">
                <div class="form-group">
                    <label for="exclusion-reason">سبب الاستبعاد (إجباري)</label>
                    <textarea id="exclusion-reason" rows="4" placeholder="يرجى توضيح سبب عدم صرف المبلغ لهذا الحارس..." required></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-danger">تأكيد الاستبعاد</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>
<div id="disburse-custody-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 500px;">
        <div class="modal-header">
            <h4 id="disburse-custody-title">صرف عهدة جديدة</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="disburse-custody-form">
            <div class="modal-body">
                <input type="hidden" id="disburse-supervisor-id">
                <p id="disburse-supervisor-info"></p>
                <div class="form-group">
                    <label for="disbursement-amount">المبلغ المراد صرفه (ر.س)</label>
                    <input type="number" id="disbursement-amount" required min="1">
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary">تأكيد الصرف</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>

<div id="review-custody-report-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 900px;">
        <div class="modal-header">
            <h4 id="review-report-title">مراجعة تقرير المصروفات</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div id="review-report-body" class="modal-body">
            <p style="text-align: center;">جاري تحميل تفاصيل التقرير...</p>
        </div>
        <div class="modal-footer">
            <button type="button" id="settle-report-btn" class="btn btn-success"><i class="ph-bold ph-check-circle"></i> اعتماد التقرير وتسويته</button>
            <button type="button" class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="custom-confirm-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 500px;">
        <div class="modal-header">
            <h4 id="custom-confirm-title">تأكيد الإجراء</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <p id="custom-confirm-message" style="line-height: 1.8; white-space: pre-wrap;"></p>
        </div>
        <div class="modal-footer">
            <button id="custom-confirm-yes-btn" class="btn btn-primary">نعم، متابعة</button>
            <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
        </div>
    </div>
</div>
<div id="site-assignment-modal" class="modal-overlay hidden" style="z-index: 1001;">
    <div class="modal-panel" style="max-width: 700px; max-height: 90vh;">
        <div class="modal-header">
            <h4>تحديد المواقع للمشرف: <span id="assignment-modal-supervisor-name"></span></h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body" style="padding: 15px 20px;">
            <div class="report-filters-card" style="padding: 15px; background-color: #f1f5f9; box-shadow: none;">
                <div class="filter-grid" style="grid-template-columns: 1fr 1fr 2fr;">
                    <div class="filter-group">
                        <label>فلترة بالمنطقة</label>
                        <select id="assignment-filter-region">
                            <option value="">كل المناطق</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>فلترة بالمدينة</label>
                        <select id="assignment-filter-city" disabled>
                            <option value="">اختر منطقة أولاً</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>بحث سريع باسم العقد أو الموقع</label>
                        <input type="text" id="assignment-search-input" placeholder="اكتب هنا للبحث...">
                    </div>
                </div>
            </div>
            <div id="assignment-tree-container" class="assignment-tree">
                <p style="text-align: center; padding: 20px;">جاري تحميل العقود والمواقع...</p>
            </div>
        </div>
        <div class="modal-footer">
            <button id="save-site-assignments-btn" class="btn btn-primary">حفظ التحديد</button>
            <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
        </div>
    </div>
</div>
<div id="marketing-client-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 500px;">
        <div class="modal-header">
            <h4>تحديث بيانات العميل</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="marketing-contract-id">
            <div class="form-group">
                <label for="marketing-client-status">حالة العميل</label>
                <select id="marketing-client-status">
                    <option value="جديد">جديد</option>
                    <option value="تم التواصل">تم التواصل</option>
                    <option value="مهتم">مهتم</option>
                    <option value="قيد التفاوض">قيد التفاوض</option>
                    <option value="تم التجديد">تم التجديد</option>
                    <option value="غير مهتم">غير مهتم</option>
                </select>
            </div>
            <div class="form-group">
                <label for="marketing-last-contact">تاريخ آخر تواصل</label>
                <input type="date" id="marketing-last-contact">
            </div>
            <div class="form-group">
                <label for="marketing-notes">ملاحظات</label>
                <textarea id="marketing-notes" rows="4" placeholder="أضف ملاحظاتك هنا..."></textarea>
            </div>
            <div class="form-group">
                <label>تقييم رضا العميل</label>
                <div id="marketing-client-rating-stars" class="stars-input" style="font-size: 2rem; color: #cbd5e1; cursor: pointer; text-align: right;">
                    <i class="ph-bold ph-star" data-value="1"></i>
                    <i class="ph-bold ph-star" data-value="2"></i>
                    <i class="ph-bold ph-star" data-value="3"></i>
                    <i class="ph-bold ph-star" data-value="4"></i>
                    <i class="ph-bold ph-star" data-value="5"></i>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="save-marketing-data-btn" class="btn btn-primary">حفظ التغييرات</button>
            <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
        </div>
    </div>
</div>
<div id="marketing-event-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 600px;">
        <div class="modal-header">
            <h4 id="marketing-event-modal-title">إضافة موعد جديد</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="marketing-event-form">
            <div class="modal-body">
                <input type="hidden" id="marketing-event-id">
                <div class="form-group">
                    <label for="marketing-event-title">عنوان الموعد</label>
                    <input type="text" id="marketing-event-title" required placeholder="مثال: اجتماع متابعة مع العميل X">
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="marketing-event-start">وقت البدء</label>
                        <input type="datetime-local" id="marketing-event-start" required>
                    </div>
                    <div class="form-group">
                        <label for="marketing-event-end">وقت الانتهاء (اختياري)</label>
                        <input type="datetime-local" id="marketing-event-end">
                    </div>
                </div>
                <div class="form-group">
                    <label for="marketing-event-contract">ربط بعميل (اختياري)</label>
                    <select id="marketing-event-contract">
                        <option value="">بدون ربط</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="marketing-reminder-datetime">تحديد وقت وتاريخ إرسال رسالة التذكير (اختياري)</label>
                    <input type="datetime-local" id="marketing-reminder-datetime">
                </div>
                <div class="form-group">
                    <label for="marketing-event-description">التفاصيل</label>
                    <textarea id="marketing-event-description" rows="3" placeholder="أضف تفاصيل إضافية هنا..."></textarea>
                </div>
            </div>
                <div class="modal-footer">
                <button type="submit" class="btn btn-primary"><i class="ph-bold ph-floppy-disk"></i> حفظ الموعد</button>
                <button type="button" id="delete-marketing-event-btn" class="btn btn-danger" style="margin-right: auto;"><i class="ph-bold ph-trash"></i> حذف</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
        </form>
    </div>
</div>
<div id="legal-event-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 600px;">
        <div class="modal-header">
            <h4 id="legal-event-modal-title">إضافة موعد جديد</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="legal-event-form">
            <div class="modal-body">
                <input type="hidden" id="legal-event-id">
                <div class="form-group">
                    <label for="legal-event-title">عنوان الموعد/الإجراء</label>
                    <input type="text" id="legal-event-title" required placeholder="مثال: جلسة محكمة قضية رقم 123">
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="legal-event-start">وقت البدء</label>
                        <input type="datetime-local" id="legal-event-start" required>
                    </div>
                    <div class="form-group">
                        <label for="legal-event-end">وقت الانتهاء (اختياري)</label>
                        <input type="datetime-local" id="legal-event-end">
                    </div>
                </div>
                <div class="form-group">
                    <label for="legal-case-number">رقم القضية/العقد (اختياري)</label>
                    <input type="text" id="legal-case-number" placeholder="لربط الموعد بملف معين">
                </div>
                <div class="form-group"> <label for="legal-reminder-datetime">إرسال رسالة تذكير في (اختياري)</label> <input type="datetime-local" id="legal-reminder-datetime"> </div> 
                <div class="form-group">
                    <label for="legal-event-description">التفاصيل</label>
                    <textarea id="legal-event-description" rows="3" placeholder="أضف تفاصيل إضافية هنا..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary"><i class="ph-bold ph-floppy-disk"></i> حفظ الموعد</button>
                <button type="button" id="delete-legal-event-btn" class="btn btn-danger" style="margin-right: auto;"><i class="ph-bold ph-trash"></i> حذف</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>
<div id="add-legal-penalty-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 550px;">
        <div class="modal-header">
            <h4 id="legal-penalty-modal-title">إضافة جزاء جديد</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="legal-penalty-form">
            <div class="modal-body">
                <input type="hidden" id="legal-penalty-user-id">
                <div class="form-group">
                    <label for="legal-penalty-type">نوع الجزاء</label>
                    <select id="legal-penalty-type" required>
                        <option value="غياب">غياب</option>
                        <option value="تأخير">تأخير</option>
                        <option value="إهمال بواجبات العمل">إهمال بواجبات العمل</option>
                        <option value="إتلاف ممتلكات">إتلاف ممتلكات</option>
                        <option value="مخالفة أخرى">مخالفة أخرى</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="legal-penalty-notes">التفاصيل والملاحظات</label>
                    <textarea id="legal-penalty-notes" rows="4" placeholder="اكتب تفاصيل المخالفة هنا..." required></textarea>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="legal-penalty-amount">مبلغ الخصم (ر.س)</label>
                        <input type="number" id="legal-penalty-amount" value="0" min="0">
                    </div>
                    <div class="form-group">
                        <label for="legal-penalty-date">تاريخ تطبيق الخصم</label>
                        <input type="date" id="legal-penalty-date" required>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-danger">حفظ وتطبيق الجزاء</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>
<div id="vehicle-modal" class="modal-overlay hidden">
    <div class="modal-panel">
        <div class="modal-header">
            <h4 id="vehicle-modal-title">إضافة مركبة جديدة</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="vehicle-form">
            <div class="modal-body">
                <input type="hidden" id="vehicle-id">
                <input type="hidden" id="vehicle-contract-id">
                <input type="hidden" id="vehicle-location-name">
                <div class="form-group">
                    <label for="vehicle-type">نوع المركبة والموديل</label>
                    <input type="text" id="vehicle-type" placeholder="مثال: تويوتا كورولا 2024" required>
                </div>
                <div class="form-group">
                    <label for="vehicle-license-plate">رقم اللوحة</label>
                    <input type="text" id="vehicle-license-plate" placeholder="أ ب ج 1234" required>
                </div>
                <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                    <div class="form-group">
                        <label for="vehicle-reg-expiry">تاريخ انتهاء الاستمارة</label>
                        <input type="date" id="vehicle-reg-expiry" required>
                    </div>
                    <div class="form-group">
                        <label for="vehicle-insurance-expiry">تاريخ انتهاء التأمين</label>
                        <input type="date" id="vehicle-insurance-expiry">
                    </div>
                </div>

                <div class="form-group">
                    <label for="vehicle-ownership-type">نوع الملكية</label>
                    <select id="vehicle-ownership-type">
                        <option value="ملك">ملك</option>
                        <option value="إيجار">إيجار</option>
                    </select>
                </div>

                <div id="vehicle-rental-fields" class="form-grid hidden" style="grid-column: 1 / -1;">
                    <div class="form-group">
                        <label for="vehicle-rental-office">اسم مكتب الإيجار</label>
                        <input type="text" id="vehicle-rental-office">
                    </div>
                    <div class="form-group">
                        <label for="vehicle-rental-contact">رقم تواصل المكتب</label>
                        <input type="text" id="vehicle-rental-contact">
                    </div>
                </div>

                <div class="form-group">
                    <div class="form-grid">
                    <div class="form-group">
                        <label for="vehicle-contract-select">العقد</label>
                        <select id="vehicle-contract-select">
                            <option value="">-- اختر عقداً --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="vehicle-location-select">الموقع</label>
                        <select id="vehicle-location-select" disabled>
                            <option value="">اختر عقداً أولاً</option>
                        </select>
                    </div>
                </div>
                </div>
                <div class="form-group">
                    <label for="vehicle-supervisor">الموظف المستلم</label>
                    <select id="vehicle-supervisor">
                        <option value="">-- اختر موظف --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="vehicle-status">حالة المركبة</label>
                    <select id="vehicle-status">
                        <option value="فعالة">فعالة</option>
                        <option value="صيانة">صيانة</option>
                        <option value="خارج الخدمة">خارج الخدمة</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" id="save-vehicle-btn" class="btn btn-primary">حفظ المركبة</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>
<div id="admin-asset-modal" class="modal-overlay hidden">
    <div class="modal-panel">
        <div class="modal-header">
            <h4 id="admin-asset-modal-title">تسليم عهدة جديدة</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="admin-asset-form">
            <div class="modal-body">
                <input type="hidden" id="admin-asset-id">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="admin-asset-type-search">نوع العهدة (من المخزون)</label>
                        <div class="custom-select-wrapper">
                            <input type="text" id="admin-asset-type-search" class="custom-select-search" placeholder="ابحث عن نوع عهدة...">
                            <div id="admin-asset-type-options" class="custom-select-options"></div>
                        </div>
                        <input type="hidden" id="admin-asset-type" required>
                    </div>
                    <div class="form-group">
                        <label for="admin-asset-employee-search">تسليم إلى الموظف</label>
                        <div class="custom-select-wrapper">
                            <input type="text" id="admin-asset-employee-search" class="custom-select-search" placeholder="ابحث عن موظف...">
                            <div id="admin-asset-employee-options" class="custom-select-options"></div>
                        </div>
                        <input type="hidden" id="admin-asset-employee" required>
                    </div>
                </div>

                <div id="admin-asset-item-group" class="form-group hidden">
                    <label for="admin-asset-item-search">اختر قطعة العهدة المتاحة من المخزون</label>
                    <div class="custom-select-wrapper">
                        <input type="text" id="admin-asset-item-search" class="custom-select-search" placeholder="ابحث بالرقم التسلسلي أو المعرف...">
                        <div id="admin-asset-item-options" class="custom-select-options"></div>
                    </div>
                    <input type="hidden" id="admin-asset-item" required>
                </div>

                <div class="form-group">
                    <label for="admin-asset-serial">الرقم التسلسلي (يتم تعبئته تلقائياً)</label>
                    <input type="text" id="admin-asset-serial" readonly style="background-color: #e9ecef;">
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="admin-asset-date">تاريخ التسليم</label>
                        <input type="date" id="admin-asset-date" required>
                    </div>
                    <div class="form-group">
                        <label for="admin-asset-condition">حالة العهدة عند التسليم</label>
                        <select id="admin-asset-condition" required>
                            <option value="جديد">جديد</option>
                            <option value="مستعمل">مستعمل</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="admin-asset-status">الحالة الحالية (للتعديل فقط)</label>
                    <select id="admin-asset-status" disabled>
                        <option value="في الخدمة">في الخدمة</option>
                        <option value="صيانة">صيانة</option>
                        <option value="مرتجع">مرتجع</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="admin-asset-notes">ملاحظات</label>
                    <textarea id="admin-asset-notes" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" id="save-admin-asset-btn" class="btn btn-primary">حفظ</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>
<div id="guard-asset-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 800px;">
        <div class="modal-header">
            <h4 id="guard-asset-modal-title">إدارة أجهزة الموقع</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="ga-modal-contract-id">
            <input type="hidden" id="ga-modal-location-name">

            <div class="review-request-card" style="margin-bottom: 25px;">
                <div class="review-request-header status-approved" style="color:var(--text-primary)">
                    <h4>تسليم جهاز جديد لهذا الموقع</h4>
                </div>
                <form id="assign-guard-asset-form">
                    <div class="review-request-body">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="ga-available-device-select">اختر الجهاز المتوفر من المخزون</label>
                                <select id="ga-available-device-select" required></select>
                            </div>
                            <div class="form-group">
                                <label for="ga-supervisor-select">الموظف المسؤول عن العهدة</label>
                                <select id="ga-supervisor-select" required></select>
                            </div>
                        </div>
                         <div style="text-align: left; margin-top: 15px;">
                            <button type="submit" class="btn btn-primary">تسليم الجهاز</button>
                        </div>
                    </div>
                </form>
            </div>

            <h4>الأجهزة المسلمة حالياً للموقع</h4>
            <div id="deployed-guard-assets-list" class="table-container" style="padding:0; box-shadow:none;">
                <p>لم يتم تسليم أي أجهزة لهذا الموقع بعد.</p>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="add-asset-item-modal" class="modal-overlay hidden">
    <div class="modal-panel">
        <div class="modal-header">
            <h4 id="asset-item-modal-title">إضافة</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="add-asset-item-form">
            <div class="modal-body">
                <input type="hidden" id="asset-item-inventory-id">
                <div id="asset-items-list-container" style="max-height: 40vh; overflow-y: auto; padding: 10px; border: 1px dashed var(--border-color); border-radius: 8px; background-color: #f8f9fa;">
                    </div>
            </div>
            <div class="modal-footer" style="justify-content: space-between;">
                <button type="submit" id="save-asset-item-btn" class="btn btn-primary"><i class="ph-bold ph-floppy-disk"></i> حفظ الكل</button>
                <button type="button" id="add-another-asset-item-btn" class="btn btn-secondary"><i class="ph-bold ph-plus"></i> إضافة آخر</button>
            </div>
        </form>
    </div>
</div>
<div id="inventory-details-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 1100px;">
        <div class="modal-header">
            <h4 id="inventory-details-title">إدارة العهدة</h4>
            <div style="display: flex; gap: 10px;">
                <button id="export-inventory-btn" class="btn btn-success"><i class="ph-bold ph-file-xls"></i> تصدير Excel</button>
                <button id="add-item-from-details-btn" class="btn btn-primary"><i class="ph-bold ph-plus"></i> إضافة قطعة جديدة</button>
            </div>
        </div>
        <div class="modal-body">
            <div class="stats-grid" style="grid-template-columns: repeat(4, 1fr); margin-bottom: 20px;">
                <div class="stat-card-mini"><i class="ph-bold ph-stack"></i><div><h4 id="inv-details-stat-total">0</h4><p>الإجمالي</p></div></div>
                <div class="stat-card-mini" style="--stat-color: #22c55e;"><i class="ph-bold ph-storefront"></i><div><h4 id="inv-details-stat-instock">0</h4><p>في المخزن</p></div></div>
                <div class="stat-card-mini" style="--stat-color: #3b82f6;"><i class="ph-bold ph-user-gear"></i><div><h4 id="inv-details-stat-assigned">0</h4><p>مسلمة لموظف</p></div></div>
                <div class="stat-card-mini" style="--stat-color: #f59e0b;"><i class="ph-bold ph-wrench"></i><div><h4 id="inv-details-stat-maintenance">0</h4><p>صيانة</p></div></div>
            </div>
            <div class="filter-group">
                <label>بحث سريع في هذه الفئة</label>
                <input type="text" id="inventory-details-search" placeholder="ابحث بالرقم التسلسلي أو اسم الموظف...">
            </div>
            <div id="inventory-details-table-container" class="table-container" style="margin-top: 15px;">
                <p style="text-align: center;">جاري تحميل البيانات...</p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="add-admin-asset-item-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 700px;">
        <div class="modal-header">
            <h4 id="add-asset-item-modal-title">إضافة قطعة عهدة جديدة للمخزون</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="add-asset-item-form-new">
            <div class="modal-body">
                <div class="form-group">
                    <label for="add-item-category-select">اختر الفئة أولاً</label>
                    <select id="add-item-category-select" required>
                        <option value="">-- اختر فئة --</option>
                    </select>
                </div>

                <hr style="margin: 25px 0;">
                
                <div id="dynamic-asset-fields-container">
                    <p style="text-align: center; color: var(--text-secondary);">الرجاء اختيار فئة لعرض حقولها المخصصة.</p>
                </div>
            </div>
            <div class="modal-footer" style="justify-content: space-between;">
                <button type="submit" id="save-new-asset-item-btn" class="btn btn-primary"><i class="ph-bold ph-floppy-disk"></i> حفظ في المخزون</button>
                <button type="button" id="add-another-asset-form-btn" class="btn btn-secondary hidden"><i class="ph-bold ph-plus"></i> إضافة قطعة أخرى بنفس الفئة</button>
            </div>
        </form>
    </div>
</div>
<div id="add-edit-category-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 600px;">
        <div class="modal-header">
            <h4 id="category-modal-title">إضافة فئة عهدة جديدة</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="add-edit-category-form">
            <div class="modal-body">
                <input type="hidden" id="category-id">
                <div class="form-group">
                    <label for="category-name">اسم الفئة (مثال: لابتوبات، زي رسمي)</label>
                    <input type="text" id="category-name" required>
                </div>

                <hr style="margin: 25px 0;">

                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h4 style="margin: 0; font-size: 1.2rem;">إدارة المعرّفات (الحقول المخصصة)</h4>
                    <button type="button" id="add-category-field-btn" class="btn btn-secondary btn-sm"><i class="ph-bold ph-plus"></i> إضافة حقل</button>
                </div>

                <div id="category-fields-container" style="display: flex; flex-direction: column; gap: 10px; max-height: 250px; overflow-y: auto; padding: 10px; background-color: #f8f9fa; border-radius: 8px;">
                    </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary">حفظ الفئة</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>
<div id="assign-asset-modal" class="modal-overlay hidden">
    <div class="modal-panel">
        <div class="modal-header">
            <h4>تسليم عهدة لموظف</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="assign-asset-form">
            <div class="modal-body">
                <input type="hidden" id="assign-asset-item-id">
                <p>أنت على وشك تسليم العهدة: <strong id="assign-asset-item-name">-</strong></p>
                <div class="form-group">
                    <label for="assign-to-employee-select">تسليم إلى الموظف</label>
                    <select id="assign-to-employee-select" required></select>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="assign-date">تاريخ التسليم</label>
                        <input type="date" id="assign-date" required>
                    </div>
                    <div class="form-group">
                        <label for="assign-condition">حالة العهدة عند التسليم</label>
                        <select id="assign-condition" required>
                            <option value="جديد">جديد</option>
                            <option value="مستعمل">مستعمل</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="assign-notes">ملاحظات</label>
                    <textarea id="assign-notes" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary">تأكيد التسليم</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>
<div id="asset-history-modal" class="modal-overlay hidden">
    <div class="modal-panel">
        <div class="modal-header">
            <h4>سجل أحداث العهدة</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <p><strong>العهدة:</strong> <span id="history-asset-item-name">-</span></p>
            <div id="asset-history-log-container" class="log-container" style="max-height: 60vh;">
                <p style="text-align: center;">جاري تحميل السجل...</p>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="vehicle-history-modal" class="modal-overlay hidden">
    <div class="modal-panel">
        <div class="modal-header">
            <h4>سجل أحداث المركبة</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <p><strong>المركبة:</strong> <span id="history-vehicle-name">-</span></p>
            <div id="vehicle-history-log-container" class="log-container" style="max-height: 60vh;">
                <p style="text-align: center;">جاري تحميل السجل...</p>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="vehicle-invoice-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 600px;">
        <div class="modal-header">
            <h4 id="vehicle-invoice-modal-title">رفع فاتورة جديدة</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="vehicle-invoice-form">
            <div class="modal-body">
                <input type="hidden" id="invoice-id">
                
                <div class="form-group">
                    <label for="invoice-vehicle-search">اختر المركبة (ابحث باللوحة أو النوع)</label>
                    <div class="custom-select-wrapper">
                        <input type="text" id="invoice-vehicle-search" class="custom-select-search" placeholder="ابحث..." required>
                        <div id="invoice-vehicle-options" class="custom-select-options"></div>
                        </div>
                        <input type="hidden" id="invoice-vehicle" required> </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="invoice-type">نوع الفاتورة</label>
                        <select id="invoice-type" required>
                            <option value="">-- اختر النوع --</option>
                            <option value="بنزين">بنزين</option>
                            <option value="صيانة دورية">صيانة دورية</option>
                            <option value="إصلاح عطل">إصلاح عطل</option>
                            <option value="غسيل">غسيل</option>
                            <option value="رسوم حكومية">رسوم حكومية/تجديد</option>
                            <option value="أخرى">أخرى</option>
                        </select>
                    </div>
                    <div class="form-group hidden" id="invoice-type-other-group">
                        <label for="invoice-type-other">الرجاء تحديد النوع</label>
                        <input type="text" id="invoice-type-other">
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="invoice-amount">قيمة الفاتورة (ر.س)</label>
                        <input type="number" id="invoice-amount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="invoice-date">تاريخ الفاتورة</label>
                        <input type="date" id="invoice-date" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="invoice-file-upload">إرفاق ملف الفاتورة (صورة أو PDF)</label>
                    <input type="file" id="invoice-file-upload" accept="image/*,application/pdf" required>
                </div>
                
                <div class="form-group">
                    <label for="invoice-notes">ملاحظات</label>
                    <textarea id="invoice-notes" rows="3" placeholder="أضف أي تفاصيل..."></textarea>
                </div>
                
            </div>
            <div class="modal-footer">
                <button type="submit" id="save-invoice-btn" class="btn btn-primary">حفظ الفاتورة</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>
<div id="edit-invoice-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 600px;">
        <div class="modal-header">
            <h4 id="edit-invoice-modal-title">تعديل فاتورة</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="edit-invoice-form">
            <div class="modal-body">
                <input type="hidden" id="edit-invoice-id">
                <input type="hidden" id="edit-invoice-old-file-path">
                
                <div class="form-group">
                    <label for="edit-invoice-vehicle-search">المركبة (لا يمكن تغييرها)</label>
                    <div class="custom-select-wrapper">
                        <input type="text" id="edit-invoice-vehicle-search" class="custom-select-search" readonly disabled>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="edit-invoice-type">نوع الفاتورة</label>
                        <select id="edit-invoice-type" required>
                            <option value="">-- اختر النوع --</option>
                            <option value="بنزين">بنزين</option>
                            <option value="صيانة دورية">صيانة دورية</option>
                            <option value="إصلاح عطل">إصلاح عطل</option>
                            <option value="غسيل">غسيل</option>
                            <option value="رسوم حكومية">رسوم حكومية/تجديد</option>
                            <option value="أخرى">أخرى</option>
                        </select>
                    </div>
                    <div class="form-group hidden" id="edit-invoice-type-other-group">
                        <label for="edit-invoice-type-other">الرجاء تحديد النوع</label>
                        <input type="text" id="edit-invoice-type-other">
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="edit-invoice-amount">قيمة الفاتورة (ر.س)</label>
                        <input type="number" id="edit-invoice-amount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-invoice-date">تاريخ الفاتورة</label>
                        <input type="date" id="edit-invoice-date" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="edit-invoice-file-upload">إرفاق ملف فاتورة جديد (اختياري)</label>
                    <input type="file" id="edit-invoice-file-upload" accept="image/*,application/pdf">
                    <small>اتركه فارغاً للإبقاء على المرفق القديم.</small>
                </div>
                
                <div class="form-group">
                    <label for="edit-invoice-notes">ملاحظات</label>
                    <textarea id="edit-invoice-notes" rows="3" placeholder="أضف أي تفاصيل..."></textarea>
                </div>
                
            </div>
            <div class="modal-footer">
                <button type="submit" id="update-invoice-btn" class="btn btn-primary">حفظ التعديلات</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>
<div id="vehicle-violation-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 650px;">
        <div class="modal-header">
            <h4 id="vehicle-violation-modal-title">رفع مخالفة جديدة</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="vehicle-violation-form">
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="violation-vehicle-search">1. اختر المركبة</label>
                        <div class="custom-select-wrapper">
                            <input type="text" id="violation-vehicle-search" class="custom-select-search" placeholder="ابحث باللوحة أو النوع..." required>
                            <div id="violation-vehicle-options" class="custom-select-options"></div>
                        </div>
                        <input type="hidden" id="violation-vehicle" required>
                    </div>
                    <div class="form-group">
                        <label for="violation-user-search">2. اختر الموظف (المتسبب)</label>
                        <div class="custom-select-wrapper">
                            <input type="text" id="violation-user-search" class="custom-select-search" placeholder="ابحث بالاسم أو الهوية..." required>
                            <div id="violation-user-options" class="custom-select-options"></div>
                        </div>
                        <input type="hidden" id="violation-user" required>
                    </div>
                </div>

               <div class="form-grid" style="grid-template-columns: 1fr 1fr 1fr;">
                    <div class="form-group">
                        <label for="violation-amount">3. قيمة المخالفة (ر.س)</label>
                        <input type="number" id="violation-amount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="violation-date">4. تاريخ المخالفة</label>
                        <input type="date" id="violation-date" required>
                    </div>
                    <div class="form-group">
                        <label for="violation-time">5. وقت المخالفة</label>
                        <input type="time" id="violation-time" required>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="violation-type">6. نوع المخالفة</label>
                        <select id="violation-type" required>
                            <option value="">-- اختر النوع --</option>
                            <option value="سرعة زائدة">سرعة زائدة</option>
                            <option value="قطع إشارة">قطع إشارة</option>
                            <option value="وقوف خاطئ">وقوف خاطئ</option>
                            <option value="أخرى">أخرى</option>
                        </select>
                    </div>
                    <div class="form-group hidden" id="violation-type-other-group">
                        <label for="violation-type-other">الرجاء تحديد النوع</label>
                        <input type="text" id="violation-type-other">
                    </div>
                </div>

                <hr style="margin: 20px 0;">
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="violation-responsibility">7. تحديد المسؤولية</label>
                        <select id="violation-responsibility" required>
                            <option value="">-- اختر --</option>
                            <option value="يخصم من الموظف">يخصم من الموظف</option>
                            <option value="تتحملها الشركة">تتحملها الشركة</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="violation-status">8. حالة المخالفة</label>
                        <select id="violation-status" required>
                            <option value="جديدة">جديدة (غير مدفوعة)</option>
                            <option value="مدفوعة">مدفوعة</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label for="violation-file-upload">9. إرفاق صورة المخالفة (اختياري)</label>
                    <input type="file" id="violation-file-upload" accept="image/*,application/pdf">
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" id="save-violation-btn" class="btn btn-primary">حفظ المخالفة</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>
<div id="recipient-info-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 500px;">
        <div class="modal-header">
            <h4>بيانات مستلم العهدة</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <div id="recipient-info-container" class="contract-display" style="padding: 10px;">
                <p style="text-align: center;">جاري تحميل البيانات...</p>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="manual-absence-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 500px;">
        <div class="modal-header">
            <h4 id="manual-absence-title">تسجيل غياب </h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="manual-absence-form">
            <div class="modal-body">
                <input type="hidden" id="manual-absence-guard-id">
                <input type="hidden" id="manual-absence-guard-name">
                <input type="hidden" id="manual-absence-shift-snapshot">
                <input type="hidden" id="manual-absence-record-id">
                <input type="hidden" id="manual-absence-shift-start">
                <input type="hidden" id="manual-absence-shift-end">

                <p style="font-size: 1.1rem; line-height: 1.6;">أنت على وشك تسجيل "غياب" للموظف: <br><strong id="manual-absence-guard-name-display" style="color: var(--denied-color);"></strong></p>

                <div class="form-group">
                    <label for="manual-absence-notes">الرجاء كتابة ملاحظة </label>
                    <textarea id="manual-absence-notes" rows="4" placeholder="مثال: تم الاتصال عليه والجوال مغلق" required></textarea>
                </div>

                <div class="form-group" style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; display:flex; align-items:center; gap:15px; margin-top: 20px;">
                   <input type="checkbox" id="manual-absence-with-excuse" style="width: 20px; height: 20px; flex-shrink: 0; cursor: pointer;">
                    <label for="manual-absence-with-excuse" style="margin:0; font-weight: 700; cursor: pointer;">بعذر؟</label>
                </div>

                <div id="absence-attachment-group" class="form-group hidden" style="margin-top: 15px;">
                    <label for="manual-absence-attachment">رفع المرفق (صورة أو PDF)</label>
                    <input type="file" id="manual-absence-attachment" accept="image/*,application/pdf">
                </div>
                </div>
            <div class="modal-footer">
                <button type="submit" id="save-manual-absence-btn" class="btn btn-danger">تأكيد وتسجيل الغياب</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>
<div id="blacklist-add-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 700px;">
        <div class="modal-header">
            <h4>إضافة موظف للقائمة السوداء</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="blacklist-add-form">
            <div class="modal-body">
                <div class="form-group">
                    <label for="blacklist-fetch-user-search">جلب بيانات موظف مسجل بالنظام (اختياري)</label>
                    <div class="custom-select-wrapper blacklist-searchable-select">
                        <input type="text" id="blacklist-fetch-user-search" class="custom-select-search" placeholder="ابحث بالاسم أو الهوية لجلب البيانات...">
                        <div id="blacklist-fetch-user-options" class="custom-select-options"></div>
                    </div>
                    <input type="hidden" id="blacklist-fetch-user">
                </div>

                <hr style="margin: 25px 0;">
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="blacklist-name">اسم الموظف</label>
                        <input type="text" id="blacklist-name" required>
                    </div>
                    <div class="form-group">
                        <label for="blacklist-id-number">رقم الهوية</label>
                        <input type="text" id="blacklist-id-number" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="blacklist-reason">السبب (إجباري)</label>
                    <textarea id="blacklist-reason" rows="5" placeholder="اكتب سبب الإدراج بالتفصيل..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="blacklist-attachment">إرفاق مستند (اختياري)</label>
                    <input type="file" id="blacklist-attachment" accept="image/*,application/pdf">
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" id="save-to-blacklist-btn" class="btn btn-danger">حفظ في القائمة السوداء</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>

<div id="blacklist-view-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 600px;">
        <div class="modal-header">
            <h4>تفاصيل الإدراج</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div id="blacklist-view-body" class="modal-body">
            <p style="text-align: center;">جاري تحميل التفاصيل...</p>
        </div>
        <div class="modal-footer" id="blacklist-view-footer">
            <button type="button" class="btn btn-danger" id="blacklist-delete-btn" data-id="">حذف من القائمة</button>
            <button type="button" class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="lawsuit-add-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 800px;">
        <div class="modal-header">
            <h4>إضافة دعوى / ملف قضية جديدة</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="lawsuit-add-form">
            <div class="modal-body">
                <div class="form-group">
                    <label for="lawsuit-title">مسمى الدعوى / الملف (إجباري)</label>
                    <input type="text" id="lawsuit-title" placeholder="مثال: قضية عمالية - الموظف فلان" required>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="lawsuit-number">رقم الدعوى الرسمي (اختياري)</label>
                        <input type="text" id="lawsuit-number" placeholder="رقم القضية في المحكمة">
                    </div>
                    <div class="form-group">
                        <label for="lawsuit-type">نوع الدعوى (إجباري)</label>
                        <select id="lawsuit-type" required>
                            <option value="">-- اختر النوع --</option>
                            <option value="عمالية">عمالية</option>
                            <option value="تجارية">تجارية</option>
                            <option value="جنائية">جنائية</option>
                            <option value="مرورية">مرورية</option>
                            <option value="إدارية">إدارية</option>
                            <option value="أخرى">أخرى</option>
                        </select>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="lawsuit-plaintiff">المدعي (إجباري)</label>
                        <input type="text" id="lawsuit-plaintiff" placeholder="اسم رافع الدعوى" required>
                    </div>
                    <div class="form-group">
                        <label for="lawsuit-defendant">المدعى عليه (إجباري)</label>
                        <input type="text" id="lawsuit-defendant" value="شركة اركانات" required>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="lawsuit-court">المحكمة المختصة</label>
                        <input type="text" id="lawsuit-court" placeholder="مثال: المحكمة العمالية بالرياض">
                    </div>
                    <div class="form-group">
                        <label for="lawsuit-filing-date">تاريخ رفع الدعوى</label>
                        <input type="date" id="lawsuit-filing-date">
                    </div>
                </div>
                <div class="form-group">
                    <label for="lawsuit-summary">ملخص الدعوى / الأسباب</label>
                    <textarea id="lawsuit-summary" rows="4" placeholder="اكتب ملخصاً قصيراً لسبب الدعوى..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="lawsuit-attachments">المرفقات الأولية (لائحة الدعوى، إلخ) - اختياري</label>
                    <input type="file" id="lawsuit-attachments" multiple>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" id="save-new-lawsuit-btn" class="btn btn-primary">حفظ وبدء تتبع الدعوى</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>

<div id="lawsuit-view-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 900px;">
        <div class="modal-header">
            <h4 id="lawsuit-view-title">تفاصيل الدعوى</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body" id="lawsuit-view-body">
            <p style="text-align: center;">جاري تحميل تفاصيل الدعوى...</p>
        </div>
        <div class="modal-footer" id="lawsuit-view-footer">
            <button type="button" class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="view-employee-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 800px;">
        <div class="modal-header">
            <h4 id="view-employee-title">ملف الموظف</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div id="view-employee-body" class="modal-body">
            <p style="text-align: center;">جاري تحميل البيانات...</p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="settlement-add-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 800px;">
        <div class="modal-header">
            <h4>إضافة ملف تسوية جديد</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="settlement-add-form">
            <div class="modal-body">
                <div class="form-group">
                    <label for="settlement-title">مسمى ملف التسوية (إجباري)</label>
                    <input type="text" id="settlement-title" placeholder="مثال: تسوية الموظف فلان الفلاني" required>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="settlement-type">نوع التسوية (إجباري)</label>
                        <select id="settlement-type" required>
                            <option value="">-- اختر النوع --</option>
                            <option value="عمالية">عمالية</option>
                            <option value="مالية">مالية</option>
                            <option value="أخرى">أخرى</option>
                        </select>
                    </div>
                     <div class="form-group">
                        <label for="settlement-filing-date">تاريخ فتح الملف</label>
                        <input type="date" id="settlement-filing-date">
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="settlement-claimant">الطرف الأول (المدعي/الموظف)</label>
                        <input type="text" id="settlement-claimant" placeholder="اسم الموظف" required>
                    </div>
                    <div class="form-group">
                        <label for="settlement-respondent">الطرف الثاني (المدعى عليه)</label>
                        <input type="text" id="settlement-respondent" value="شركة اركانات" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="settlement-amount-requested">المبلغ المطلوب للتسوية (ر.س)</label>
                    <input type="number" id="settlement-amount-requested" placeholder="المبلغ الذي يطالب به الطرف الأول">
                </div>
                <div class="form-group">
                    <label for="settlement-summary">ملخص الطلب / الأسباب</label>
                    <textarea id="settlement-summary" rows="4" placeholder="اكتب ملخصاً قصيراً لسبب طلب التسوية..."></textarea>
                </div>
                <div class="form-group">
                    <label for="settlement-attachments">المرفقات الأولية (اختياري)</label>
                    <input type="file" id="settlement-attachments" multiple>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" id="save-new-settlement-btn" class="btn btn-primary">حفظ وبدء تتبع الملف</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>

<div id="settlement-view-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 900px;">
        <div class="modal-header">
            <h4 id="settlement-view-title">تفاصيل ملف التسوية</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body" id="settlement-view-body">
            <p style="text-align: center;">جاري تحميل تفاصيل الملف...</p>
        </div>
        <div class="modal-footer" id="settlement-view-footer">
            <button type="button" class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="financial-request-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 800px;">
        <div class="modal-header">
            <h4 id="financial-request-title">تقديم طلب صرف جديد</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="financial-request-form">
            <div class="modal-body">
                <div id="financial-legal-fields" class="hidden">
                    <div class="form-group">
                        <label for="legal-request-employee">اختر الموظف صاحب المخالصة</label>
                        <select id="legal-request-employee" class="form-control"></select>
                    </div>
                    <div class="form-grid">
                        <div class="form-group"><label>الراتب المستحق</label><input type="number" id="legal-salary" placeholder="0.00"></div>
                        <div class="form-group"><label>مكافأة نهاية الخدمة</label><input type="number" id="legal-bonus" placeholder="0.00"></div>
                        <div class="form-group"><label>رصيد الإجازات</label><input type="number" id="legal-leave" placeholder="0.00"></div>
                        <div class="form-group"><label>الإجمالي المستحق</label><input type="text" id="legal-total" readonly style="background-color: #e9ecef; font-weight: bold;"></div>
                    </div>
                    <div class="form-group">
                        <label for="legal-case-amount">مبلغ حكم قضائي (إن وجد)</label>
                        <input type="number" id="legal-case-amount" placeholder="0.00">
                    </div>
                    <div class="form-grid">
                        <div class="form-group"><label>مرفق الاستقالة</label><input type="file" id="legal-attach-resignation"></div>
                        <div class="form-group"><label>مرفق المخالصة</label><input type="file" id="legal-attach-clearance"></div>
                        <div class="form-group"><label>مرفق الحكم (إن وجد)</label><input type="file" id="legal-attach-judgment"></div>
                    </div>
                </div>

                <div id="financial-general-fields">
                    <div class="form-group">
                        <label for="financial-request-title-input">عنوان الطلب (إجباري)</label>
                        <input type="text" id="financial-request-title-input" placeholder="مثال: فاتورة صيانة طابعات شهر نوفمبر" required>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="financial-request-type">نوع الفاتورة</label>
                            <select id="financial-request-type" required></select>
                        </div>
                        <div class="form-group hidden" id="financial-request-type-other-group">
                            <label for="financial-request-type-other">الرجاء تحديد النوع</label>
                            <input type="text" id="financial-request-type-other">
                        </div>
                        <div class="form-group">
                            <label for="financial-request-amount">المبلغ (ر.س)</label>
                            <input type="number" id="financial-request-amount" step="0.01" placeholder="0.00" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="financial-payment-method">طريقة الدفع المطلوبة</label>
                        <select id="financial-payment-method" required>
                            <option value="">-- اختر --</option>
                            <option value="iban">تحويل بنكي (IBAN)</option>
                            <option value="sadad">سداد فاتورة (سداد)</option>
                        </select>
                    </div>
                    <div id="financial-payment-details-iban" class="hidden" style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <div class="form-grid">
                            <div class="form-group"><label>اسم المستفيد</label><input type="text" id="iban-beneficiary-name"></div>
                            <div class="form-group"><label>اسم البنك</label><input type="text" id="iban-bank-name"></div>
                        </div>
                        <div class="form-group"><label>رقم الآيبان (IBAN)</label><input type="text" id="iban-number"></div>
                    </div>
                    <div id="financial-payment-details-sadad" class="hidden" style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <div class="form-grid">
                            <div class="form-group"><label>اسم المفوتر</label><input type="text" id="sadad-biller-name"></div>
                            <div class="form-group"><label>رقم الفاتورة / الحساب</label><input type="text" id="sadad-biller-number"></div>
                        </div>
                    </div>
                </div>

                <hr style="margin: 25px 0;">
                <div class="form-group">
                    <label for="financial-request-attachment">إرفاق فاتورة أولية (اختياري)</label>
                    <input type="file" id="financial-request-attachment" accept="image/*,application/pdf">
                </div>
                <div class="form-group">
                    <label for="financial-request-notes">ملاحظات (اختياري)</label>
                    <textarea id="financial-request-notes" rows="3" placeholder="أضف أي تفاصيل إضافية هنا..."></textarea>
                </div>

            </div>
            <div class="modal-footer">
                <button type="submit" id="save-financial-request-btn" class="btn btn-primary">إرسال الطلب للمراجعة</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>

<div id="financial-review-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 800px;">
        <div class="modal-header">
            <h4 id="financial-review-title">مراجعة طلب صرف</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body" id="financial-review-body">
    </div>

<div id="approval-notes-container" class="form-group hidden" style="margin: 0; padding: 15px 25px; background-color: #f8f9fa; border-top: 1px solid #e5e7eb;">
    <label for="approval-notes-input" style="display: block; margin-bottom: 8px; font-weight: 700; color: var(--text-primary);">
        <i class="ph-bold ph-pencil-simple-line"></i> إضافة ملاحظة (اختياري):
    </label>
    <textarea id="approval-notes-input" rows="3" style="
        width: 100%; 
        padding: 12px; 
        border-radius: 8px; 
        border: 1px solid #d1d5db; 
        resize: vertical; 
        font-family: 'Cairo', sans-serif;
        background-color: white;" 
        placeholder="اكتب ملاحظاتك ..."></textarea>
</div>
<div class="modal-footer">  
            <input type="hidden" id="financial-review-request-id">
            <button type="button" id="financial-review-reject-btn" class="btn btn-danger" style="margin-right: auto;">رفض الطلب</button>
            <button type="button" id="financial-review-approve-btn" class="btn btn-success">موافقة واعتماد</button>
            <button type="button" class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>

<div id="financial-auditor-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 700px;">
        <div class="modal-header">
            <h4>اعتماد الطلب وإصدار الفاتورة</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="financial-auditor-form">
            <div class="modal-body">
                <input type="hidden" id="financial-auditor-request-id">

                <p>الرجاء تعبئة البيانات المتوفرة من الفاتورة ورفعها.</p>

                <div class="form-group">
                    <label for="auditor-final-invoice-pdf">1. رفع الفاتورة النهائية </label>
                    <input type="file" id="auditor-final-invoice-pdf" accept="image/*,application/pdf">
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="auditor-invoice-number">2. رقم الفاتورة</label>
                        <input type="text" id="auditor-invoice-number">
                    </div>
                    <div class="form-group">
                        <label for="auditor-invoice-date">3. تاريخ ووقت اصدار الفاتورة</label>
                        <input type="datetime-local" id="auditor-invoice-date">
                    </div>
                </div>

                <div class="form-group">
                    <label for="auditor-client-name">4. اسم العميل </label>
                    <input type="text" id="auditor-client-name" placeholder="">
                </div>
                
                <div class="form-group">
                    <label for="auditor-notes">5. ملاحظات (اختياري)</label>
                    <textarea id="auditor-notes" rows="2"></textarea>
                </div>

                <div class="form-group">
                    <label for="auditor-statement">5. البيان </label>
                    <input type="text" id="auditor-statement">
                </div>
                <div class="form-group">
                    <label for="auditor-total-with-vat">6. الاجمالي شامل الضريبة (ر.س)</label>
                    <input type="number" step="0.01" id="auditor-total-with-vat" placeholder="0.00">
                </div>
                </div>
            <div class="modal-footer">
                <button type="submit" id="save-auditor-approval-btn" class="btn btn-primary">اعتماد وإرسال لأوامر الصرف</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>

<div id="financial-payment-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 500px;">
        <div class="modal-header">
            <h4>اعتماد الصرف النهائي</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="financial-payment-form">
            <div class="modal-body">
                <input type="hidden" id="financial-payment-request-id">
                <p>الرجاء إرفاق إيصال الدفع لتوثيق العملية ونقلها للأرشيف.</p>
                <div class="form-group">
                    <label for="payment-receipt-upload">1. إرفاق إيصال الدفع (إجباري)</label>
                    <input type="file" id="payment-receipt-upload" accept="image/*,application/pdf" required>
                </div>
                <div class="form-group">
                    <label for="payment-final-notes">2. ملاحظات الصرف (اختياري)</label>
                    <textarea id="payment-final-notes" rows="3" placeholder="مثال: تم الدفع من حساب بنك الراجحي..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" id="save-final-payment-btn" class="btn btn-success">تأكيد الدفع ونقل للأرشيف</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>

<div id="financial-archive-view-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 800px;">
        <div class="modal-header">
            <h4 id="financial-archive-title">تفاصيل الطلب (من الأرشيف)</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body" id="financial-archive-body">
            </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="supervisor-replacement-modal" class="modal-overlay hidden">
    <div class="modal-panel">
        <div class="modal-header">
            <h4>تحديد البديل لطلب الاستقالة</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="supervisor-replacement-form">
            <div class="modal-body">
                <input type="hidden" id="replacement-request-id">
                <p>أنت على وشك الموافقة على طلب الاستقالة. يرجى تحديد الحارس البديل من القائمة أدناه قبل الرفع للشؤون القانونية.</p>
                <div class="form-group">
                    <label for="replacement-guard-select">اختر الحارس البديل (من الحراس غير المسكنين)</label>
                    <select id="replacement-guard-select" required>
                        <option value="">جاري تحميل الحراس المتاحين...</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" id="save-resignation-replacement-btn" class="btn btn-primary">موافقة ورفع للشؤون القانونية</button>
                <button type="button" class="btn btn-secondary modal-close-btn">إلغاء</button>
            </div>
        </form>
    </div>
</div>

<div id="legal-review-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 600px;">
        <div class="modal-header">
            <h4>مراجعة واعتماد طلب استقالة</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="legal-review-request-id">
            <input type="hidden" id="legal-review-user-id">
            <input type="hidden" id="legal-review-vacancy-id">

            <div id="legal-review-details-container" class="contract-display">
                <p style="text-align: center;">جاري تحميل التفاصيل...</p>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" id="final-reject-resignation-btn" class="btn btn-danger" style="margin-right: auto;">رفض الطلب</button>
            <button type="button" id="final-approve-resignation-btn" class="btn btn-success">اعتماد نهائي (وتعطيل الحساب)</button>
            <button type="button" class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="extra-guards-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 900px;">
        <div class="modal-header">
            <h4>تقرير الحراس الزائدين / غير المرتبطين</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div id="extra-guards-body" class="modal-body">
            <p style="text-align: center;">جاري التحليل...</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary modal-close-btn">إغلاق</button>
        </div>
    </div>
</div>
<div id="cmd-branch-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 500px;">
        <div class="modal-header">
            <h4 id="cmd-branch-modal-title">إضافة فرع جديد</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="cmd-branch-form">
            <div class="modal-body">
                <input type="hidden" id="cmd-branch-id">
                <div class="form-group">
                    <label>اسم الفرع</label>
                    <input type="text" id="cmd-branch-name" placeholder="مثال: المقر الرئيسي - الرياض" required>
                </div>
                <div class="form-group">
                    <label>الإحداثيات (من خرائط جوجل)</label>
                    <input type="text" id="cmd-branch-coords" class="location-geofence-link" placeholder="مثال: 24.7136, 46.6753" required>
                    <small class="coords-address-preview" style="display: block; margin-top: 5px; color: var(--text-secondary);"></small>
                </div>
                <div class="form-group">
                    <label>نطاق السماحية (متر)</label>
                    <input type="number" id="cmd-branch-radius" value="50" required>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary">حفظ الفرع</button>
            </div>
        </form>
    </div>
</div>

<div id="cmd-employee-modal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width: 900px;">
        <div class="modal-header">
            <h4>إعدادات الموظف: <span id="cmd-employee-name" style="color: var(--accent-color);"></span></h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <form id="cmd-employee-form">
            <div class="modal-body">
                <input type="hidden" id="cmd-employee-id">

                <div class="review-request-card" style="margin-bottom: 20px;">
                    <div class="review-request-header status-approved">
                        <h4><i class="ph-bold ph-map-pin"></i> التسكين ونظام الحضور</h4>
                    </div>
                    <div class="review-request-body">
                        <div class="form-grid">
                            <div class="form-grid"> <div class="form-group">
                                    <label>الفرع التابع له</label>
                                    <select id="cmd-emp-branch" required>
                                        <option value="">-- اختر الفرع --</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>وقت الدوام (الشفت)</label>
                                    <select id="cmd-emp-shift" disabled>
                                        <option value="">-- اختر الفرع أولاً --</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group" style="display: flex; align-items: center; margin-top: 25px;">
                                <input type="checkbox" id="cmd-emp-exempt" style="width: 20px; height: 20px; margin-left: 10px;">
                                <label for="cmd-emp-exempt" style="margin:0; font-weight:bold; cursor:pointer;">إعفاء من البصمة (تسجيل تلقائي)</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="review-request-card" style="margin-bottom: 20px;">
                    <div class="review-request-header status-pending">
                        <h4><i class="ph-bold ph-money"></i> الرواتب ورصيد الإجازات</h4>
                    </div>
                    <div class="review-request-body">
                        <div class="form-grid" style="grid-template-columns: repeat(4, 1fr);">
                            <div class="form-group"><label>الأساسي</label><input type="number" id="cmd-salary-basic" value="0"></div>
                            <div class="form-group"><label>بدل سكن</label><input type="number" id="cmd-salary-housing" value="0"></div>
                            <div class="form-group"><label>بدل نقل</label><input type="number" id="cmd-salary-transport" value="0"></div>
                            <div class="form-group"><label>أخرى</label><input type="number" id="cmd-salary-other" value="0"></div>
                        </div>
                        <div class="form-grid" style="margin-top: 15px;">
                            <div class="form-group">
                                <label>رصيد الإجازات السنوي (أيام)</label>
                                <input type="number" id="cmd-leave-balance" value="21" style="border-color: var(--accent-color); background: #eff6ff;">
                            </div>
                            <div class="form-group">
                                <label>إجمالي الراتب (للقراءة)</label>
                                <input type="text" id="cmd-salary-total" readonly style="background: #e9ecef; font-weight: bold; text-align: center;">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="review-request-card">
                    <div class="review-request-header" style="background-color: #374151;">
                        <h4><i class="ph-bold ph-lock-key"></i> مصفوفة الصلاحيات (الصفحات المسموحة)</h4>
                    </div>
                    <div class="review-request-body">
                        <div id="cmd-permissions-container" class="checkbox-grid" style="grid-template-columns: repeat(3, 1fr);">
                            </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary" style="width: 100%;">حفظ كافة الإعدادات</button>
            </div>
        </form>
    </div>
</div>
<div id="branch-shifts-modal" class="modal-overlay hidden" style="z-index: 1200;">
    <div class="modal-panel" style="max-width: 600px;">
        <div class="modal-header">
            <h4 id="branch-shifts-title">إدارة أوقات الدوام</h4>
            <button class="modal-close-btn"><i class="ph-bold ph-x"></i></button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="manage-shifts-branch-id">
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid var(--border-color);">
                <h5 style="margin-top: 0;">إضافة وقت دوام جديد</h5>
                <form id="add-branch-shift-form">
                    <div class="form-group">
                        <label>مسمى الوقت (مثال: دوام صباحي)</label>
                        <input type="text" id="new-shift-name" required placeholder="وصف للوردية">
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>من الساعة</label>
                            <input type="time" id="new-shift-start" required>
                        </div>
                        <div class="form-group">
                            <label>إلى الساعة</label>
                            <input type="time" id="new-shift-end" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>أيام العمل</label>
                        <div class="weekdays-selector">
                            <label><input type="checkbox" value="Sun" checked> الأحد</label>
                            <label><input type="checkbox" value="Mon" checked> الاثنين</label>
                            <label><input type="checkbox" value="Tue" checked> الثلاثاء</label>
                            <label><input type="checkbox" value="Wed" checked> الأربعاء</label>
                            <label><input type="checkbox" value="Thu" checked> الخميس</label>
                            <label><input type="checkbox" value="Fri"> الجمعة</label>
                            <label><input type="checkbox" value="Sat"> السبت</label>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary btn-sm" style="width: 100%;">
                        <i class="ph-bold ph-plus"></i> إضافة الوقت
                    </button>
                </form>
            </div>

            <h5>الأوقات المسجلة لهذا الفرع</h5>
            <div id="branch-shifts-list" class="table-container" style="max-height: 300px; overflow-y: auto;">
                <p style="text-align: center;">جاري التحميل...</p>
            </div>
        </div>
    </div>
</div>
<div id="payroll-draft-editor-modal" class="modal-overlay hidden" style="z-index: 2000;">
    <div class="modal-panel" style="max-width: 98%; height: 95vh; display: flex; flex-direction: column;">
        <div class="modal-header" style="background: #1f2937; color: white;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <h4 id="draft-editor-title">مراجعة مسودة المسير</h4>
                <span class="status-badge pending" id="draft-status-badge">مسودة</span>
            </div>
            <div style="display: flex; gap: 10px;">
                <button id="save-draft-changes-btn" class="btn btn-primary">
                    <i class="ph-bold ph-floppy-disk"></i> حفظ التغييرات
                </button>
                
                <button id="export-draft-excel-btn" class="btn btn-secondary" style="background-color: #059669; color: white; border: none;">
                    <i class="ph-bold ph-file-xls"></i> تصدير Excel
                </button>

                <button id="submit-to-manager-btn" class="btn btn-warning hidden" style="background-color: #d97706; color: white; border: none;">
                    <i class="ph-bold ph-paper-plane-right"></i> إرسال للمدير للمراجعة
                </button>

                <button id="approve-draft-btn" class="btn btn-success hidden">
                    <i class="ph-bold ph-check-fat"></i> اعتماد ورفع للمالية
                </button>
                
                <button class="btn btn-secondary modal-close-btn" style="background: rgba(255,255,255,0.1); color: white; border: none;">إغلاق</button>
            </div>
        </div>
        
        <div class="modal-body" style="padding: 0; overflow: hidden; display: flex; flex-direction: column;">
            <div style="padding: 10px; background: #f3f4f6; border-bottom: 1px solid #e5e7eb; display: flex; gap: 15px;">
                <input type="text" id="draft-search-input" placeholder="بحث باسم الموظف..." style="padding: 8px; border-radius: 4px; border: 1px solid #d1d5db; width: 250px;">
                <div style="margin-right: auto; font-weight: bold; color: #1f2937;">
                    الإجمالي النهائي: <span id="draft-total-net" style="color: #16a34a;">0.00</span> ر.س
                </div>
            </div>

            <div class="table-container" style="flex-grow: 1; overflow: auto; box-shadow: none; border-radius: 0;">
                <table id="draft-editor-table" style="font-size: 0.85rem; width: 100%; min-width: 2500px;"> <thead style="position: sticky; top: 0; z-index: 10; background: #1f2937; color: white;">
                        <tr>
                            <th style="min-width: 180px; position: sticky; right: 0; background: #1f2937; z-index: 12;">اسم الموظف</th>
                            <th style="min-width: 100px;">رقم الهوية</th>
                            <th>المنطقة</th>
                            <th>المشروع</th>
                            <th>الموقع</th>
                            
                            <th>الراتب الأساسي</th>
                            <th>بدل سكن</th>
                            <th>بدل نقل</th>
                            <th>بدلات أخرى</th>
                            <th style="background: #374151;">إجمالي الراتب</th>
                            <th>قيمة اليومية</th>

                            <th>أيام العمل</th>
                            <th>أيام الراحة</th>
                            <th>أيام الغياب</th>
                            <th>انسحاب</th>
                            <th>تغطية موقع</th>

                            <th style="background: #065f46;">بدل راحة</th>
                            <th style="background: #065f46;">عمل إضافي</th>
                            <th style="background: #047857;">إجمالي المستحق</th>

                            <th style="background: #991b1b;">خصم الغياب</th>
                            <th style="background: #991b1b;">خصم التأخير</th>
                            <th style="background: #991b1b;">تأمينات</th>
                            <th style="background: #991b1b;">خصم الزي</th>
                            <th style="background: #991b1b;">سلف</th>
                            <th style="background: #991b1b;">خصومات أخرى</th>
                            <th style="background: #7f1d1d;">مجموع الاستقطاعات</th>

                            <th style="min-width: 120px; background: #16a34a; font-size: 1.1rem; position: sticky; left: 0; z-index: 12;">الصافي</th>
                            
                            <th>البنك</th>
                            <th>الآيبان</th>
                            <th>ملاحظات</th>
                        </tr>
                    </thead>
                    <tbody id="draft-table-body"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>
</body>
</html>